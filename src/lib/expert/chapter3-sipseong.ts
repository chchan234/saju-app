/**
 * 제3장: 십성(十星/十神) 분석
 * - 10신 분류 및 강약도
 * - 기둥별 십신 의미
 * - 성별 분기 해석 (관성/재성 남녀 차이)
 * - 십신 균형 분석
 */

import type { SajuApiResult, Gender, Pillar } from "@/types/saju";
import type { Chapter3Result, TenGodDetailedAnalysis } from "@/types/expert";

// ============================================
// 상수 및 데이터
// ============================================

type FiveElementKey = "목" | "화" | "토" | "금" | "수";
type TenGodName = "비견" | "겁재" | "식신" | "상관" | "편재" | "정재" | "편관" | "정관" | "편인" | "정인";
type TenGodGroup = "비겁" | "식상" | "재성" | "관성" | "인성";

// 천간 오행
const CHEONGAN_OHENG: Record<string, FiveElementKey> = {
  갑: "목", 을: "목",
  병: "화", 정: "화",
  무: "토", 기: "토",
  경: "금", 신: "금",
  임: "수", 계: "수",
};

// 천간 음양
const CHEONGAN_YINYANG: Record<string, "양" | "음"> = {
  갑: "양", 을: "음",
  병: "양", 정: "음",
  무: "양", 기: "음",
  경: "양", 신: "음",
  임: "양", 계: "음",
};

// 지지 오행
const JIJI_OHENG: Record<string, FiveElementKey> = {
  자: "수", 축: "토",
  인: "목", 묘: "목",
  진: "토", 사: "화",
  오: "화", 미: "토",
  신: "금", 유: "금",
  술: "토", 해: "수",
};

// 지지 음양
const JIJI_YINYANG: Record<string, "양" | "음"> = {
  자: "양", 축: "음",
  인: "양", 묘: "음",
  진: "양", 사: "음",
  오: "양", 미: "음",
  신: "양", 유: "음",
  술: "양", 해: "음",
};

// 지지 장간 (본기) - 지지의 십성 판단 시 본기의 음양을 사용해야 함
const JIJI_MAIN_STEM: Record<string, string> = {
  자: "계",  // 癸 음수
  축: "기",  // 己 음토
  인: "갑",  // 甲 양목
  묘: "을",  // 乙 음목
  진: "무",  // 戊 양토
  사: "병",  // 丙 양화
  오: "정",  // 丁 음화 ⭐ 오화의 본기는 정화(음)
  미: "기",  // 己 음토
  신: "경",  // 庚 양금
  유: "신",  // 辛 음금
  술: "무",  // 戊 양토
  해: "임",  // 壬 양수
};

// 오행 생극 관계 (일간 기준)
const ELEMENT_RELATIONS: Record<FiveElementKey, {
  same: FiveElementKey;       // 같은 오행 = 비겁
  generates: FiveElementKey;  // 내가 생하는 = 식상
  controls: FiveElementKey;   // 내가 극하는 = 재성
  controlled: FiveElementKey; // 나를 극하는 = 관성
  generated: FiveElementKey;  // 나를 생하는 = 인성
}> = {
  목: { same: "목", generates: "화", controls: "토", controlled: "금", generated: "수" },
  화: { same: "화", generates: "토", controls: "금", controlled: "수", generated: "목" },
  토: { same: "토", generates: "금", controls: "수", controlled: "목", generated: "화" },
  금: { same: "금", generates: "수", controls: "목", controlled: "화", generated: "토" },
  수: { same: "수", generates: "목", controls: "화", controlled: "토", generated: "금" },
};

// 십신 한자
const TEN_GOD_HANJA: Record<TenGodName, string> = {
  비견: "比肩",
  겁재: "劫財",
  식신: "食神",
  상관: "傷官",
  편재: "偏財",
  정재: "正財",
  편관: "偏官",
  정관: "正官",
  편인: "偏印",
  정인: "正印",
};

// 십신 그룹
const TEN_GOD_GROUP: Record<TenGodName, TenGodGroup> = {
  비견: "비겁",
  겁재: "비겁",
  식신: "식상",
  상관: "식상",
  편재: "재성",
  정재: "재성",
  편관: "관성",
  정관: "관성",
  편인: "인성",
  정인: "인성",
};

// 십신 기본 의미
const TEN_GOD_MEANING: Record<TenGodName, {
  basic: string;
  positive: string[];
  negative: string[];
  symbolism: string;
}> = {
  비견: {
    basic: "나와 같은 오행, 같은 음양. 동료, 형제, 친구, 경쟁자를 상징합니다.",
    positive: ["독립심", "자주성", "협력", "동료와의 유대"],
    negative: ["고집", "경쟁심 과다", "분쟁", "재물 손실"],
    symbolism: "어깨를 나란히 하는 관계로, 함께 가는 동반자이자 경쟁 상대입니다.",
  },
  겁재: {
    basic: "나와 같은 오행, 다른 음양. 형제, 친구 중에서도 다툼과 빼앗김의 상징입니다.",
    positive: ["추진력", "결단력", "투쟁심", "적극성"],
    negative: ["재물 손실", "다툼", "배신", "과격함"],
    symbolism: "재물을 빼앗는다는 의미로, 경쟁과 분쟁의 에너지입니다.",
  },
  식신: {
    basic: "일간이 낳은 오행 중 음양이 같은 것입니다. 쉽게 말해 '내가 만들어낸 결과물'입니다. 요리사가 음식을 만들 듯, 작가가 글을 쓰듯, 내 에너지를 표현하고 생산하는 능력입니다. 먹는 것, 창작, 재능 발휘를 상징합니다.",
    positive: ["창의력", "표현력", "여유", "낙천적 성격"],
    negative: ["게으름", "방탕", "과식", "현실 안주"],
    symbolism: "복록(福祿)의 별이라 불립니다. 먹고 사는 문제를 해결하고, 삶의 즐거움을 누리는 에너지입니다.",
  },
  상관: {
    basic: "내가 생하는 오행, 다른 음양. 표현력, 재능, 반항심, 정관을 해치는 기운입니다.",
    positive: ["뛰어난 재능", "언변", "예술성", "자유분방"],
    negative: ["반항", "관재구설", "불손", "이기적"],
    symbolism: "관(정관)을 상하게 하여 직장이나 남편운에 영향을 줍니다.",
  },
  편재: {
    basic: "내가 극하는 오행, 같은 음양. 유동적 재물, 투자, 아버지(남성)를 상징합니다.",
    positive: ["사업 수완", "투자 감각", "유동 자산", "융통성"],
    negative: ["투기", "낭비", "돈 문제", "불안정한 재정"],
    symbolism: "흘러다니는 돈, 큰 재물이지만 변동이 심합니다.",
  },
  정재: {
    basic: "내가 극하는 오행, 다른 음양. 정해진 급여, 저축, 아내(남성)를 상징합니다.",
    positive: ["안정된 수입", "저축", "실속", "계획적 재정"],
    negative: ["인색함", "융통성 부족", "소심함", "재물 집착"],
    symbolism: "정해진 급여, 고정 자산으로 안정적이지만 큰 부는 어렵습니다.",
  },
  편관: {
    basic: "나를 극하는 오행, 같은 음양. 권위, 폭력, 스트레스, 자녀(여성)를 상징합니다.",
    positive: ["카리스마", "추진력", "지도력", "결단"],
    negative: ["압박", "질병", "사고", "권위주의"],
    symbolism: "칠살(七殺)이라고도 하며 강한 압박과 통제의 에너지입니다.",
  },
  정관: {
    basic: "나를 극하는 오행, 다른 음양. 직장, 명예, 질서, 남편(여성)을 상징합니다.",
    positive: ["책임감", "신용", "공직 적성", "명예"],
    negative: ["융통성 부족", "경직", "과중한 책임", "스트레스"],
    symbolism: "바른 관직으로 정당한 권위와 직장 생활을 상징합니다.",
  },
  편인: {
    basic: "나를 생하는 오행, 같은 음양. 편협한 학문, 특수 기술, 계모를 상징합니다.",
    positive: ["특수 재능", "영적 감각", "직관력", "연구 능력"],
    negative: ["편협함", "고독", "의지 부족", "도식(倒食)"],
    symbolism: "효신(梟神)이라고도 하며 식신을 해쳐 복록을 빼앗습니다.",
  },
  정인: {
    basic: "나를 생하는 오행, 다른 음양. 학문, 자격증, 어머니, 귀인을 상징합니다.",
    positive: ["학문", "자격증", "지혜", "어머니 복"],
    negative: ["의존적", "나태", "게으름", "결단력 부족"],
    symbolism: "바른 인장으로 학문과 지혜, 후원을 상징합니다.",
  },
};

// 십신 성별별 특수 의미
const TEN_GOD_GENDER_MEANING: Record<TenGodName, { male: string; female: string }> = {
  비견: {
    male: "형제, 친구, 사업 동료를 나타내며 협력과 경쟁의 관계입니다.",
    female: "자매, 친구, 경쟁 여성을 나타내며 사회적 관계를 의미합니다.",
  },
  겁재: {
    male: "의형제, 친구 중 다툼의 관계나 재물 손실의 원인이 됩니다.",
    female: "친구나 동료 중 갈등 관계, 남편을 빼앗길 수 있는 경쟁자를 의미합니다.",
  },
  식신: {
    male: "남성에게 식신은 부하직원, 아랫사람, 할머니(외가)를 상징합니다. 또한 먹고 사는 복과 여유로움을 나타냅니다.",
    female: "여성에게 식신은 자녀(특히 딸)를 상징합니다. 출산과 양육의 에너지이며, 자녀복을 나타냅니다.",
  },
  상관: {
    male: "수하 직원, 할머니 중에서도 까다로운 관계, 관재구설수를 의미합니다.",
    female: "자녀(특히 아들)를 나타내며, 많으면 남편운에 영향을 줍니다.",
  },
  편재: {
    male: "아버지, 첩, 유동 자산, 투자금을 상징합니다.",
    female: "시어머니(편모), 유동 자산, 사업 자금을 의미합니다.",
  },
  정재: {
    male: "아내, 본처, 고정 수입, 급여를 상징합니다.",
    female: "시어머니(정모), 고정 자산, 안정된 재물을 의미합니다.",
  },
  편관: {
    male: "직장에서의 상사, 권위, 스트레스, 자녀(아들)를 상징합니다.",
    female: "내연남, 애인, 스트레스 요인, 갑작스러운 인연을 의미합니다.",
  },
  정관: {
    male: "직장, 명예, 공직, 자녀(딸)를 상징합니다.",
    female: "남편, 정식 배우자, 직장 상사를 의미합니다. 결혼운의 핵심입니다.",
  },
  편인: {
    male: "계모, 유모, 특수 기술, 종교/철학적 관심을 상징합니다.",
    female: "친정어머니(편모), 영적 관심, 특수 재능을 의미합니다.",
  },
  정인: {
    male: "어머니, 학문, 자격증, 귀인의 도움을 상징합니다.",
    female: "어머니, 학문, 문서, 귀인을 의미합니다.",
  },
};

// ============================================
// 서술형 풀이용 상수
// ============================================

// 십신 그룹별 서술형 설명
const TEN_GOD_GROUP_NARRATIVES: Record<TenGodGroup, {
  intro: string;
  meaning: string;
  strong: string;
  weak: string;
  advice: string;
}> = {
  비겁: {
    intro: "비겁(比劫)은 나와 같은 오행입니다. 비견과 겁재를 합쳐서 부르는 말입니다.",
    meaning: "비겁은 형제, 친구, 동료, 경쟁자를 상징합니다. 나와 어깨를 나란히 하는 관계들입니다. 협력도 하지만 경쟁도 하는, 함께 가면서도 서로 견제하는 관계입니다.",
    strong: "비겁이 강하면 자기 주관이 뚜렷하고 독립심이 강합니다. 남에게 휘둘리지 않고 자기 길을 가는 성향입니다. 다만 너무 강하면 고집이 세고 재물이 흩어지기 쉽습니다. 형제나 친구 때문에 재물 손실이 있을 수 있습니다.",
    weak: "비겁이 약하거나 없으면 형제 복이 적거나 혼자 일해야 할 상황이 많습니다. 독립적이긴 하지만 든든한 지원군이 없어 외로울 수 있습니다.",
    advice: "비겁이 강하면 재성(財星)으로 기운을 발산하는 것이 좋습니다. 돈을 벌고 관리하는 일로 에너지를 쓰세요. 비겁이 약하면 든든한 동료나 파트너를 곁에 두는 것이 도움이 됩니다."
  },
  식상: {
    intro: "식상(食傷)은 내가 생하는 오행입니다. 식신과 상관을 합쳐서 부르는 말입니다.",
    meaning: "식상은 표현력, 창의력, 재능을 상징합니다. 내가 밖으로 뿜어내는 에너지입니다. 말, 글, 예술, 기술 등 자신을 표현하는 모든 것이 식상과 관련됩니다. 여성에게는 자녀를 의미하기도 합니다.",
    strong: "식상이 강하면 표현력이 뛰어나고 말을 잘합니다. 창의적이고 재능이 많습니다. 다만 너무 강하면 말이 앞서거나 관재구설이 생길 수 있습니다. 여성은 상관이 많으면 남편운에 영향을 줄 수 있습니다.",
    weak: "식상이 약하거나 없으면 자기 표현이 서툴고 답답함을 느낄 수 있습니다. 하고 싶은 말을 못하고 속으로 삭히는 편입니다. 여성은 자녀 운이 늦을 수 있습니다.",
    advice: "식상이 강하면 창작, 예술, 교육 분야에서 재능을 발휘하세요. 다만 말보다 행동으로 보여주려고 노력하면 좋겠습니다. 식상이 약하면 글쓰기, 말하기 연습을 통해 표현력을 기르세요."
  },
  재성: {
    intro: "재성(財星)은 내가 극하는 오행입니다. 편재와 정재를 합쳐서 부르는 말입니다.",
    meaning: "재성은 재물, 돈, 물질적 가치를 상징합니다. 남성에게는 아내를 의미하기도 합니다. 내가 통제하고 관리할 수 있는 것들이 재성입니다.",
    strong: "재성이 강하면 돈에 대한 감각이 있고 재물 복이 있습니다. 사업 수완도 좋습니다. 남성은 여성 인연이 많을 수 있습니다. 다만 너무 강하면 물질에 집착하거나 돈 때문에 고생할 수 있습니다.",
    weak: "재성이 약하거나 없으면 돈에 대한 욕심이 적거나, 돈을 벌어도 모으기 어려울 수 있습니다. 남성은 배우자 인연이 늦거나 결혼 후 고생이 있을 수 있습니다.",
    advice: "재성이 강하면 투자나 사업보다 안정적인 저축을 권합니다. 너무 많은 것을 취하려다 오히려 잃을 수 있습니다. 재성이 약하면 식상(食傷)의 힘을 빌려 재물을 만들어야 합니다. 재능과 기술로 돈을 버는 것입니다."
  },
  관성: {
    intro: "관성(官星)은 나를 극하는 오행입니다. 편관과 정관을 합쳐서 부르는 말입니다.",
    meaning: "관성은 직장, 조직, 권위, 명예를 상징합니다. 나를 통제하고 관리하는 것들입니다. 여성에게는 남편을 의미하기도 합니다. 남성에게는 자녀를 나타냅니다.",
    strong: "관성이 강하면 조직 생활에 적합하고 책임감이 있습니다. 공직이나 대기업에서 인정받을 수 있습니다. 여성은 남편 복이 있습니다. 다만 너무 강하면 스트레스를 많이 받고 압박감에 시달릴 수 있습니다.",
    weak: "관성이 약하거나 없으면 조직보다 자유 직업이 맞습니다. 남의 밑에서 일하는 것이 불편할 수 있습니다. 여성은 결혼이 늦거나 남편과의 인연이 약할 수 있습니다.",
    advice: "관성이 강하면 스트레스 관리가 중요합니다. 완벽주의를 내려놓고 여유를 찾으세요. 관성이 약하면 프리랜서나 사업가로서의 길을 고려해보세요."
  },
  인성: {
    intro: "인성(印星)은 나를 생하는 오행입니다. 편인과 정인을 합쳐서 부르는 말입니다.",
    meaning: "인성은 학문, 지식, 자격증, 귀인을 상징합니다. 나를 낳아주고 키워주는 에너지입니다. 어머니를 나타내기도 하고, 나를 도와주는 후원자를 의미하기도 합니다.",
    strong: "인성이 강하면 학문에 재능이 있고 자격증 취득이 쉽습니다. 귀인의 도움도 많이 받습니다. 어머니 복도 있습니다. 다만 너무 강하면 생각만 많고 행동이 느려질 수 있습니다. 의존적이 될 수도 있습니다.",
    weak: "인성이 약하거나 없으면 스스로 배워야 하는 상황이 많습니다. 귀인 없이 혼자 개척해야 할 때가 많습니다. 어머니와의 인연이 약하거나 일찍 독립했을 수 있습니다.",
    advice: "인성이 강하면 공부한 것을 실천으로 옮기세요. 이론만으로는 성장에 한계가 있습니다. 인성이 약하면 멘토나 선생님을 찾아보세요. 배움의 길을 열어주는 분이 필요합니다."
  }
};

// 십신별 서술형 설명 (주요 십신 중심)
const TEN_GOD_DETAIL_NARRATIVES: Record<TenGodName, {
  character: string;
  influence: string;
  relationship: string;
}> = {
  비견: {
    character: "비견은 나와 똑같은 에너지입니다. 마치 거울에 비친 나 자신과 같습니다. 그래서 동류의식이 강하고 함께 가려는 마음이 있습니다.",
    influence: "비견이 있으면 형제, 친구 복이 있고 협력할 동료가 있습니다. 다만 같은 것을 원하기 때문에 경쟁 관계가 되기도 합니다.",
    relationship: "비견은 재성을 함께 나눠 가집니다. 친구나 형제와 재물을 나누거나 경쟁하게 되는 관계입니다."
  },
  겁재: {
    character: "겁재는 나와 오행은 같지만 음양이 다릅니다. 비견보다 더 적극적이고 경쟁심이 강합니다. 빼앗으려는 기운이 있습니다.",
    influence: "겁재가 있으면 추진력과 결단력이 강합니다. 다만 재물 손실이나 다툼에 주의해야 합니다. 친구나 동료 때문에 손해를 볼 수 있습니다.",
    relationship: "겁재는 재성을 '빼앗는' 관계입니다. 내 재물을 가져가려는 힘이 있으니 경계가 필요합니다."
  },
  식신: {
    character: "식신은 먹는 복, 표현의 복을 상징합니다. 여유롭고 낙천적인 에너지입니다. 맛있는 것을 즐기고 삶을 누리려는 마음이 있습니다.",
    influence: "식신이 있으면 복록이 있습니다. 먹고 사는 문제에 대한 걱정이 적고 여유로운 삶을 살 수 있습니다. 창의력과 표현력도 좋습니다.",
    relationship: "식신은 재성을 생합니다. 내 재능과 표현력으로 돈을 버는 구조입니다. 식신생재(食神生財)라고 해서 좋은 조합입니다."
  },
  상관: {
    character: "상관은 정관을 상하게 하는 기운입니다. 반항적이고 자유분방합니다. 틀에 얽매이기 싫어하고 자기만의 방식을 추구합니다.",
    influence: "상관이 있으면 재능이 뛰어나고 언변이 좋습니다. 다만 너무 강하면 직장 생활이 힘들거나 권위와 충돌할 수 있습니다. 여성은 남편운에 영향을 줄 수 있습니다.",
    relationship: "상관은 정관을 극합니다. 그래서 직장이나 조직과 마찰이 생길 수 있고, 여성은 남편과의 갈등이 있을 수 있습니다."
  },
  편재: {
    character: "편재는 흘러다니는 재물입니다. 고정되지 않고 움직이는 돈, 투자금, 사업 자금 같은 것입니다. 융통성 있게 돈을 굴리는 기운입니다.",
    influence: "편재가 있으면 사업 수완이 좋고 투자 감각이 있습니다. 큰돈을 다룰 수 있지만 변동도 큽니다. 남성에게는 정식 아내 외의 여성 인연을 의미하기도 합니다.",
    relationship: "편재는 관성을 생합니다. 재물로 권위와 명예를 얻을 수 있는 구조입니다."
  },
  정재: {
    character: "정재는 정해진 재물입니다. 월급, 저축, 고정 자산처럼 안정적인 돈입니다. 착실하게 모으는 기운입니다.",
    influence: "정재가 있으면 안정적인 수입이 있고 저축을 잘합니다. 실속 있는 재정 관리를 합니다. 남성에게는 아내를 의미합니다.",
    relationship: "정재도 관성을 생합니다. 안정적인 재물로 사회적 지위를 유지하는 구조입니다."
  },
  편관: {
    character: "편관은 칠살(七殺)이라고도 합니다. 나를 강하게 압박하는 기운입니다. 엄격하고 권위적인 에너지입니다.",
    influence: "편관이 있으면 카리스마가 있고 추진력이 강합니다. 다만 스트레스도 많이 받고 압박감에 시달릴 수 있습니다. 여성에게는 정식 남편이 아닌 인연을 의미하기도 합니다.",
    relationship: "편관은 일간을 극합니다. 나를 통제하고 압박하는 힘이 있으니, 잘 다스리면 성취를 이루지만 못 다스리면 힘듭니다."
  },
  정관: {
    character: "정관은 바른 관직입니다. 정당한 권위, 명예, 직장을 상징합니다. 질서와 규범을 따르는 기운입니다.",
    influence: "정관이 있으면 조직 생활에 적합하고 신용이 있습니다. 공직이나 대기업에서 인정받을 수 있습니다. 여성에게는 남편을 의미합니다.",
    relationship: "정관도 일간을 극하지만, 음양이 다르기 때문에 부드럽게 통제합니다. 서로 조화를 이루는 관계입니다."
  },
  편인: {
    character: "편인은 효신(梟神)이라고도 합니다. 특수한 학문, 영적인 관심, 비주류의 지식을 상징합니다. 깊고 독특한 사고방식입니다.",
    influence: "편인이 있으면 직관력이 있고 특수한 재능이 있습니다. 종교, 철학, 예술에 관심이 많습니다. 다만 도식(倒食)이라고 해서 식신을 해치면 복록이 줄어들 수 있습니다.",
    relationship: "편인은 식신을 극합니다. 그래서 편인이 강하면 식신의 복록을 빼앗기도 합니다."
  },
  정인: {
    character: "정인은 바른 인장입니다. 학문, 자격증, 어머니, 귀인을 상징합니다. 나를 키워주고 돌봐주는 기운입니다.",
    influence: "정인이 있으면 학문 복이 있고 귀인의 도움을 받습니다. 자격증 취득이 쉽고 어머니 복도 있습니다. 지혜롭고 인정받는 삶을 살 수 있습니다.",
    relationship: "정인은 비겁을 생합니다. 나를 강하게 해주는 후원자 역할입니다."
  }
};

// 주도 십신 × 성별 × 신강/신약 조합별 상세 서술 (10십신 × 2성별 × 3신강신약 = 60조합)
const DOMINANT_GOD_STRENGTH_NARRATIVES: Record<TenGodName, Record<Gender, Record<"신강" | "신약" | "중화", {
  lifePattern: string;
  careerDirection: string;
  relationshipStyle: string;
  advicePoint: string;
}>>> = {
  비견: {
    male: {
      신강: {
        lifePattern: "비견이 주도하고 신강한 남성은 독립심이 매우 강합니다. 남에게 기대시기보다 스스로 개척하려는 의지가 대단합니다. 마치 혼자서도 산을 넘을 수 있는 분처럼, 어떤 어려움이 와도 자신의 힘으로 헤쳐나가려 합니다.",
        careerDirection: "창업이나 독립 사업이 잘 맞습니다. 남 밑에서 일하는 것보다 본인이 결정권을 가지는 환경이 좋습니다. 파트너십보다는 단독 경영이 맞고, 팀을 이끌더라도 최종 결정은 본인이 하는 구조가 좋습니다.",
        relationshipStyle: "친구나 형제와 경쟁 관계가 될 수 있습니다. 가까운 사람일수록 서로 비교하거나 앞서가려는 마음이 생기실 수 있습니다. 양보하고 협력하는 연습이 필요합니다.",
        advicePoint: "고집이 너무 세면 주변이 힘들어집니다. 강함 속에 유연함을 갖추면 더 큰 성공을 거두실 수 있습니다. 재성(財星)의 기운으로 에너지를 발산하면 좋습니다."
      },
      신약: {
        lifePattern: "비견이 주도하지만 신약한 남성은 협력이 필요한 사람입니다. 비견의 에너지로 독립하고 싶지만, 혼자서는 힘에 부칠 수 있습니다. 든든한 동료나 파트너와 함께하는 것이 좋습니다.",
        careerDirection: "혼자 사업을 하기보다 동업자나 팀과 함께하는 것이 안정적입니다. 좋은 파트너를 만나면 서로의 부족함을 채워줄 수 있습니다. 네트워크와 인맥이 중요합니다.",
        relationshipStyle: "형제나 친구의 도움을 많이 받는 편입니다. 때로는 의존적이라는 소리를 들을 수 있지만, 그만큼 관계를 소중히 여기신다는 뜻이기도 합니다.",
        advicePoint: "자신감을 키우는 것이 중요합니다. 작은 성공 경험을 쌓으면서 스스로에 대한 믿음을 높여가세요. 인성(印星)의 기운이 도움이 됩니다."
      },
      중화: {
        lifePattern: "비견이 주도하고 중화를 이룬 남성은 독립과 협력의 균형을 잘 잡는 사람입니다. 혼자서도 잘하지만 필요할 때는 함께할 줄도 압니다.",
        careerDirection: "독립 사업도, 조직 생활도 모두 가능합니다. 상황에 따라 유연하게 선택하면 됩니다. 어떤 환경에서도 자신만의 영역을 만들 수 있습니다.",
        relationshipStyle: "형제나 친구와 건강한 경쟁과 협력 관계를 유지합니다. 서로 자극하면서도 도와주는 좋은 관계가 가능합니다.",
        advicePoint: "균형을 유지하시되, 때로는 결단이 필요한 순간에 주저하지 마세요. 중용은 좋지만 핵심적인 순간에는 분명한 선택이 필요합니다."
      }
    },
    female: {
      신강: {
        lifePattern: "비견이 주도하고 신강한 여성은 당당하고 주관이 뚜렷합니다. 남에게 의지하기보다 스스로 해결하려는 의지가 강합니다. 사회적으로도 자신만의 영역을 개척하는 사람입니다.",
        careerDirection: "전문직이나 사업가로서 능력을 발휘합니다. 경쟁이 치열한 환경에서도 밀리지 않고, 오히려 그런 환경에서 더 빛을 발합니다.",
        relationshipStyle: "자매나 여성 친구와 경쟁 관계가 될 수 있습니다. 남성 파트너보다 강한 면이 있어서 관계에서 주도권을 쥐는 경우가 많습니다.",
        advicePoint: "너무 강하면 오히려 외로워질 수 있습니다. 파트너에게 의지하는 것도 관계의 일부입니다. 재성으로 기운을 발산하면서 부드러움도 갖추면 좋겠습니다."
      },
      신약: {
        lifePattern: "비견이 주도하지만 신약한 여성은 자매나 여성 친구들의 도움을 많이 받는 사람입니다. 함께할 때 더 힘을 발휘하고, 든든한 여성 동료가 있으면 자신감이 높아집니다.",
        careerDirection: "여성 중심의 조직이나 팀에서 일하는 것이 좋습니다. 멘토가 되어줄 선배 여성을 찾으시거나, 서로 도울 수 있는 동료들과 함께하면 성장합니다.",
        relationshipStyle: "자매나 친구에게 의지하는 면이 있습니다. 남성 파트너보다 여성 친구들과의 관계가 더 편할 수 있습니다.",
        advicePoint: "자신감을 키우는 것이 중요합니다. 비교하지 말고 본인만의 강점을 찾아가세요. 인성의 기운이 자아를 강하게 해줍니다."
      },
      중화: {
        lifePattern: "비견이 주도하고 중화를 이룬 여성은 독립심과 협력심의 균형이 좋습니다. 혼자서도 잘하지만 함께하면 더 큰 시너지를 냅니다.",
        careerDirection: "다양한 환경에서 적응할 수 있습니다. 팀워크도 좋고 리더십도 있으니, 상황에 맞게 역할을 바꾸실 수 있습니다.",
        relationshipStyle: "자매나 친구들과 건강한 관계를 유지합니다. 서로 경쟁하면서도 응원하는 좋은 관계가 가능합니다.",
        advicePoint: "균형 잡힌 상태를 유지하시되, 필요할 때는 과감하게 결정하는 것도 중요합니다."
      }
    }
  },
  겁재: {
    male: {
      신강: {
        lifePattern: "겁재가 주도하고 신강한 남성은 추진력과 결단력이 대단합니다. 원하는 것을 얻기 위해 과감하게 행동하고, 경쟁에서 지지 않으려는 마음이 강합니다.",
        careerDirection: "공격적인 사업이나 영업 분야에서 성과를 냅니다. 경쟁이 치열한 환경에서 더 힘을 발휘하고, 빠른 결정과 실행력이 필요한 분야가 맞습니다.",
        relationshipStyle: "재물이나 사람을 두고 경쟁하는 경우가 많습니다. 친구 때문에 손해를 보시거나, 동업에서 갈등이 생기실 수 있습니다. 신뢰할 수 있는 사람을 가려내는 것이 중요합니다.",
        advicePoint: "너무 앞만 보고 달리시다 보면 놓치는 것이 많습니다. 가끔은 멈춰서 주변을 돌아보고, 재물보다 사람을 먼저 생각하면 좋겠습니다."
      },
      신약: {
        lifePattern: "겁재가 주도하지만 신약한 남성은 욕심은 있지만 실행력이 따라가지 못하는 경우가 있습니다. 과감하게 움직이시려 하지만 결과가 기대에 못 미칠 수 있습니다.",
        careerDirection: "혼자 무리하기보다 든든한 지원을 받는 것이 좋습니다. 큰 베팅보다는 안정적인 수익을 추구하고, 점진적으로 성장해가는 전략이 필요합니다.",
        relationshipStyle: "형제나 친구에게 휘둘리시기 쉽습니다. 경계를 분명히 하고, 본인의 것을 지키는 연습이 필요합니다.",
        advicePoint: "겁재의 과감함은 장점이지만, 신약한 상태에서는 무리하면 탈이 납니다. 인성의 기운으로 자아를 강화하면서 차분히 준비하세요."
      },
      중화: {
        lifePattern: "겁재가 주도하고 중화를 이룬 남성은 추진력과 신중함의 균형이 있습니다. 과감하게 행동하면서도 상황을 살피는 지혜가 있습니다.",
        careerDirection: "적절한 리스크를 감수하면서 성장해가는 분야가 맞습니다. 너무 안정적이면 답답하고, 너무 공격적이면 무리가 가니 적당한 긴장감이 있는 환경이 좋습니다.",
        relationshipStyle: "경쟁하면서도 협력할 줄 압니다. 형제나 친구와 건강한 관계를 유지하면서 서로 자극하는 관계가 가능합니다.",
        advicePoint: "균형을 유지하시되, 정말 중요한 순간에는 과감하게 승부를 거는 것도 필요합니다."
      }
    },
    female: {
      신강: {
        lifePattern: "겁재가 주도하고 신강한 여성은 목표를 향해 돌진하는 사람입니다. 경쟁심이 강하고, 원하는 것을 얻기 위해 과감하게 행동합니다.",
        careerDirection: "경쟁이 치열한 분야에서 두각을 나타냅니다. 영업, 마케팅, 사업 등에서 성과를 내고, 남성 중심의 환경에서도 밀리지 않습니다.",
        relationshipStyle: "연애에서도 경쟁하는 경향이 있습니다. 원하는 상대를 적극적으로 쟁취하려 하고, 다른 여성을 라이벌로 보시기도 합니다.",
        advicePoint: "너무 경쟁적이면 관계가 피곤해지실 수 있습니다. 때로는 양보하고 물러서는 것도 지혜입니다."
      },
      신약: {
        lifePattern: "겁재가 주도하지만 신약한 여성은 경쟁하고 싶으시지만 체력이나 자원이 따라가지 못할 수 있습니다. 무리하지 말고 본인의 페이스를 유지하는 것이 중요합니다.",
        careerDirection: "무리한 경쟁보다는 틈새시장을 찾는 것이 좋습니다. 본인만의 강점을 살려 차별화하면 굳이 치열하게 경쟁하지 않아도 됩니다.",
        relationshipStyle: "다른 여성과 비교하면서 스트레스 받으시지 마세요. 본인만의 매력을 찾아가면 됩니다.",
        advicePoint: "겁재의 욕심을 잘 조절하면서 본인에게 맞는 속도로 가세요. 인성의 기운으로 내면을 채워가면 좋습니다."
      },
      중화: {
        lifePattern: "겁재가 주도하고 중화를 이룬 여성은 적절한 경쟁심과 협력심을 갖추고 있습니다. 필요할 때 과감하게 나서면서도 상황을 살피는 균형이 있습니다.",
        careerDirection: "다양한 분야에서 성과를 내실 수 있습니다. 경쟁이 필요하면 경쟁하고, 협력이 필요하면 협력하는 유연함이 있습니다.",
        relationshipStyle: "건강한 경쟁과 우정의 균형을 유지합니다. 라이벌이면서 친구인 관계도 가능합니다.",
        advicePoint: "균형을 유지하면서 본인만의 영역을 확대해가면 좋겠습니다."
      }
    }
  },
  식신: {
    male: {
      신강: {
        lifePattern: "식신이 주도하고 신강한 남성은 여유롭고 낙천적입니다. 먹고 말고 즐기는 것을 좋아하고, 삶을 누리시려는 마음이 있습니다. 스트레스를 잘 받지 않고 편안하게 살아가는 사람입니다.",
        careerDirection: "요식업, 문화예술, 엔터테인먼트 등 즐거움과 관련된 분야가 잘 맞습니다. 창작 활동이나 콘텐츠 제작에서 재능을 발휘하고, 사람들에게 즐거움을 주는 일이 적성에 맞습니다.",
        relationshipStyle: "편안하고 유쾌한 관계를 추구합니다. 친구들에게 인기가 많고, 함께 있으면 즐거운 분위기를 만듭니다.",
        advicePoint: "너무 편하게만 살려고 하면 성장이 느려질 수 있습니다. 가끔은 불편함도 감수하면서 도전하는 것이 필요합니다."
      },
      신약: {
        lifePattern: "식신이 주도하지만 신약한 남성은 표현하고 싶은 것은 많으시지만 기력이 따라가지 못할 수 있습니다. 창의력은 있지만 실행에 어려움을 느낄 수 있습니다.",
        careerDirection: "체력 소모가 적은 창작 활동이 좋습니다. 글쓰기, 디자인, 기획 등 아이디어를 내는 역할이 적합하고, 실행은 다른 분과 함께하는 것이 좋습니다.",
        relationshipStyle: "편안한 관계를 원하지만 에너지가 부족하여 적극적으로 나서기 어려울 수 있습니다. 먼저 다가와주는 분과 잘 맞습니다.",
        advicePoint: "인성의 기운으로 기력을 보충하고, 무리하지 않으면서 꾸준히 창작 활동을 해나가면 좋습니다."
      },
      중화: {
        lifePattern: "식신이 주도하고 중화를 이룬 남성은 여유와 실행력의 균형이 좋습니다. 즐기면서도 생산적인 활동을 할 수 있습니다.",
        careerDirection: "창작과 사업을 연결하는 분야가 잘 맞습니다. 콘텐츠 사업, 요식업 경영 등에서 성과를 내실 수 있습니다.",
        relationshipStyle: "편안하면서도 활기찬 관계를 유지합니다. 함께 있으면 즐겁고 편안한 사람입니다.",
        advicePoint: "균형을 유지하면서 창의력을 재물로 연결하는 것이 좋습니다. 식신생재(食神生財)의 흐름을 만드세요."
      }
    },
    female: {
      신강: {
        lifePattern: "식신이 주도하고 신강한 여성은 표현력이 풍부하고 창의적입니다. 예술적 감각이 뛰어나고, 자녀를 잘 양육하는 어머니 상이기도 합니다.",
        careerDirection: "예술, 교육, 요리, 뷰티 등의 분야에서 재능을 발휘합니다. 자신만의 스타일을 가지고, 그것을 표현하는 일이 적성에 맞습니다.",
        relationshipStyle: "밝고 따뜻한 분위기를 만드는 사람입니다. 주변 사람들에게 편안함을 주고, 배려심이 깊습니다. 자녀에게 헌신적입니다.",
        advicePoint: "너무 편안한 것만 추구하면 성장이 느려질 수 있습니다. 가끔은 도전하고 불편함도 감수하는 것이 필요합니다."
      },
      신약: {
        lifePattern: "식신이 주도하지만 신약한 여성은 창의력은 있지만 체력이 따라가지 못할 수 있습니다. 자녀 양육에서도 힘에 부치는 면이 있을 수 있습니다.",
        careerDirection: "체력 소모가 적은 창작 활동이 좋습니다. 도움을 받을 수 있는 환경에서 일하는 것이 좋고, 무리하지 않는 것이 중요합니다.",
        relationshipStyle: "돌봐주고 싶은 마음은 있지만 에너지가 부족할 수 있습니다. 도와주는 분이 곁에 있면 좋습니다.",
        advicePoint: "인성의 기운으로 기력을 보충하고, 건강 관리에 신경 쓰면서 창작 활동을 해나가면 좋습니다."
      },
      중화: {
        lifePattern: "식신이 주도하고 중화를 이룬 여성은 창의력과 실행력의 균형이 좋습니다. 표현하면서도 실질적인 성과를 내실 수 있습니다.",
        careerDirection: "다양한 창작 분야에서 성공할 수 있습니다. 자녀 양육과 일을 병행하는 것도 가능합니다.",
        relationshipStyle: "따뜻하면서도 활기찬 분위기를 만듭니다. 자녀에게도 좋은 어머니이면서 자신의 일도 할 수 있습니다.",
        advicePoint: "균형을 유지하면서 창의력을 다양한 방식으로 발휘해 나가면 좋겠습니다."
      }
    }
  },
  상관: {
    male: {
      신강: {
        lifePattern: "상관이 주도하고 신강한 남성은 말재주가 뛰어나고 재능이 많습니다. 틀에 얽매이는 것을 싫어하고, 자유분방하게 살아가려 합니다. 권위에 도전하는 면이 있습니다.",
        careerDirection: "창작, 연예, 법조, 언론 등에서 재능을 발휘합니다. 남들이 하지 못하는 것을 해내는 능력이 있습니다. 다만 조직 생활은 맞지 않을 수 있습니다.",
        relationshipStyle: "자유로운 연애를 선호합니다. 구속받는 것을 싫어하고, 본인 방식대로 관계를 이끌어가려 합니다.",
        advicePoint: "너무 반항적이면 적을 만들 수 있습니다. 재능은 인정하시되, 겸손함도 함께 갖추면 더 멀리 가실 수 있습니다."
      },
      신약: {
        lifePattern: "상관이 주도하지만 신약한 남성은 하고 싶은 말은 많으시지만 현실에서 실현되기 어려울 수 있습니다. 불만은 많으시지만 바꾸시기 어려운 상황에 처할 수 있습니다.",
        careerDirection: "조용히 재능을 발휘하는 분야가 좋습니다. 글쓰기, 창작 등 혼자 작업하는 분야에서 성과를 내고, 대외 활동은 조심하는 것이 좋습니다.",
        relationshipStyle: "속마음을 표현하기 어려워할 수 있습니다. 이해해주는 파트너를 만나면 관계가 편해집니다.",
        advicePoint: "상관의 에너지를 건강하게 표현하는 방법을 찾으세요. 글쓰기나 예술 활동으로 승화하면 좋습니다."
      },
      중화: {
        lifePattern: "상관이 주도하고 중화를 이룬 남성은 재능과 현실감각의 균형이 있습니다. 자유롭게 표현하면서도 상황을 살피는 지혜가 있습니다.",
        careerDirection: "창작과 사업을 연결하는 분야에서 성공할 수 있습니다. 재능을 인정받으면서도 현실적인 성과를 내실 수 있습니다.",
        relationshipStyle: "자유로우면서도 책임감 있는 파트너입니다. 상대방을 존중하면서도 본인의 영역은 지킵니다.",
        advicePoint: "균형을 유지하면서 재능을 다양한 방식으로 발휘해 나가면 좋겠습니다."
      }
    },
    female: {
      신강: {
        lifePattern: "상관이 주도하고 신강한 여성은 말재주와 표현력이 뛰어납니다. 당당하고 자신감이 넘치시며, 남성에게 밀리지 않는 강인함이 있습니다.",
        careerDirection: "연예, 방송, 법조, 창작 분야에서 두각을 나타냅니다. 말로 먹고사는 분야가 적성에 맞고, 대중 앞에 서는 일도 잘합니다.",
        relationshipStyle: "연애에서 남성보다 우위에 서시려는 경향이 있습니다. 상관이 정관을 극하기 때문에 남편운에 영향을 줄 수 있습니다. 표현을 조절하는 것이 필요합니다.",
        advicePoint: "언행을 조심하면 남편 복도 좋아집니다. 재능은 살리되, 관계에서는 배려와 양보도 연습하세요."
      },
      신약: {
        lifePattern: "상관이 주도하지만 신약한 여성은 하고 싶은 말은 많으시지만 현실에서 표현하기 어려울 수 있습니다. 답답함을 느낄 수 있습니다.",
        careerDirection: "조용히 재능을 발휘하는 분야가 좋습니다. 글쓰기, 예술 창작 등에서 본인의 생각을 표현하면 됩니다.",
        relationshipStyle: "속마음을 표현하기 어려워할 수 있습니다. 이해해주는 파트너를 만나면 관계가 편해집니다.",
        advicePoint: "상관의 에너지를 건강하게 표현하는 방법을 찾으세요. 인성의 기운으로 자아를 강화하면서 표현력을 키워가면 좋습니다."
      },
      중화: {
        lifePattern: "상관이 주도하고 중화를 이룬 여성은 표현력과 배려의 균형이 있습니다. 당당하게 말하면서도 상대방을 존중하는 자세가 있습니다.",
        careerDirection: "다양한 분야에서 재능을 발휘할 수 있습니다. 표현이 필요한 분야에서 성과를 내면서도 관계도 잘 유지합니다.",
        relationshipStyle: "자신감 있면서도 배려심 있는 파트너입니다. 남편과 건강한 관계를 유지할 수 있습니다.",
        advicePoint: "균형을 유지하면서 재능과 관계 모두 챙겨가면 좋겠습니다."
      }
    }
  },
  편재: {
    male: {
      신강: {
        lifePattern: "편재가 주도하고 신강한 남성은 돈에 대한 감각이 뛰어나고 사업 수완이 좋습니다. 흘러다니는 돈을 잡는 능력이 있고, 투자나 사업에서 성과를 냅니다.",
        careerDirection: "사업, 투자, 무역, 금융 등에서 성공할 수 있습니다. 큰돈을 다루는 일이 적성에 맞고, 리스크를 감수하면서 수익을 내는 능력이 있습니다.",
        relationshipStyle: "여성 인연이 많을 수 있습니다. 편재는 정처(아내) 외의 여성을 의미하기도 하므로, 바람끼가 있을 수 있습니다. 한 여성에 집중하는 것이 가정의 평화를 지키는 길입니다.",
        advicePoint: "돈도 중요하지만 가정도 중요합니다. 사업에만 몰두하다 보면 가정을 잃을 수 있습니다. 균형을 유지하세요."
      },
      신약: {
        lifePattern: "편재가 주도하지만 신약한 남성은 돈에 대한 욕심은 있지만 다루는 능력이 부족할 수 있습니다. 투자에서 손해를 보시거나 돈이 새어나가실 수 있습니다.",
        careerDirection: "큰 투자보다는 안정적인 수입을 추구하는 것이 좋습니다. 사업보다는 전문직으로 안정된 수입을 만드는 것이 안전합니다.",
        relationshipStyle: "여성에게 약하거나 여성 때문에 손해를 볼 수 있습니다. 경계심을 가지고 신중하게 관계를 맺는 것이 좋습니다.",
        advicePoint: "편재의 욕심을 조절하고, 인성의 기운으로 자아를 강화하면서 안정적인 재물운을 만들어가세요."
      },
      중화: {
        lifePattern: "편재가 주도하고 중화를 이룬 남성은 사업 감각과 안정감의 균형이 있습니다. 적절한 리스크를 감수하면서 수익을 내는 능력이 있습니다.",
        careerDirection: "사업과 투자에서 적절한 성과를 내실 수 있습니다. 너무 과감하지도, 너무 소심하지도 않게 재물을 다룹니다.",
        relationshipStyle: "여성 인연과 가정의 균형을 잘 유지할 수 있습니다. 아내를 소중히 여기면서도 사회 활동도 활발하게 합니다.",
        advicePoint: "균형을 유지하면서 재물과 가정 모두 챙겨가면 좋겠습니다."
      }
    },
    female: {
      신강: {
        lifePattern: "편재가 주도하고 신강한 여성은 재물 감각이 뛰어나고 사업 수완이 좋습니다. 경제적으로 독립하려는 의지가 강하고, 스스로 돈을 벌어 쓰는 것을 좋아합니다.",
        careerDirection: "사업, 투자, 금융 분야에서 성공할 수 있습니다. 남성 못지않은 비즈니스 감각으로 성과를 냅니다.",
        relationshipStyle: "시어머니와의 관계가 복잡할 수 있습니다. 편재는 시어머니를 의미하기도 하는데, 강한 성격 때문에 갈등이 생기실 수 있습니다.",
        advicePoint: "경제적 독립은 좋지만 가정의 화목도 중요합니다. 시어머니와의 관계를 원만히 유지하려는 노력이 필요합니다."
      },
      신약: {
        lifePattern: "편재가 주도하지만 신약한 여성은 재물에 대한 욕심은 있지만 다루는 능력이 부족할 수 있습니다. 돈 문제로 스트레스를 받을 수 있습니다.",
        careerDirection: "안정적인 수입을 추구하는 것이 좋습니다. 큰 투자보다는 저축과 안전한 재테크를 권합니다.",
        relationshipStyle: "시어머니에게 눌리시거나 재정 문제로 갈등이 생기실 수 있습니다. 경제적 독립을 위해 노력하면 좋습니다.",
        advicePoint: "편재의 욕심을 조절하고, 인성의 기운으로 자아를 강화하면서 안정적인 재물운을 만들어가세요."
      },
      중화: {
        lifePattern: "편재가 주도하고 중화를 이룬 여성은 재물 감각과 안정감의 균형이 있습니다. 적절하게 돈을 관리하면서 성장해갑니다.",
        careerDirection: "사업과 직장 모두에서 성과를 내실 수 있습니다. 재정적으로 안정되면서도 성장하는 구조를 만듭니다.",
        relationshipStyle: "시어머니와의 관계도 원만히 유지하면서 경제적 독립도 이룰 수 있습니다.",
        advicePoint: "균형을 유지하면서 재물과 가정 모두 챙겨가면 좋겠습니다."
      }
    }
  },
  정재: {
    male: {
      신강: {
        lifePattern: "정재가 주도하고 신강한 남성은 안정적인 재물운을 가지고 있습니다. 저축과 관리에 능하고, 착실하게 재산을 모아가는 사람입니다.",
        careerDirection: "안정적인 직장이나 사업에서 성과를 냅니다. 급여 생활자로서 승진하거나, 안정적인 사업으로 꾸준히 수익을 냅니다.",
        relationshipStyle: "아내에게 헌신적이고 가정을 소중히 여깁니다. 정재는 본처를 의미하므로 결혼 후 안정적인 가정을 꾸리실 수 있습니다.",
        advicePoint: "안정은 좋지만 너무 보수적이면 성장이 느려질 수 있습니다. 가끔은 도전도 필요합니다."
      },
      신약: {
        lifePattern: "정재가 주도하지만 신약한 남성은 안정된 재물을 원하지만 유지하기 어려울 수 있습니다. 저축해도 새어나가시거나 뜻대로 되지 않을 수 있습니다.",
        careerDirection: "안정적인 조직에 소속되는 것이 좋습니다. 혼자 사업하기보다 조직의 보호를 받으면서 경력을 쌓는 것이 안전합니다.",
        relationshipStyle: "아내에게 의지하는 면이 있을 수 있습니다. 경제적으로 아내의 도움을 받으시거나 아내가 더 능력이 있을 수 있습니다.",
        advicePoint: "정재의 안정감을 유지하면서 인성의 기운으로 자아를 강화하면 재물운도 좋아집니다."
      },
      중화: {
        lifePattern: "정재가 주도하고 중화를 이룬 남성은 안정과 성장의 균형이 좋습니다. 저축하면서도 적절한 투자로 재산을 불려갑니다.",
        careerDirection: "안정적인 직장에서 승진하거나, 안정적인 사업으로 성장하는 구조가 가능합니다.",
        relationshipStyle: "아내와 동반자적 관계를 유지합니다. 함께 재산을 모고 가정을 꾸려가는 좋은 관계입니다.",
        advicePoint: "균형을 유지하면서 가정과 재물 모두 성장시켜 나가면 좋겠습니다."
      }
    },
    female: {
      신강: {
        lifePattern: "정재가 주도하고 신강한 여성은 실속 있게 재물을 관리하는 사람입니다. 저축을 잘하고 가정경제를 안정적으로 이끌어갑니다.",
        careerDirection: "재정 관리, 회계, 안정적인 사업 등에서 능력을 발휘합니다. 착실하게 일하면서 재산을 모아갑니다.",
        relationshipStyle: "시어머니와 원만한 관계를 유지할 수 있습니다. 정재는 시어머니(정모)를 의미하기도 하는데, 안정적인 관계가 가능합니다.",
        advicePoint: "너무 실속만 챙기면 삶이 팍팍해질 수 있습니다. 가끔은 여유롭게 즐기는 것도 필요합니다."
      },
      신약: {
        lifePattern: "정재가 주도하지만 신약한 여성은 안정된 재물을 원하지만 관리가 어려울 수 있습니다. 저축해도 새어나가는 경우가 있습니다.",
        careerDirection: "안정적인 조직에서 일하는 것이 좋습니다. 혼자 사업하기보다 조직의 지원을 받으면서 일하는 것이 안전합니다.",
        relationshipStyle: "시어머니에게 의존하거나 시어머니의 도움을 받을 수 있습니다. 좋은 관계를 유지하면 경제적으로도 도움이 됩니다.",
        advicePoint: "정재의 안정감을 유지하면서 인성의 기운으로 자아를 강화하면 재물운도 좋아집니다."
      },
      중화: {
        lifePattern: "정재가 주도하고 중화를 이룬 여성은 안정과 성장의 균형이 좋습니다. 착실하게 재산을 모으면서도 여유를 즐기는 사람입니다.",
        careerDirection: "다양한 분야에서 안정적인 성과를 내실 수 있습니다. 재정 관리와 일의 균형을 잘 잡습니다.",
        relationshipStyle: "시어머니와 좋은 관계를 유지하면서 가정경제도 잘 이끌어갑니다.",
        advicePoint: "균형을 유지하면서 가정과 재물 모두 성장시켜 나가면 좋겠습니다."
      }
    }
  },
  편관: {
    male: {
      신강: {
        lifePattern: "편관이 주도하고 신강한 남성은 카리스마가 있고 추진력이 강합니다. 어려운 상황에서도 밀어붙이는 힘이 있고, 위기에 강한 사람입니다.",
        careerDirection: "군경, 검찰, 기업 임원 등 권위와 결단이 필요한 분야에서 성공합니다. 위기관리에 뛰어나고 강한 조직을 이끄는 능력이 있습니다.",
        relationshipStyle: "자녀(특히 아들)와의 관계가 중요합니다. 편관은 남성에게 자녀를 의미하기도 합니다. 엄격한 아버지가 될 수 있습니다.",
        advicePoint: "너무 강하게 밀어붙이면 주변이 힘들어합니다. 부드러움과 배려도 함께 갖추면 더 큰 리더가 될 수 있습니다."
      },
      신약: {
        lifePattern: "편관이 주도하지만 신약한 남성은 압박감에 시달리실 수 있습니다. 직장이나 사회에서 스트레스를 많이 받고, 건강에도 영향을 줄 수 있습니다.",
        careerDirection: "너무 압박이 심한 환경은 피하는 것이 좋습니다. 적당한 긴장감이 있으면서도 본인을 지켜줄 수 있는 조직에서 일하는 것이 좋습니다.",
        relationshipStyle: "자녀와의 관계에서 힘에 부치실 수 있습니다. 인성의 도움을 받으면 관계가 편해집니다.",
        advicePoint: "편관의 압박을 인성으로 다스리면 됩니다. 관인상생(官印相生)의 흐름을 만들어 스트레스를 지혜로 바꾸세요."
      },
      중화: {
        lifePattern: "편관이 주도하고 중화를 이룬 남성은 카리스마와 유연함의 균형이 있습니다. 강하게 나서실 때도, 물러서실 때도 압니다.",
        careerDirection: "다양한 분야에서 리더십을 발휘할 수 있습니다. 권위가 필요한 상황에서 적절하게 대처합니다.",
        relationshipStyle: "자녀와 엄격하면서도 따뜻한 관계를 유지할 수 있습니다. 필요할 때 엄하고, 필요할 때 부드럽습니다.",
        advicePoint: "균형을 유지하면서 카리스마와 배려 모두 갖추면 좋겠습니다."
      }
    },
    female: {
      신강: {
        lifePattern: "편관이 주도하고 신강한 여성은 강인하고 당당합니다. 남성에게 밀리지 않고 사회에서 능력을 인정받습니다.",
        careerDirection: "권위가 필요한 분야에서 성공합니다. 관리직, 전문직 등에서 능력을 발휘하고 조직을 이끄는 역할도 잘합니다.",
        relationshipStyle: "편관은 여성에게 비정규적 남성 인연을 의미합니다. 정관(정식 남편)보다 편관(애인, 내연남) 인연이 먼저 오실 수 있습니다. 결혼이 늦어지시거나 복잡한 연애를 경험할 수 있습니다.",
        advicePoint: "연애에서 급하게 결정하지 말고 정관 인연을 기다리는 것이 가정의 안정에 좋습니다. 일에서는 능력을 마음껏 발휘하세요."
      },
      신약: {
        lifePattern: "편관이 주도하지만 신약한 여성은 남성에게 압박을 받으시거나 직장에서 스트레스를 많이 받을 수 있습니다. 힘에 부치는 상황이 생기실 수 있습니다.",
        careerDirection: "너무 압박이 심한 환경은 피하는 것이 좋습니다. 편안한 분위기에서 일하는 것이 건강에도 좋습니다.",
        relationshipStyle: "남성 인연이 복잡하거나 남성에게 상처를 받을 수 있습니다. 신중하게 인연을 선택하는 것이 중요합니다.",
        advicePoint: "편관의 압박을 인성으로 다스리면 됩니다. 관인상생의 흐름을 만들어 스트레스를 지혜로 바꾸고, 건강한 인연을 만나세요."
      },
      중화: {
        lifePattern: "편관이 주도하고 중화를 이룬 여성은 강인함과 유연함의 균형이 있습니다. 상황에 맞게 대처하는 지혜가 있습니다.",
        careerDirection: "다양한 분야에서 능력을 발휘할 수 있습니다. 권위가 필요한 상황에서 적절하게 대처합니다.",
        relationshipStyle: "남성 인연을 적절하게 관리할 수 있습니다. 복잡한 인연보다 안정적인 관계를 선택하는 지혜가 있습니다.",
        advicePoint: "균형을 유지하면서 일과 연애 모두 건강하게 가꿔가면 좋겠습니다."
      }
    }
  },
  정관: {
    male: {
      신강: {
        lifePattern: "정관이 주도하고 신강한 남성은 책임감이 강하고 신용이 있습니다. 조직에서 인정받고 승진하는 사람입니다. 질서와 규범을 중시합니다.",
        careerDirection: "공무원, 대기업, 법조계 등에서 성공합니다. 안정적인 직장에서 꾸준히 성장하고 높은 자리에 오를 수 있습니다.",
        relationshipStyle: "가정에서 책임감 있는 가장 역할을 합니다. 자녀(특히 딸)와의 관계도 좋고, 가족을 위해 헌신합니다.",
        advicePoint: "너무 경직되면 유연성이 부족해집니다. 원칙도 중요하지만 상황에 따라 융통성도 발휘하면 좋겠습니다."
      },
      신약: {
        lifePattern: "정관이 주도하지만 신약한 남성은 직장에서 압박을 받으시거나 책임이 무거우실 수 있습니다. 성실하게 일하지만 인정받기 어려울 수 있습니다.",
        careerDirection: "너무 책임이 큰 자리보다는 본인 역량에 맞는 자리에서 일하는 것이 좋습니다. 점진적으로 성장해가는 전략이 필요합니다.",
        relationshipStyle: "가장으로서 책임감은 있지만 힘에 부치실 수 있습니다. 가족의 도움과 이해가 필요합니다.",
        advicePoint: "정관의 책임감을 인성으로 받쳐주면 됩니다. 관인상생의 흐름을 만들어 스트레스를 지혜로 바꾸세요."
      },
      중화: {
        lifePattern: "정관이 주도하고 중화를 이룬 남성은 책임감과 유연함의 균형이 있습니다. 원칙을 지키면서도 상황에 맞게 대처합니다.",
        careerDirection: "조직에서 안정적으로 성장할 수 있습니다. 적절한 책임을 지면서 인정받습니다.",
        relationshipStyle: "가정에서 든든하면서도 유연한 가장입니다. 가족과 좋은 관계를 유지합니다.",
        advicePoint: "균형을 유지하면서 일과 가정 모두 잘 가꿔가면 좋겠습니다."
      }
    },
    female: {
      신강: {
        lifePattern: "정관이 주도하고 신강한 여성은 좋은 남편 복이 있습니다. 정관은 여성에게 남편을 의미하므로, 능력 있고 책임감 있는 배우자를 만나실 가능성이 높습니다.",
        careerDirection: "직장에서도 인정받고 승진하는 사람입니다. 조직 생활에 적합하고 안정적인 커리어를 쌓습니다.",
        relationshipStyle: "남편에게 존경받고 좋은 관계를 유지합니다. 가정을 안정적으로 이끌어가는 사람입니다.",
        advicePoint: "남편 복이 좋으니 좋은 인연을 만나면 결혼 후 행복할 수 있습니다. 너무 완벽을 추구하면 상대를 놓치실 수 있으니 적당한 때에 결정하세요."
      },
      신약: {
        lifePattern: "정관이 주도하지만 신약한 여성은 남편을 만나고 싶으시지만 인연이 늦어지실 수 있습니다. 좋은 남편이 오더라도 관계를 유지하기 어려울 수 있습니다.",
        careerDirection: "직장에서 무리하지 말고 본인 역량에 맞는 자리에서 일하는 것이 좋습니다. 점진적으로 성장해가세요.",
        relationshipStyle: "남편에게 의지하는 면이 있을 수 있습니다. 경제적, 정서적으로 남편의 도움을 받는 경우가 많습니다.",
        advicePoint: "정관의 좋은 기운을 받으시려면 인성으로 자아를 강화해야 합니다. 본인이 강해지면 좋은 남편도 옵니다."
      },
      중화: {
        lifePattern: "정관이 주도하고 중화를 이룬 여성은 남편 복과 자아의 균형이 좋습니다. 좋은 남편을 만나면서도 본인의 역할도 잘합니다.",
        careerDirection: "직장 생활과 가정 모두 잘 유지할 수 있습니다. 균형 잡힌 커리어우먼입니다.",
        relationshipStyle: "남편과 동반자적 관계를 유지합니다. 서로 존중하면서 함께 성장합니다.",
        advicePoint: "균형을 유지하면서 결혼 생활과 커리어 모두 잘 가꿔가면 좋겠습니다."
      }
    }
  },
  편인: {
    male: {
      신강: {
        lifePattern: "편인이 주도하고 신강한 남성은 직관력이 뛰어나고 독특한 사고방식을 가지고 있습니다. 특수한 분야에 재능이 있고, 일반적이지 않은 길을 가는 경우가 많습니다.",
        careerDirection: "종교, 철학, 예술, 연구 등 특수한 분야에서 성과를 냅니다. 남들이 가지 않는 길에서 성공하는 사람입니다.",
        relationshipStyle: "고독을 즐기시거나 혼자 있는 시간을 좋아합니다. 깊이 있는 관계를 선호하고, 얕은 인연은 피합니다.",
        advicePoint: "너무 편협해지면 현실과 동떨어질 수 있습니다. 세상과 소통하면서 본인의 통찰을 나누면 좋겠습니다."
      },
      신약: {
        lifePattern: "편인이 주도하지만 신약한 남성은 생각은 깊으시지만 실행력이 부족할 수 있습니다. 아이디어는 많으시지만 현실화하기 어려울 수 있습니다.",
        careerDirection: "혼자 연구하거나 창작하는 분야가 좋습니다. 실행은 다른 분과 함께하고, 본인은 아이디어를 내는 역할이 맞습니다.",
        relationshipStyle: "사회적 관계가 좁거나 고립되는 경향이 있습니다. 이해해주는 소수의 사람들과 깊은 관계를 맺으세요.",
        advicePoint: "편인의 통찰력을 살리면서 비겁의 기운으로 실행력을 보충하면 좋습니다. 함께할 동료를 찾으세요."
      },
      중화: {
        lifePattern: "편인이 주도하고 중화를 이룬 남성은 직관력과 현실감각의 균형이 있습니다. 독특한 생각을 현실에서 실현할 수 있습니다.",
        careerDirection: "특수한 분야에서 성과를 내면서도 현실적인 성공을 거두실 수 있습니다.",
        relationshipStyle: "깊이 있는 관계를 유지하면서도 사회적으로도 활동합니다. 균형 잡힌 인간관계가 가능합니다.",
        advicePoint: "균형을 유지하면서 본인만의 통찰을 세상에 나누면 좋겠습니다."
      }
    },
    female: {
      신강: {
        lifePattern: "편인이 주도하고 신강한 여성은 독특한 감각과 직관력을 가지고 있습니다. 일반적인 여성상과는 다르고, 자기만의 세계가 있는 사람입니다.",
        careerDirection: "예술, 종교, 철학, 연구 등 특수한 분야에서 재능을 발휘합니다. 남들과 다른 길에서 성공합니다.",
        relationshipStyle: "어머니(특히 친정어머니)와의 관계가 특별하거나 복잡할 수 있습니다. 편인은 편모를 의미하기도 합니다.",
        advicePoint: "독특함은 매력이지만 너무 고립되면 외로워집니다. 이해해주는 사람들과 연결되면 좋겠습니다."
      },
      신약: {
        lifePattern: "편인이 주도하지만 신약한 여성은 생각은 깊으시지만 현실에서 힘을 발휘하기 어려울 수 있습니다. 이상과 현실의 괴리를 느낄 수 있습니다.",
        careerDirection: "조용히 연구하거나 창작하는 분야가 좋습니다. 대외 활동은 최소화하고 본인의 세계에 집중하는 것이 맞습니다.",
        relationshipStyle: "사회적 관계가 좁거나 어머니와의 관계에서 어려움이 있을 수 있습니다.",
        advicePoint: "편인의 통찰력을 살리면서 비겁의 기운으로 자아를 강화하면 좋습니다."
      },
      중화: {
        lifePattern: "편인이 주도하고 중화를 이룬 여성은 직관력과 현실감각의 균형이 있습니다. 독특한 매력과 실용성을 겸비했습니다.",
        careerDirection: "특수한 분야에서 성과를 내면서도 현실적인 성공을 거두실 수 있습니다.",
        relationshipStyle: "어머니와의 관계도 원만하고, 사회적으로도 활동합니다.",
        advicePoint: "균형을 유지하면서 본인만의 통찰을 세상에 나누면 좋겠습니다."
      }
    }
  },
  정인: {
    male: {
      신강: {
        lifePattern: "정인이 주도하고 신강한 남성은 학문에 뛰어나고 지혜롭습니다. 귀인의 도움을 많이 받고, 어디서든 인정받는 사람입니다.",
        careerDirection: "학문, 연구, 교육, 전문직 등에서 성공합니다. 자격증이 도움이 되고, 지적 활동에서 능력을 발휘합니다.",
        relationshipStyle: "어머니 복이 있고, 어머니와의 관계가 좋습니다. 정인은 어머니를 의미하기도 합니다.",
        advicePoint: "생각만 하지 말고 행동으로 옮기는 것도 중요합니다. 이론과 실천의 균형을 맞추면 더 큰 성공을 거두실 수 있습니다."
      },
      신약: {
        lifePattern: "정인이 주도하지만 신약한 남성은 학문에 관심은 있지만 집중하기 어려울 수 있습니다. 귀인의 도움이 필요하지만 만나시기 어려울 수 있습니다.",
        careerDirection: "멘토를 찾고 배움의 기회를 놓치시지 마세요. 자격증 취득으로 경쟁력을 높이는 것이 좋습니다.",
        relationshipStyle: "어머니에게 의지하는 면이 있을 수 있습니다. 어머니의 도움을 받으면서 성장해가세요.",
        advicePoint: "정인의 지혜를 활용하면서 비겁의 기운으로 자아를 강화하면 좋습니다. 스스로 설 수 있는 힘을 기르세요."
      },
      중화: {
        lifePattern: "정인이 주도하고 중화를 이룬 남성은 학문과 실천의 균형이 좋습니다. 지혜로우면서도 현실적인 성과를 내는 사람입니다.",
        careerDirection: "학문과 실무를 연결하는 분야에서 성공할 수 있습니다. 이론을 현실에 적용하는 능력이 있습니다.",
        relationshipStyle: "어머니와 좋은 관계를 유지하면서도 독립적으로 살아갑니다.",
        advicePoint: "균형을 유지하면서 학문과 실천 모두 발전시켜 나가면 좋겠습니다."
      }
    },
    female: {
      신강: {
        lifePattern: "정인이 주도하고 신강한 여성은 지혜롭고 학문에 뛰어납니다. 자격증이나 전문 분야에서 인정받고, 귀인의 도움도 많이 받습니다.",
        careerDirection: "교육, 연구, 전문직 등에서 성공합니다. 학문적 성취로 사회적 인정을 받는 사람입니다.",
        relationshipStyle: "어머니와의 관계가 좋고, 어머니로부터 많은 것을 배웁니다. 지적인 가정환경에서 자랐을 가능성이 높습니다.",
        advicePoint: "학문만 추구하다 보면 결혼이 늦어지실 수 있습니다. 적당한 때에 결혼도 고려하면 좋겠습니다."
      },
      신약: {
        lifePattern: "정인이 주도하지만 신약한 여성은 학문에 관심은 있지만 집중하기 어려울 수 있습니다. 공부하고 싶으시지만 현실적 여건이 어려울 수 있습니다.",
        careerDirection: "멘토를 찾고 배움의 기회를 놓치시지 마세요. 온라인 학습이나 자격증 취득으로 경쟁력을 높이는 것이 좋습니다.",
        relationshipStyle: "어머니에게 의지하는 면이 있을 수 있습니다. 어머니의 도움을 받으면서 성장해가세요.",
        advicePoint: "정인의 지혜를 활용하면서 비겁의 기운으로 자아를 강화하면 좋습니다."
      },
      중화: {
        lifePattern: "정인이 주도하고 중화를 이룬 여성은 학문과 현실의 균형이 좋습니다. 지혜로우면서도 실용적인 사람입니다.",
        careerDirection: "학문과 실무를 연결하는 분야에서 성공할 수 있습니다.",
        relationshipStyle: "어머니와 좋은 관계를 유지하면서도 독립적으로 살아갑니다.",
        advicePoint: "균형을 유지하면서 학문과 실천 모두 발전시켜 나가면 좋겠습니다."
      }
    }
  }
};

// 기둥별 십신 의미
const PILLAR_TEN_GOD_MEANING: Record<string, Record<TenGodGroup, string>> = {
  year: {
    비겁: "조상 중 형제가 많았거나, 어린 시절 형제 친구와의 관계가 중요했습니다.",
    식상: "조상이 학문이나 예술에 재능이 있었으며, 창의적 집안 배경입니다.",
    재성: "집안이 재물 복이 있거나, 조상 덕에 재물 운이 있습니다.",
    관성: "집안에 공직자나 권위 있는 분이 있었으며, 가문의 명예가 있습니다.",
    인성: "학문을 중시하는 집안이며, 조상의 학문적 배경이 있습니다.",
  },
  month: {
    비겁: "부모 형제 관계, 사회적 인간관계에서 경쟁과 협력이 공존합니다.",
    식상: "직업적으로 창작이나 표현 활동에 적합하며, 재능을 살릴 수 있습니다.",
    재성: "직업을 통해 재물을 얻기 좋으며, 사업적 수완이 있습니다.",
    관성: "직장 생활에 적합하며, 조직에서 인정받고 승진하기 좋습니다.",
    인성: "학문이나 연구 분야에 적합하며, 자격증이 도움이 됩니다.",
  },
  day: {
    비겁: "배우자가 친구 같은 동료적 관계이며, 배우자 주변에 경쟁자가 있을 수 있습니다.",
    식상: "배우자가 창의적이거나 예술적 감각이 있으며, 자녀 복과 관련됩니다.",
    재성: "배우자를 통해 재물 운이 올 수 있으며, 배우자가 현실적입니다.",
    관성: "배우자가 책임감 있고 권위적이며, 여성은 남편 복을 의미합니다.",
    인성: "배우자가 학식이 있거나 지적이며, 정신적 교류가 중요합니다.",
  },
  hour: {
    비겁: "자녀가 형제처럼 친밀하거나, 노년에 친구 복이 있습니다.",
    식상: "자녀가 창의적이고 재능이 있으며, 노년에 여유로운 생활입니다.",
    재성: "자녀를 통해 재물 복이 있으며, 노년에 재정적 안정입니다.",
    관성: "자녀가 사회적으로 성공하며, 노년에 명예가 있습니다.",
    인성: "자녀가 학문에 뛰어나며, 노년에 지혜로운 삶입니다.",
  },
};

// ============================================
// 분석 함수
// ============================================

/**
 * 천간/지지에서 십신 판정
 */
function getTenGod(
  targetElement: FiveElementKey,
  targetYinYang: "양" | "음",
  ilganElement: FiveElementKey,
  ilganYinYang: "양" | "음"
): TenGodName {
  const relations = ELEMENT_RELATIONS[ilganElement];
  const isSameYinYang = targetYinYang === ilganYinYang;

  if (targetElement === relations.same) {
    return isSameYinYang ? "비견" : "겁재";
  }
  if (targetElement === relations.generates) {
    return isSameYinYang ? "식신" : "상관";
  }
  if (targetElement === relations.controls) {
    return isSameYinYang ? "편재" : "정재";
  }
  if (targetElement === relations.controlled) {
    return isSameYinYang ? "편관" : "정관";
  }
  if (targetElement === relations.generated) {
    return isSameYinYang ? "편인" : "정인";
  }

  return "비견"; // fallback
}

/**
 * 모든 기둥에서 십신 추출
 */
function extractAllTenGods(
  pillars: Pillar[],
  ilgan: string
): { god: TenGodName; position: string }[] {
  const ilganElement = CHEONGAN_OHENG[ilgan];
  const ilganYinYang = CHEONGAN_YINYANG[ilgan];
  const result: { god: TenGodName; position: string }[] = [];

  const pillarNames = ["년주", "월주", "일주", "시주"];

  pillars.forEach((pillar, index) => {
    const pillarName = pillarNames[index];

    // 천간 분석 (일간 자체는 "나"이므로 일주 천간은 별도 처리)
    if (pillar.cheongan) {
      if (index === 2) {
        // 일주 천간은 본인이므로 표시만
        // 십신 계산에서 제외
      } else {
        const stemElement = CHEONGAN_OHENG[pillar.cheongan];
        const stemYinYang = CHEONGAN_YINYANG[pillar.cheongan];
        const god = getTenGod(stemElement, stemYinYang, ilganElement, ilganYinYang);
        result.push({ god, position: `${pillarName} 천간(${pillar.cheongan})` });
      }
    }

    // 지지 분석 - 장간 본기의 음양을 사용하여 십성 판단
    if (pillar.jiji) {
      const mainStem = JIJI_MAIN_STEM[pillar.jiji];  // 지지의 장간 본기
      const branchElement = CHEONGAN_OHENG[mainStem];  // 본기의 오행
      const branchYinYang = CHEONGAN_YINYANG[mainStem];  // 본기의 음양 ⭐ 핵심 수정
      const god = getTenGod(branchElement, branchYinYang, ilganElement, ilganYinYang);
      result.push({ god, position: `${pillarName} 지지(${pillar.jiji})` });
    }
  });

  return result;
}

/**
 * 십신별 상세 분석 생성
 */
function buildTenGodAnalysis(
  allGods: { god: TenGodName; position: string }[],
  gender: Gender
): TenGodDetailedAnalysis[] {
  const godNames: TenGodName[] = [
    "비견", "겁재", "식신", "상관", "편재", "정재", "편관", "정관", "편인", "정인"
  ];

  return godNames.map((name) => {
    const godInstances = allGods.filter((g) => g.god === name);
    const count = godInstances.length;
    const positions = godInstances.map((g) => g.position);

    const meaning = TEN_GOD_MEANING[name];
    const genderMeaning = TEN_GOD_GENDER_MEANING[name];

    let strengthImpact = "";
    if (count === 0) {
      strengthImpact = `${name}이(가) 없어 해당 영역의 에너지가 부족합니다. ${meaning.symbolism}`;
    } else if (count === 1) {
      strengthImpact = `${name}이(가) 적정하게 있어 균형 잡힌 영향을 줍니다.`;
    } else if (count === 2) {
      strengthImpact = `${name}이(가) 다소 강하여 해당 영역에서 두드러진 특성을 보입니다.`;
    } else {
      strengthImpact = `${name}이(가) 매우 강하여(${count}개) 과도한 영향을 줄 수 있습니다. 균형이 필요합니다.`;
    }

    // 다른 십신과의 관계 분석
    let relationship = "";
    const group = TEN_GOD_GROUP[name];
    if (group === "비겁") {
      relationship = "식상을 생하고, 인성의 생을 받습니다. 재성과 경쟁 관계입니다.";
    } else if (group === "식상") {
      relationship = "재성을 생하고, 비겁의 생을 받습니다. 인성에 의해 억제됩니다.";
    } else if (group === "재성") {
      relationship = "관성을 생하고, 식상의 생을 받습니다. 비겁에 의해 극을 당합니다.";
    } else if (group === "관성") {
      relationship = "인성을 생하고, 재성의 생을 받습니다. 식상에 의해 억제됩니다.";
    } else {
      relationship = "비겁을 생하고, 관성의 생을 받습니다. 재성에 의해 극을 당합니다.";
    }

    return {
      name,
      hanja: TEN_GOD_HANJA[name],
      count,
      positions,
      basicMeaning: meaning.basic,
      genderSpecificMeaning: gender === "male" ? genderMeaning.male : genderMeaning.female,
      strengthImpact,
      relationship,
    };
  });
}

/**
 * 주도적인 십신 분석
 */
function findDominantGod(
  tenGods: TenGodDetailedAnalysis[]
): Chapter3Result["dominantGod"] {
  const sorted = [...tenGods].sort((a, b) => b.count - a.count);
  const dominant = sorted[0];

  if (dominant.count === 0) {
    return {
      name: "없음",
      influence: "특별히 두드러진 십신이 없어 균형 잡힌 사주입니다.",
    };
  }

  const meaning = TEN_GOD_MEANING[dominant.name as TenGodName];
  const influence = dominant.count >= 3
    ? `${dominant.name}(${TEN_GOD_HANJA[dominant.name as TenGodName]})이 매우 강하여 인생 전반에 큰 영향을 줍니다. ${meaning.positive.slice(0, 2).join(", ")} 등의 특성이 두드러지지만, ${meaning.negative.slice(0, 2).join(", ")} 등에 주의가 필요합니다.`
    : `${dominant.name}(${TEN_GOD_HANJA[dominant.name as TenGodName]})이 가장 강하여 ${meaning.positive.slice(0, 2).join(", ")} 등의 특성이 나타납니다.`;

  return { name: dominant.name, influence };
}

/**
 * 십신 그룹별 균형 분석
 */
function analyzeGodBalance(
  tenGods: TenGodDetailedAnalysis[]
): Chapter3Result["godBalance"] {
  const balance = {
    bigyeop: 0,
    siksang: 0,
    jaeseong: 0,
    gwanseong: 0,
    inseong: 0,
  };

  for (const god of tenGods) {
    const group = TEN_GOD_GROUP[god.name as TenGodName];
    if (group === "비겁") balance.bigyeop += god.count;
    else if (group === "식상") balance.siksang += god.count;
    else if (group === "재성") balance.jaeseong += god.count;
    else if (group === "관성") balance.gwanseong += god.count;
    else if (group === "인성") balance.inseong += god.count;
  }

  return balance;
}

/**
 * 성별별 특수 해석
 */
function analyzeGenderSpecific(
  godBalance: Chapter3Result["godBalance"],
  gender: Gender
): Chapter3Result["genderSpecificAnalysis"] {
  let jaeseongMeaning = "";
  let gwanseongMeaning = "";
  let siksangMeaning = "";

  if (gender === "male") {
    // 남성의 경우
    if (godBalance.jaeseong === 0) {
      jaeseongMeaning = "재성이 없어 배우자(아내)와의 인연이 늦거나 재물운에 노력이 필요합니다.";
    } else if (godBalance.jaeseong >= 3) {
      jaeseongMeaning = "재성이 과다하여 여성 인연이 많고 재물에 대한 욕심이 클 수 있습니다. 한 여성에 집중하는 것이 좋습니다.";
    } else {
      jaeseongMeaning = "재성이 적정하여 배우자 복이 있고 안정된 재물운을 기대할 수 있습니다.";
    }

    if (godBalance.gwanseong === 0) {
      gwanseongMeaning = "관성이 없어 직장보다는 사업이나 자유 직업이 적합하며, 자녀 운이 늦을 수 있습니다.";
    } else if (godBalance.gwanseong >= 3) {
      gwanseongMeaning = "관성이 과다하여 직장에서 스트레스를 많이 받거나 상사와의 갈등이 있을 수 있습니다.";
    } else {
      gwanseongMeaning = "관성이 적정하여 직장 생활에 적합하고 조직에서 인정받을 수 있습니다.";
    }

    if (godBalance.siksang === 0) {
      siksangMeaning = "식상이 없어 표현력이 부족하고 답답함을 느낄 수 있습니다. 생각은 깊으신데 그것을 말이나 행동으로 옮기는 것이 어려우실 수 있습니다. 속마음을 표현하지 못해 오해를 받거나 답답함이 쌓이기 쉽습니다. 글쓰기, 운동, 창작 활동 등 표현의 통로를 만들어 주면 도움이 됩니다. 건강 면에서는 폐, 기관지, 대장 등 금(金) 기운과 관련된 장기에 신경 써주세요.";
    } else if (godBalance.siksang >= 3) {
      siksangMeaning = "식상이 과다하여 말이 많고 표현이 앞서며, 관재구설에 주의해야 합니다.";
    } else {
      siksangMeaning = "식상이 적정하여 적절한 표현력과 창의력을 가집니다.";
    }
  } else {
    // 여성의 경우
    if (godBalance.jaeseong === 0) {
      jaeseongMeaning = "재성이 없어 시어머니와의 관계가 희박하거나 재물운에 노력이 필요합니다.";
    } else if (godBalance.jaeseong >= 3) {
      jaeseongMeaning = "재성이 과다하여 시어머니의 영향이 크거나 재물에 대한 욕심이 있을 수 있습니다.";
    } else {
      jaeseongMeaning = "재성이 적정하여 시어머니와의 관계가 원만하고 재물운이 안정적입니다.";
    }

    if (godBalance.gwanseong === 0) {
      gwanseongMeaning = "관성이 없어 남편과의 인연이 늦거나 자유로운 결혼 생활을 원합니다. 결혼보다 일에 집중하는 것도 방법입니다.";
    } else if (godBalance.gwanseong >= 3) {
      gwanseongMeaning = "관성이 과다하여 남성 인연이 복잡하거나 직장에서 스트레스를 받을 수 있습니다. 편관이 많으면 정관 남편보다 다른 인연이 먼저 올 수 있습니다.";
    } else {
      gwanseongMeaning = "관성이 적정하여 좋은 남편 복이 있고 안정된 결혼 생활이 기대됩니다.";
    }

    if (godBalance.siksang === 0) {
      siksangMeaning = "식상이 없어 자녀 운이 늦거나 출산에 노력이 필요할 수 있습니다. 또한 표현력이 부족하여 속마음을 드러내기 어려우실 수 있습니다. 생각은 깊으신데 말이나 행동으로 나타내는 것이 서툴러서 오해를 받기도 합니다. 답답함을 풀기 위해 취미 활동이나 창작, 글쓰기 등 표현의 출구를 만들어 주는 것이 좋습니다. 건강 면에서는 폐, 기관지, 대장 등 호흡기 계통에 특히 신경 써주세요.";
    } else if (godBalance.siksang >= 3) {
      siksangMeaning = "식상이 과다하여 자녀 복이 있지만, 상관이 많으면 남편 운에 영향을 줄 수 있으니 표현과 언행에 주의가 필요합니다.";
    } else {
      siksangMeaning = "식상이 적정하여 자녀 복이 있고 창의적 재능을 발휘할 수 있습니다.";
    }
  }

  return {
    gender,
    jaeseongMeaning,
    gwanseongMeaning,
    siksangMeaning,
  };
}

/**
 * 기둥별 십신 분석
 */
function analyzePillarGods(
  pillars: Pillar[],
  ilgan: string,
  gender: Gender
): Chapter3Result["pillarAnalysis"] {
  const ilganElement = CHEONGAN_OHENG[ilgan];
  const ilganYinYang = CHEONGAN_YINYANG[ilgan];

  const analyzePillar = (pillar: Pillar, pillarType: "year" | "month" | "day" | "hour") => {
    let stemGod = "";
    let branchGod = "";
    let meaning = "";

    if (pillar.cheongan && pillarType !== "day") {
      const stemElement = CHEONGAN_OHENG[pillar.cheongan];
      const stemYinYang = CHEONGAN_YINYANG[pillar.cheongan];
      stemGod = getTenGod(stemElement, stemYinYang, ilganElement, ilganYinYang);
    } else if (pillarType === "day") {
      stemGod = "일간(나)";
    }

    if (pillar.jiji) {
      const branchElement = JIJI_OHENG[pillar.jiji];
      const branchYinYang = JIJI_YINYANG[pillar.jiji];
      branchGod = getTenGod(branchElement, branchYinYang, ilganElement, ilganYinYang);
    }

    // 기둥별 의미 생성
    const stemGroup = stemGod && stemGod !== "일간(나)" ? TEN_GOD_GROUP[stemGod as TenGodName] : null;
    const branchGroup = branchGod ? TEN_GOD_GROUP[branchGod as TenGodName] : null;

    if (pillarType === "day") {
      if (branchGroup) {
        meaning = PILLAR_TEN_GOD_MEANING["day"][branchGroup];
        if (gender === "female" && branchGroup === "관성") {
          meaning += " 일지에 관성이 있어 배우자 자리에 남편 기운이 있습니다.";
        } else if (gender === "male" && branchGroup === "재성") {
          meaning += " 일지에 재성이 있어 배우자 자리에 아내 기운이 있습니다.";
        }
      }
    } else if (stemGroup && branchGroup) {
      meaning = `천간에 ${stemGod}, 지지에 ${branchGod}이(가) 있습니다. ${PILLAR_TEN_GOD_MEANING[pillarType][stemGroup]} ${PILLAR_TEN_GOD_MEANING[pillarType][branchGroup]}`;
    } else if (stemGroup) {
      meaning = PILLAR_TEN_GOD_MEANING[pillarType][stemGroup];
    } else if (branchGroup) {
      meaning = PILLAR_TEN_GOD_MEANING[pillarType][branchGroup];
    }

    return { stemGod, branchGod, meaning };
  };

  const yearPillar = analyzePillar(pillars[0], "year");
  const monthPillar = analyzePillar(pillars[1], "month");
  const dayPillar = analyzePillar(pillars[2], "day");
  const hourPillar = pillars[3] ? analyzePillar(pillars[3], "hour") : null;

  return { yearPillar, monthPillar, dayPillar, hourPillar };
}

/**
 * 제3장 전체 분석 실행
 */
export function analyzeChapter3(
  sajuResult: SajuApiResult,
  gender: Gender,
  sinGangSinYak?: string
): Chapter3Result {
  const { yearPillar, monthPillar, dayPillar, timePillar } = sajuResult;
  const pillars = [yearPillar, monthPillar, dayPillar, timePillar];
  const ilgan = dayPillar.cheongan;

  // 모든 십신 추출
  const allGods = extractAllTenGods(pillars, ilgan);

  // 십신별 상세 분석
  const tenGods = buildTenGodAnalysis(allGods, gender);

  // 주도적 십신
  const dominantGod = findDominantGod(tenGods);

  // 그룹별 균형
  const godBalance = analyzeGodBalance(tenGods);

  // 성별별 특수 해석
  const genderSpecificAnalysis = analyzeGenderSpecific(godBalance, gender);

  // 기둥별 분석
  const pillarAnalysis = analyzePillarGods(pillars, ilgan, gender);

  // 신강/신약 키 추출
  const strengthKey: "신강" | "신약" | "중화" = sinGangSinYak?.includes("신강") ? "신강"
    : sinGangSinYak?.includes("신약") ? "신약"
    : "중화";

  // 서술형 풀이 생성
  const narrative = generateSipseongNarrative(godBalance, dominantGod, gender, tenGods, strengthKey);

  return {
    tenGods,
    dominantGod,
    godBalance,
    genderSpecificAnalysis,
    pillarAnalysis,
    narrative,
  };
}

/**
 * 서술형 풀이 생성
 */
function generateSipseongNarrative(
  godBalance: Chapter3Result["godBalance"],
  dominantGod: Chapter3Result["dominantGod"],
  gender: Gender,
  tenGods: TenGodDetailedAnalysis[],
  strengthKey: "신강" | "신약" | "중화"
): Chapter3Result["narrative"] {
  // 가장 강한 그룹 찾기
  type BalanceKey = "bigyeop" | "siksang" | "jaeseong" | "gwanseong" | "inseong";
  const groupMap: Record<BalanceKey, TenGodGroup> = {
    bigyeop: "비겁",
    siksang: "식상",
    jaeseong: "재성",
    gwanseong: "관성",
    inseong: "인성"
  };

  const sortedGroups = Object.entries(godBalance)
    .sort((a, b) => (b[1] as number) - (a[1] as number))
    .map(([key]) => groupMap[key as BalanceKey]);

  const strongestGroup = sortedGroups[0];
  const weakestGroup = sortedGroups[sortedGroups.length - 1];

  const strongestNarrative = TEN_GOD_GROUP_NARRATIVES[strongestGroup];
  const weakestNarrative = TEN_GOD_GROUP_NARRATIVES[weakestGroup];

  // 없는 그룹 찾기
  const missingGroups = Object.entries(godBalance)
    .filter(([, count]) => count === 0)
    .map(([key]) => groupMap[key as BalanceKey]);

  // 주도 십신 정보
  const dominantName = dominantGod.name;
  const dominantDetail = (dominantName in TEN_GOD_DETAIL_NARRATIVES)
    ? TEN_GOD_DETAIL_NARRATIVES[dominantName as TenGodName]
    : null;

  // intro 생성
  const intro = `이제 십성(十星) 분석을 해보겠습니다. 십성은 사주의 각 글자가 일간(나)과 어떤 관계인지를 보여주는 것입니다. ` +
    `마치 내 주변 사람들과 환경이 나에게 어떤 영향을 주는지를 알려주는 것입니다.`;

  // mainAnalysis 생성
  let mainAnalysis = `사주를 보니 ${strongestGroup}의 기운이 가장 강합니다. `;
  mainAnalysis += strongestNarrative.meaning + " ";

  if (godBalance[Object.keys(godBalance).find(k => groupMap[k as BalanceKey] === strongestGroup) as BalanceKey] >= 3) {
    mainAnalysis += strongestNarrative.strong + "\n\n";
  } else {
    mainAnalysis += "\n\n";
  }

  if (dominantDetail) {
    mainAnalysis += `특히 ${dominantName}이(가) 눈에 띕니다. ${dominantDetail.character} ${dominantDetail.influence}`;
  }

  // details 생성
  const details: string[] = [];

  // 각 그룹별 분석
  const groupAnalyses: string[] = [];
  for (const [key, count] of Object.entries(godBalance)) {
    const group = groupMap[key as BalanceKey];
    const narrative = TEN_GOD_GROUP_NARRATIVES[group];

    if (count >= 3) {
      groupAnalyses.push(`【${group} (${count}개)】\n${narrative.intro}\n${narrative.strong}`);
    } else if (count === 0) {
      groupAnalyses.push(`【${group} (없음)】\n${narrative.intro}\n${narrative.weak}`);
    }
  }

  if (groupAnalyses.length > 0) {
    details.push(groupAnalyses.join("\n\n"));
  }

  // 성별별 특수 분석
  let genderAnalysis = `【${gender === "male" ? "남성" : "여성"} 특화 분석】\n`;
  if (gender === "male") {
    genderAnalysis += `남성에게 재성은 아내와 재물을 의미합니다. `;
    if (godBalance.jaeseong === 0) {
      genderAnalysis += "재성이 없어서 배우자 인연이 늦거나 재물운에 노력이 필요합니다.";
    } else if (godBalance.jaeseong >= 3) {
      genderAnalysis += "재성이 많아서 여성 인연이 복잡하거나 돈 문제로 바쁠 수 있습니다.";
    } else {
      genderAnalysis += "재성이 적정해서 안정적인 재물운과 배우자 복이 기대됩니다.";
    }
  } else {
    genderAnalysis += `여성에게 관성은 남편과 직장을 의미합니다. `;
    if (godBalance.gwanseong === 0) {
      genderAnalysis += "관성이 없어서 결혼보다는 자유로운 삶이나 일에 집중하는 것도 좋습니다.";
    } else if (godBalance.gwanseong >= 3) {
      genderAnalysis += "관성이 많아서 남성 인연이 복잡하거나 직장 스트레스가 있을 수 있습니다.";
    } else {
      genderAnalysis += "관성이 적정해서 좋은 남편 복과 안정적인 직장 생활이 기대됩니다.";
    }
  }
  details.push(genderAnalysis);

  // 주도 십신 × 성별 × 신강/신약 조합별 상세 분석 추가
  if (dominantName && dominantName !== "없음" && dominantName in DOMINANT_GOD_STRENGTH_NARRATIVES) {
    const strengthNarrative = DOMINANT_GOD_STRENGTH_NARRATIVES[dominantName as TenGodName]?.[gender]?.[strengthKey];
    if (strengthNarrative) {
      details.push(`【${dominantName} 주도 + ${gender === "male" ? "남성" : "여성"} + ${strengthKey} 조합 분석】\n\n` +
        `${strengthNarrative.lifePattern}`);
      details.push(`【${dominantName} ${strengthKey} - 직업과 진로 방향】\n\n${strengthNarrative.careerDirection}`);
      details.push(`【${dominantName} ${strengthKey} - 대인관계와 연애 스타일】\n\n${strengthNarrative.relationshipStyle}`);
      details.push(`【${dominantName} ${strengthKey} - 조언 포인트】\n\n${strengthNarrative.advicePoint}`);
    }
  }

  // advice 생성
  let advice = `${strongestNarrative.advice}\n\n`;
  if (missingGroups.length > 0) {
    const missingNarrative = TEN_GOD_GROUP_NARRATIVES[missingGroups[0]];
    advice += `${missingGroups[0]}이 없는 부분은 ${missingNarrative.advice}`;
  } else {
    advice += weakestNarrative.advice;
  }

  // closing 생성
  const closing = `십성을 통해 나와 주변의 관계를 이해했을 것입니다. ` +
    `다음 장에서는 이런 십성들이 어떤 '격국(格局)'을 이루는지 살펴보겠습니다. ` +
    `격국은 사주 전체의 그림, 인생의 큰 방향성을 알려줍니다.`;

  return {
    intro,
    mainAnalysis,
    details,
    advice,
    closing,
  };
}

export default analyzeChapter3;
