/**
 * 제4장: 격국(格局) 분석
 * - 8정격 성립 조건
 * - 격국 강도 판정
 * - 파격 요소 분석
 * - 대운별 격국 변화
 */

import type { SajuApiResult, Pillar } from "@/types/saju";
import type { Chapter4Result } from "@/types/expert";

// ============================================
// 상수 및 데이터
// ============================================

type FiveElementKey = "목" | "화" | "토" | "금" | "수";
type TenGodName = "비견" | "겁재" | "식신" | "상관" | "편재" | "정재" | "편관" | "정관" | "편인" | "정인";
type FormatName = "정관격" | "편관격" | "정인격" | "편인격" | "정재격" | "편재격" | "식신격" | "상관격" | "비견격" | "겁재격";

// 천간 오행
const CHEONGAN_OHENG: Record<string, FiveElementKey> = {
  갑: "목", 을: "목",
  병: "화", 정: "화",
  무: "토", 기: "토",
  경: "금", 신: "금",
  임: "수", 계: "수",
};

// 천간 음양
const CHEONGAN_YINYANG: Record<string, "양" | "음"> = {
  갑: "양", 을: "음",
  병: "양", 정: "음",
  무: "양", 기: "음",
  경: "양", 신: "음",
  임: "양", 계: "음",
};

// 지지 오행
const JIJI_OHENG: Record<string, FiveElementKey> = {
  자: "수", 축: "토",
  인: "목", 묘: "목",
  진: "토", 사: "화",
  오: "화", 미: "토",
  신: "금", 유: "금",
  술: "토", 해: "수",
};

// 지지 음양
const JIJI_YINYANG: Record<string, "양" | "음"> = {
  자: "양", 축: "음",
  인: "양", 묘: "음",
  진: "양", 사: "음",
  오: "양", 미: "음",
  신: "양", 유: "음",
  술: "양", 해: "음",
};

// 지지 지장간 (주기: 본기)
const JIJI_MAIN_STEM: Record<string, string> = {
  자: "계",  // 수
  축: "기",  // 토
  인: "갑",  // 목
  묘: "을",  // 목
  진: "무",  // 토
  사: "병",  // 화
  오: "정",  // 화
  미: "기",  // 토
  신: "경",  // 금
  유: "신",  // 금
  술: "무",  // 토
  해: "임",  // 수
};

// 오행 생극 관계
const ELEMENT_RELATIONS: Record<FiveElementKey, {
  same: FiveElementKey;
  generates: FiveElementKey;
  controls: FiveElementKey;
  controlled: FiveElementKey;
  generated: FiveElementKey;
}> = {
  목: { same: "목", generates: "화", controls: "토", controlled: "금", generated: "수" },
  화: { same: "화", generates: "토", controls: "금", controlled: "수", generated: "목" },
  토: { same: "토", generates: "금", controls: "수", controlled: "목", generated: "화" },
  금: { same: "금", generates: "수", controls: "목", controlled: "화", generated: "토" },
  수: { same: "수", generates: "목", controls: "화", controlled: "토", generated: "금" },
};

// 격국 한자
const FORMAT_HANJA: Record<FormatName, string> = {
  정관격: "正官格",
  편관격: "偏官格",
  정인격: "正印格",
  편인격: "偏印格",
  정재격: "正財格",
  편재격: "偏財格",
  식신격: "食神格",
  상관격: "傷官格",
  비견격: "比肩格",
  겁재격: "劫財格",
};

// 격국별 서술형 Narrative
const FORMAT_NARRATIVES: Record<FormatName, {
  intro: string;
  mainAnalysis: string;
  strengthStrong: string;
  strengthWeak: string;
  advice: string;
}> = {
  정관격: {
    intro: "사주를 살펴보니 '정관격(正官格)'이 성립되어 있습니다. 정관격은 8정격 중에서도 가장 정통적이고 귀하게 여기는 격국입니다. '정관'이라는 것은 바른 관직, 정당한 권위를 뜻하며, 이 격국을 가진 분은 사회에서 인정받고 명예로운 위치에 오를 수 있는 기본 자질을 갖추고 있습니다.",
    mainAnalysis: "정관격의 핵심은 '질서'와 '책임'입니다. 본인 스스로를 다스리는 힘이 있고, 그것이 외부로 확장되어 다른 사람들도 다스리는 능력이 있습니다. 규칙과 원칙을 중시하고, 어떤 일이든 정도(正道)로 가려는 성향이 강합니다.\n\n직업적으로는 공직, 대기업, 법조계, 교육계 등 사회적으로 인정받는 안정적인 분야에서 능력을 발휘합니다. 단순히 돈을 많이 버는 것보다 사회적 명예와 인정을 더 중시하는 경향이 있습니다. 조직 내에서 승진하면서 점점 더 높은 자리에 오르는 사람들이 많습니다.",
    strengthStrong: "신강한 정관격이시라면 관의 기운을 감당할 힘이 있어서 더욱 좋습니다. 리더십을 발휘하면서 조직을 이끌어 가실 수 있고, 높은 자리에 올라가도 흔들리지 않습니다. 다만 너무 원칙적으로만 가면 융통성이 부족하다는 소리를 들을 수 있으니, 때로는 유연함도 필요합니다.",
    strengthWeak: "신약한 정관격이시라면 관의 무게가 다소 버거우실 수 있습니다. 책임감이 강한데 몸이 따라주지 않거나, 조직에서의 압박감을 힘들어할 수 있습니다. 인성(印星)의 도움이 필요하며, 학문이나 자격증으로 자신을 보강하면 관의 무게를 잘 감당할 수 있습니다.",
    advice: "정관격이시라면 명예를 지키는 것이 중요합니다. 한번 쌓은 신뢰는 평생의 자산이 되지만, 한번 잃은 명예는 회복하기 어렵습니다. 항상 정도를 걸고, 원칙에 어긋나는 유혹에 흔들리지 마세요. 또한 너무 딱딱하게만 가시지 말고, 때로는 인간적인 따뜻함도 보여주면 더욱 훌륭한 리더가 될 것입니다.",
  },
  편관격: {
    intro: "사주를 살펴보니 '편관격(偏官格)'이 성립되어 있습니다. 편관은 '칠살(七殺)'이라고도 불리며, 강력한 추진력과 결단력을 상징합니다. 정관이 '부드러운 통제'라면 편관은 '강한 제압'의 기운입니다. 이 격국을 가진 분은 위기 상황에서 빛을 발하고, 도전적인 분야에서 두각을 나타냅니다.",
    mainAnalysis: "편관격의 핵심은 '돌파'와 '결단'입니다. 남들이 두려워하는 것을 과감하게 밀어붙이는 힘이 있습니다. 안전한 길보다는 도전적인 길을 선택하고, 위험 속에서 기회를 찾으는 사람입니다.\n\n직업적으로는 군인, 경찰, 소방관, 외과 의사, 스포츠 선수, 벤처 사업가 등 강한 결단력이 필요한 분야에서 능력을 발휘합니다. 조용한 사무실보다는 역동적인 현장에서 빛나는 사람입니다. 승부욕이 강하고 경쟁에서 지기 싫어하는 성향도 있습니다.",
    strengthStrong: "신강한 편관격이시라면 칠살의 강한 기운을 잘 제어할 수 있어서 대길(大吉)입니다. 강력한 리더십으로 조직을 이끌어 가고, 위기 상황에서도 냉정하게 판단할 수 있습니다. 권위가 있면서도 결단력이 뛰어나서 큰 일을 이룰 수 있습니다.",
    strengthWeak: "신약한 편관격이시라면 칠살의 무게가 다소 버거우실 수 있습니다. 외부의 압박이나 경쟁이 스트레스로 다가오실 수 있고, 건강에도 주의가 필요합니다. 식신(食神)으로 편관을 제어하거나, 인성(印星)으로 화(化)하면 편관의 기운을 순하게 쓰실 수 있습니다.",
    advice: "편관격이시라면 그 강한 기운을 올바른 방향으로 쓰는 것이 중요합니다. 정의로운 일에 쓰면 영웅이 되지만, 잘못된 방향으로 쓰면 화를 부르실 수 있습니다. 또한 너무 무리하게 밀어붙이시다 보면 몸과 마음이 상할 수 있으니, 충분한 휴식도 취하세요. 식신제살(食神制殺)의 원리처럼, 때로는 부드러움으로 강함을 다스리는 지혜가 필요합니다.",
  },
  정인격: {
    intro: "사주를 살펴보니 '정인격(正印格)'이 성립되어 있습니다. 정인격은 학문과 지혜의 격국으로, 배움을 좋아하고 지적인 활동에 재능이 있는 사람들이 많습니다. '인수(印綬)'라고도 불리며, 문서, 자격증, 학위와 관련된 복이 있습니다.",
    mainAnalysis: "정인격의 핵심은 '학습'과 '지혜'입니다. 새로운 것을 배우는 것을 좋아하고, 깊이 있는 사고를 하는 사람입니다. 단순히 암기하는 것이 아니라 원리를 이해하려 하고, 그것을 다른 분야에도 응용하는 능력이 뛰어납니다.\n\n직업적으로는 학자, 연구원, 교사, 작가, 변호사, 의사 등 지식을 다루는 분야에서 능력을 발휘합니다. 자격증이나 학위를 통해 사회적 인정을 받는 경우가 많고, 문서 관련 일에서 좋은 결과를 얻으는 사람입니다. 또한 어머니와의 인연이 좋고, 어머니의 도움을 많이 받는 경우가 많습니다.",
    strengthStrong: "신강한 정인격이시라면 인성의 도움을 받으면서도 본인의 힘이 있어서 균형이 좋습니다. 학문적 성취를 이루면서도 실행력이 있어서, 배운 것을 실제로 활용하는 능력이 뛰어납니다.",
    strengthWeak: "신약한 정인격이시라면 정인의 도움이 더욱 절실합니다. 학문이나 자격증을 통해 본인을 보강하면 좋고, 어른들의 도움을 받는 것도 좋습니다. 다만 인성에 너무 의존하면 스스로 결정하는 힘이 약해지실 수 있으니, 적당한 균형이 필요합니다.",
    advice: "정인격이시라면 평생 학습의 자세를 가지는 것이 좋습니다. 나이가 들어서도 새로운 것을 배우는 것을 두려워하지 말고, 지적 호기심을 유지하세요. 또한 배운 것을 혼자만 가지고 있지 말고 다른 사람들과 나누면, 그것이 또 다른 복이 되어 돌아옵니다. 가르치는 일에도 재능이 있으니 참고하세요.",
  },
  편인격: {
    intro: "사주를 살펴보니 '편인격(偏印格)'이 성립되어 있습니다. 편인은 '효신(梟神)'이라고도 불리며, 독특한 재능과 영적 감각을 상징합니다. 일반적인 학문보다는 특수한 분야, 전통적이지 않은 영역에서 빛을 발하는 사람입니다.",
    mainAnalysis: "편인격의 핵심은 '특수성'과 '직관'입니다. 남들과 다른 시각으로 세상을 보고, 일반적인 방법이 아닌 독특한 방식으로 문제를 해결합니다. 직관력이 뛰어나고, 눈에 보이지 않는 것을 감지하는 능력이 있습니다.\n\n직업적으로는 역술가, 종교인, 심리상담사, 대체의학 종사자, 예술가, 프리랜서 등 독특한 분야에서 능력을 발휘합니다. 정규 교육보다 독학이나 특수한 수련을 통해 능력을 키우는 경우가 많고, 남들이 잘 모르는 분야에서 전문가가 되는 사람입니다.",
    strengthStrong: "신강한 편인격이시라면 편인의 독특한 기운을 잘 소화할 수 있습니다. 특수한 재능을 사회에서 인정받을 수 있고, 독창적인 분야에서 성공할 가능성이 높습니다.",
    strengthWeak: "신약한 편인격이시라면 편인의 기운이 다소 부담스러우실 수 있습니다. 생각이 너무 많아지시거나, 현실과 동떨어진 공상에 빠지실 수 있습니다. 재성(財星)으로 편인을 제어하거나, 현실적인 활동을 병행하면 균형을 잡을 수 있습니다. 또한 도식(倒食)에 주의해서 식신이 있다면 편인이 식신을 해치지 않도록 살펴봐야 합니다.",
    advice: "편인격이시라면 본인만의 특수한 재능을 개발하는 것이 중요합니다. 남들과 같은 길을 가려 하면 오히려 힘들고, 본인만의 독특한 영역을 개척하면 빛을 발합니다. 다만 너무 현실과 동떨어지지 않도록 주의하고, 물질적인 안정도 어느 정도 확보하면서 본인의 길을 가는 것이 좋습니다.",
  },
  정재격: {
    intro: "사주를 살펴보니 '정재격(正財格)'이 성립되어 있습니다. 정재격은 재물 복이 있는 격국으로, 성실한 노력을 통해 안정적인 재물을 모으는 사람입니다. '정당한 재물'을 뜻하며, 급여나 사업 수입 등 정상적인 방법으로 재물을 얻습니다.",
    mainAnalysis: "정재격의 핵심은 '성실'과 '안정'입니다. 한탕을 노리시기보다는 차곡차곡 쌓아가는 스타일입니다. 돈 관리를 잘 하고, 계획적으로 재정을 운용하는 능력이 있습니다. 낭비를 싫어하고 실속을 추구합니다.\n\n직업적으로는 회계사, 세무사, 은행원, 재정 관리자, 안정적인 사업 등에서 능력을 발휘합니다. 급여 생활도 잘 맞고, 사업을 해도 리스크가 적은 안정적인 분야를 선택하는 경향이 있습니다. 또한 아내 복이 좋다고 하며, 가정에 충실한 사람들이 많습니다.",
    strengthStrong: "신강한 정재격이시라면 재물을 관리할 힘이 있어서 대길입니다. 큰 재물도 감당할 수 있고, 사업을 해도 성공할 가능성이 높습니다. 재물이 재물을 낳는 선순환을 만들 수 있습니다.",
    strengthWeak: "신약한 정재격이시라면 재물을 감당하기가 다소 힘먹을 수 있습니다. 돈은 있는데 쓸 곳이 많거나, 재물로 인한 스트레스가 있을 수 있습니다. 비겁(比劫)의 도움으로 힘을 보강하거나, 너무 큰 재물을 욕심내시지 않으면 좋습니다.",
    advice: "정재격이시라면 꾸준함이 가장 큰 무기입니다. 빨리 부자가 되려고 무리하지 말고, 본인의 페이스대로 차곡차곡 쌓아가세요. 투기나 도박은 멀리하고, 안전한 투자를 선호하는 것이 좋습니다. 또한 인색하다는 소리를 듣지 않도록 적절한 지출도 필요합니다. 베풀면 더 큰 복으로 돌아옵니다.",
  },
  편재격: {
    intro: "사주를 살펴보니 '편재격(偏財格)'이 성립되어 있습니다. 편재격은 사업 수완과 융통성을 갖춘 격국으로, 큰 돈을 다루고 사업에서 성공하는 사람들이 많습니다. 정재가 '안정적인 재물'이라면 편재는 '유동적인 재물'입니다.",
    mainAnalysis: "편재격의 핵심은 '융통성'과 '사업 수완'입니다. 돈의 흐름을 읽는 능력이 있고, 기회가 왔을 때 과감하게 투자하는 결단력이 있습니다. 한 곳에 묶어두시기보다는 돈을 굴려서 불리는 스타일입니다.\n\n직업적으로는 사업가, 투자자, 무역업, 유통업, 영업직 등에서 능력을 발휘합니다. 직장 생활보다는 사업이 더 맞으는 사람들이 많고, 넓은 인맥을 활용하는 능력도 뛰어납니다. 돈을 버는 것도 잘하지만 쓰는 것도 잘해서, 생활이 풍요로우신 사람들이 많습니다.",
    strengthStrong: "신강한 편재격이시라면 큰 사업도 감당할 힘이 있어서 대길입니다. 여러 사업체를 운영하거나, 큰 규모의 투자를 해도 성공할 가능성이 높습니다. 재물 복이 크시다고 볼 수 있습니다.",
    strengthWeak: "신약한 편재격이시라면 큰 재물을 감당하기가 힘먹을 수 있습니다. 돈이 들어와도 나가는 것도 많으시거나, 사업에서 무리하다가 손실을 볼 수 있습니다. 몸집을 키우시기보다는 적정 규모를 유지하면서 안정을 추구하는 것이 좋습니다.",
    advice: "편재격이시라면 사업 감각을 살리되 리스크 관리에도 신경 쓰세요. 너무 큰 욕심을 부리면 화를 부를 수 있고, 적당한 선에서 만족하는 지혜가 필요합니다. 또한 넓은 인맥이 재산이니 인간관계를 잘 관리하고, 신용을 지키는 것이 중요합니다. 가정에도 신경 써서 밖에서만 바쁘시지 않도록 하세요.",
  },
  식신격: {
    intro: "사주를 살펴보니 '식신격(食神格)'이 성립되어 있습니다. 식신격은 복록(福祿)의 격국으로, 먹고 사는 복이 있고 표현력이 뛰어난 사람입니다. '식신'은 말 그대로 '밥을 먹여주는 신'이라는 뜻으로, 평생 굶주리지 않을 복이 있습니다.",
    mainAnalysis: "식신격의 핵심은 '표현'과 '창작'입니다. 내 안에 있는 것을 밖으로 표현하는 능력이 뛰어나고, 그것이 다른 사람들에게 기쁨을 줍니다. 낙천적이고 여유가 있며, 함께 있으면 편안함을 주는 사람입니다.\n\n직업적으로는 요리사, 작가, 예술가, 강사, 상담사, 서비스업 등에서 능력을 발휘합니다. 본인의 재능을 표현하면서 그것으로 생계를 유지하는 사람들이 많습니다. 또한 자녀 복이 좋다고 하며, 아이들과 잘 어울리는 사람입니다.",
    strengthStrong: "신강한 식신격이시라면 식신의 에너지를 마음껏 발휘할 수 있습니다. 창작 활동이 왕성하고, 표현력도 뛰어납니다. 식신생재(食神生財)로 재물 복도 따르실 수 있습니다.",
    strengthWeak: "신약한 식신격이시라면 식신의 에너지가 본인을 다소 빼앗아갈 수 있습니다. 표현은 하고 싶은데 체력이 따라주지 않으시거나, 너무 많은 것을 쏟아내시다가 지칠 수 있습니다. 인성(印星)의 도움으로 에너지를 보충하면 좋습니다.",
    advice: "식신격이시라면 본인의 재능을 아끼지 말고 표현하세요. 숨겨두면 썩지만, 나누면 더 커집니다. 다만 편인(偏印)이 있으면 도식(倒食)에 주의해야 합니다. 편인이 식신을 해치면 복록이 끊어질 수 있으니, 편인을 제어하거나 피하는 것이 좋습니다. 또한 너무 낙천적으로만 사시지 말고, 미래를 위한 준비도 하세요.",
  },
  상관격: {
    intro: "사주를 살펴보니 '상관격(傷官格)'이 성립되어 있습니다. 상관격은 재능과 개성이 뛰어난 격국으로, 남다른 표현력과 언변을 가진 사람입니다. '상관'은 '관을 상하게 한다'는 뜻으로 기존 질서에 도전하는 기운이 있습니다.",
    mainAnalysis: "상관격의 핵심은 '재능'과 '자유'입니다. 틀에 박힌 것을 싫어하고, 자유롭게 표현하기를 원합니다. 언변이 뛰어나고 비판 능력도 날카로우시며, 예술적 감각이 탁월합니다.\n\n직업적으로는 연예인, 예술가, 작가, 변호사, 평론가, 프리랜서 등에서 능력을 발휘합니다. 조직에 얽매이시기보다는 자유롭게 활동하는 것을 선호하고, 본인의 재능으로 승부하는 사람입니다. 상관생재(傷官生財)로 재능을 통해 큰 재물을 얻는 경우도 많습니다.",
    strengthStrong: "신강한 상관격이시라면 상관의 에너지를 감당할 힘이 있어서 재능을 마음껏 발휘할 수 있습니다. 대중적인 인기를 얻으시거나, 전문 분야에서 두각을 나타내실 수 있습니다.",
    strengthWeak: "신약한 상관격이시라면 상관의 에너지가 본인을 지치게 할 수 있습니다. 말이 많아지시거나 생각이 많아지면서 정작 실행은 못 하는 경우가 있습니다. 인성(印星)으로 상관을 제어하면 균형을 잡을 수 있습니다.",
    advice: "상관격이시라면 재능을 살리되 말조심을 하세요. 날카로운 비판이 때로는 적을 만들 수 있고, '상관견관(傷官見官)'이 되면 직장이나 윗사람과의 갈등이 생길 수 있습니다. 정관이 있는 사주라면 특히 조심해야 합니다. 또한 자유를 추구하시되 책임감도 잃지 말고, 재능을 재물로 연결하는 상관생재의 길을 가면 좋습니다.",
  },
  비견격: {
    intro: "사주를 살펴보니 '비견격(比肩格)'이 성립되어 있습니다. 비견격은 독립심과 자존심이 강한 격국으로, 남에게 의지하기보다 본인의 힘으로 일어서는 사람입니다. '비견'은 '어깨를 나란히 한다'는 뜻으로 동등한 위치에서 경쟁하는 기운이 있습니다.",
    mainAnalysis: "비견격의 핵심은 '독립'과 '경쟁'입니다. 자수성가하는 사람들이 많고, 남의 도움 없이 본인의 힘으로 성공하려는 의지가 강합니다. 자존심이 세고 지기 싫어하는 면이 있습니다.\n\n직업적으로는 동업, 프랜차이즈, 경쟁적인 사업, 스포츠, 영업 등에서 능력을 발휘합니다. 조직 내에서도 라이벌과 경쟁하면서 성장하는 사람입니다. 다만 재물을 나눠야 하는 상황이 생길 수 있고, 동업에서 갈등이 발생할 수 있으니 주의가 필요합니다.",
    strengthStrong: "신강한 비견격이시라면 독립심과 추진력이 더욱 강합니다. 혼자 힘으로 사업을 일으키실 수 있고, 경쟁에서도 이기실 가능성이 높습니다. 다만 너무 독불장군식으로 가면 협력이 필요한 상황에서 어려움을 겪을 수 있습니다.",
    strengthWeak: "신약한 비견격이시라면 비견의 도움이 필요합니다. 형제나 친구, 동료의 도움을 받으면 좋고, 혼자 하기보다는 파트너와 함께하는 것이 유리합니다. 다만 재물 분배에서 손해를 볼 수 있으니 명확한 약속이 필요합니다.",
    advice: "비견격이시라면 독립심을 살리되 협력도 배우세요. 혼자 다 하려고 하면 한계가 있고, 적절한 파트너십이 더 큰 성공을 가져다줍니다. 또한 재물에 대한 욕심을 내려놓으면 오히려 더 많이 들어옵니다. 동업을 한다면 처음부터 역할과 수익 배분을 명확히 정해두는 것이 좋습니다.",
  },
  겁재격: {
    intro: "사주를 살펴보니 '겁재격(劫財格)'이 성립되어 있습니다. 겁재격은 추진력과 승부욕이 강한 격국으로, 목표를 향해 거침없이 나아가는 사람입니다. '겁재'는 '재물을 빼앗는다'는 뜻이 있어 다소 부정적으로 들리실 수 있지만, 잘 쓰면 강력한 돌파력이 됩니다.",
    mainAnalysis: "겁재격의 핵심은 '돌파'와 '승부'입니다. 안전한 길보다는 도전적인 길을 선택하고, 큰 것을 노리는 사람입니다. 투쟁심이 강하고 경쟁을 즐기시며, 위기 상황에서 오히려 힘을 발휘합니다.\n\n직업적으로는 경쟁적인 사업, 스포츠, 투자, 영업, 도전적인 분야에서 능력을 발휘합니다. 편안한 것보다는 스릴 있는 것을 좋아하고, 승패가 명확한 분야에서 빛나는 사람입니다. 다만 재물 손실에 주의해야 하고, 도박이나 투기는 피하는 것이 좋습니다.",
    strengthStrong: "신강한 겁재격이시라면 겁재의 에너지를 잘 통제하면서 강력한 추진력으로 쓰실 수 있습니다. 경쟁에서 이기실 가능성이 높고, 큰 도전도 해내실 수 있습니다.",
    strengthWeak: "신약한 겁재격이시라면 겁재의 에너지가 본인을 해칠 수 있습니다. 무리한 승부를 하다가 손실을 보시거나, 건강을 해칠 수 있습니다. 관성(官星)으로 겁재를 제어하거나, 식상(食傷)으로 에너지를 빼면 균형을 잡을 수 있습니다.",
    advice: "겁재격이시라면 그 강한 에너지를 건설적인 방향으로 쓰세요. 무모한 도전보다는 계산된 승부를 하고, 재물 관리에 특히 신경 쓰세요. 도박이나 투기는 절대 하면 안 되고, 큰 돈이 왔다 갔다 하는 상황을 만들지 마세요. 또한 인간관계에서도 너무 경쟁적으로 가면 적을 만들 수 있으니, 때로는 양보하는 여유도 필요합니다.",
  },
};

// 격국 × 신강/신약/중화 조합 상세 Narrative (30개 조합)
const FORMAT_STRENGTH_NARRATIVES: Record<FormatName, Record<"신강" | "신약" | "중화", {
  lifePattern: string;
  careerDirection: string;
  wealthManagement: string;
  relationshipAdvice: string;
  healthFocus: string;
}>> = {
  정관격: {
    신강: {
      lifePattern: "신강한 정관격이시라면 리더십을 발휘할 수 있는 타고난 자질이 있습니다. 관(官)의 무게를 감당할 힘이 있으니, 높은 자리에 올라도 흔들리지 않습니다. 조직에서 점점 더 높은 위치로 올라가면서 본인의 능력을 발휘하는 사람입니다. 다만 힘이 있으니 너무 원칙적으로만 가면 딱딱하다는 인상을 주실 수 있습니다. 때로는 융통성 있게 대처하는 여유도 필요합니다.",
      careerDirection: "공직이나 대기업에서 고위직으로 승진하기 좋습니다. 법조계, 금융권, 교육계 등 사회적으로 권위 있는 분야에서 성공하는 사람들이 많습니다. 관리자나 임원의 자리가 잘 맞고, 조직을 이끌어가는 역할에서 빛을 발합니다. 정치에도 소질이 있으니 공직을 통해 사회에 기여하는 것도 좋습니다.",
      wealthManagement: "재물은 안정적으로 관리하는 타입입니다. 월급이나 정기적인 수입을 잘 모고, 무리한 투자보다는 안전한 재테크를 선호합니다. 사회적 지위가 올라가면서 자연스럽게 수입도 늘어나는 구조입니다. 급하게 부자가 되려 하기보다 꾸준히 쌓아가면 노후에 풍족해집니다.",
      relationshipAdvice: "배우자에게 신뢰감을 주는 사람입니다. 책임감이 강하고 가정에 충실하니 결혼 후 안정적인 가정을 꾸립니다. 다만 집에서도 직장에서처럼 권위적으로 행동하면 가족들이 힘들어할 수 있습니다. 가정에서는 좀 더 부드러운 모습을 보여주면 좋겠습니다.",
      healthFocus: "스트레스 관리에 신경 써야 합니다. 책임감이 강하다 보니 어깨에 짊어지는 것이 많고, 그것이 건강을 해칠 수 있습니다. 간 기능과 혈압에 주의하고, 규칙적인 운동과 충분한 휴식을 취하세요. 업무와 휴식의 균형을 잘 맞추는 것이 중요합니다.",
    },
    신약: {
      lifePattern: "신약한 정관격이시라면 관(官)의 무게가 다소 버거우실 수 있습니다. 책임감은 강한데 몸과 마음이 따라주지 않으시거나, 조직에서의 압박감을 힘들어할 수 있습니다. 그러나 이것은 약점이 아니라 다른 방식으로 성공하라는 신호입니다. 학문이나 자격증으로 본인을 보강하면 관(官)의 무게를 잘 감당할 수 있습니다.",
      careerDirection: "전문직이나 기술직이 잘 맞고, 너무 높은 자리보다는 실무 전문가로 인정받는 것이 좋습니다. 공인회계사, 세무사, 변리사 등 자격증 기반의 전문직에서 능력을 발휘하는 사람들이 많습니다. 조직 내에서도 관리자보다는 핵심 실무자로 인정받는 길이 편할 수 있습니다.",
      wealthManagement: "무리하게 큰 재물을 노리시기보다는 본인의 전문성으로 안정적인 수입을 확보하는 것이 좋습니다. 자격증이나 전문 기술이 평생 먹거리가 되어줍니다. 투자도 보수적으로 하고, 급하게 부자가 되려 하지 마세요. 꾸준히 가면 결국 편안해집니다.",
      relationshipAdvice: "배우자의 도움이 중요합니다. 든든하게 지지해주는 배우자를 만나면 관(官)의 무게를 함께 나눌 수 있습니다. 결혼 후 배우자의 도움으로 사회적 지위가 올라가는 경우도 많습니다. 좋은 인연을 만나면 운이 크게 상승하니 배우자 선택에 신중하세요.",
      healthFocus: "체력 관리가 중요합니다. 신약하니 무리하면 바로 몸에 티가 납니다. 규칙적인 생활과 충분한 영양 섭취로 기본 체력을 키우고, 과로하지 않도록 주의하세요. 특히 소화기 계통과 면역력에 신경 쓰고, 스트레스를 받으면 바로 풀어주는 것이 좋습니다.",
    },
    중화: {
      lifePattern: "중화된 정관격이시라면 균형 잡힌 삶을 사는 사람입니다. 관(官)의 기운을 적당히 감당하면서도 지치지 않고, 사회생활과 개인 생활의 조화를 잘 이루는 타입입니다. 극단적으로 높은 자리에 오르시지는 않아도 안정적으로 성장하면서 인정받는 삶을 사시게 됩니다.",
      careerDirection: "중간 관리자나 팀장급에서 능력을 발휘하는 경우가 많습니다. 너무 높지도 낮지도 않은 위치에서 실무와 관리를 병행하면서 조직에 기여하는 사람입니다. 공무원이시라면 중견 간부까지 무난하게 올라가고, 회사원이시라면 부장급까지 안정적으로 성장합니다.",
      wealthManagement: "재물은 중간 정도 수준을 유지하면서 안정적으로 가는 사람입니다. 크게 벌지는 않아도 크게 잃지도 않고, 계획적으로 재정을 운용하면서 노후 대비도 잘 하는 타입입니다. 무리하지 않으면 평생 경제적으로 곤란하지 않습니다.",
      relationshipAdvice: "배우자와 대등한 관계를 유지하면서 서로 존중하는 결혼 생활을 하는 사람입니다. 가정에서도 균형감을 유지하면서 자녀 교육에도 신경을 쓰는 책임감 있는 부모가 됩니다. 가정과 직장 사이에서 조화를 잘 이루면 행복한 삶을 삽니다.",
      healthFocus: "전반적으로 건강한 편이시나 예방에 신경 쓰세요. 중년 이후 혈압이나 당뇨 등 성인병에 주의하고, 정기적인 건강검진을 받으면 좋습니다. 무리하지 않으면 건강하게 오래 살 수 있으니, 일과 휴식의 균형을 잘 맞추세요.",
    },
  },
  편관격: {
    신강: {
      lifePattern: "신강한 편관격이시라면 칠살(七殺)의 강한 기운을 제어할 힘이 있어서 대길(大吉)입니다. 위기 상황에서도 냉정하게 판단하고, 과감한 결단으로 난관을 돌파하는 사람입니다. 남들이 두려워하는 도전을 기꺼이 받아들이고, 역경 속에서 더욱 강해지는 타입입니다. 권위가 있면서도 결단력이 뛰어나서 큰 일을 이룰 수 있습니다.",
      careerDirection: "군 장성, 경찰 고위직, 외과 전문의, 대형 벤처 사업가 등 강한 결단력이 필요한 분야에서 두각을 나타냅니다. 위험을 무릅쓰고 도전하는 분야에서 성공하는 경우가 많고, 경쟁이 치열한 환경에서 오히려 빛을 발합니다. 스포츠 분야에서도 프로 선수나 감독으로 성공하는 사람들이 많습니다.",
      wealthManagement: "큰 것을 노리고 큰 것을 얻는 타입입니다. 안전한 투자보다는 하이 리스크 하이 리턴을 추구하고, 그것이 성공하는 경우가 많습니다. 사업을 하면 과감하게 투자하고 확장하면서 재벌급 부를 이루는 사람도 있습니다. 다만 실패하면 손실도 크니 리스크 관리는 하세요.",
      relationshipAdvice: "강한 카리스마로 이성에게 인기가 있지만, 가정에서도 지배적으로 행동하면 갈등이 생길 수 있습니다. 배우자에게도 존중하는 모습을 보여주고, 가정에서만큼은 부드러운 모습을 보여주면 좋겠습니다. 자녀에게는 엄격한 부모가 되지만 사랑도 충분히 표현해 주세요.",
      healthFocus: "너무 무리하면 몸이 상합니다. 편관의 강한 기운이 오히려 본인을 해칠 수 있으니, 충분한 휴식을 취하고 정기적인 건강검진을 받으세요. 특히 심장과 혈관 건강에 주의하고, 스트레스로 인한 위장 문제도 살펴보세요. 격렬한 운동보다는 명상이나 요가로 마음을 안정시키는 것도 좋습니다.",
    },
    신약: {
      lifePattern: "신약한 편관격이시라면 칠살(七殺)의 무게가 다소 버거우실 수 있습니다. 외부의 압박이나 경쟁이 스트레스로 다가오고, 몸과 마음이 지칠 수 있습니다. 그러나 식신(食神)으로 편관을 제어하거나 인성(印星)으로 화(化)하면 편관의 기운을 순하게 쓰실 수 있습니다. 무리하게 밀어붙이시기보다 때를 기다리는 지혜가 필요합니다.",
      careerDirection: "최전선보다는 후방에서 지원하는 역할이 편할 수 있습니다. 직접 싸우시기보다 전략을 짜는 참모 역할이 잘 맞고, 위험한 분야보다는 안전한 분야에서 전문성을 쌓는 것이 좋습니다. 군대나 경찰에 가더라도 행정 분야나 기술 분야로 가면 힘들지 않습니다.",
      wealthManagement: "큰 모험보다는 안정적인 재테크가 좋습니다. 하이 리스크 투자는 피하고, 적금이나 보험 등 안전한 방법으로 재물을 모으세요. 사업보다는 취업이 편하고, 사업을 하더라도 리스크가 적은 분야를 선택하는 것이 좋습니다.",
      relationshipAdvice: "든든하게 보호해주는 배우자를 만나면 운이 좋아집니다. 본인이 이끌어가시기보다 배우자가 주도하는 관계도 괜찮고, 서로 보완해주는 관계가 이상적입니다. 무리하게 강한 척 하지 말고 약한 모습도 보여주면 오히려 사랑받습니다.",
      healthFocus: "체력 관리가 매우 중요합니다. 편관의 극(剋)하는 기운이 몸을 해칠 수 있으니, 규칙적인 생활과 충분한 영양 섭취로 면역력을 키우세요. 스트레스를 받으면 바로 풀어주고, 위장과 신장 건강에 특히 주의하세요. 과로는 절대 금물입니다.",
    },
    중화: {
      lifePattern: "중화된 편관격이시라면 칠살의 기운과 본인의 힘이 적당히 균형을 이루고 있습니다. 도전적인 일도 하면서 무리하지 않고, 적당한 긴장감 속에서 성장하는 사람입니다. 위기 상황에서도 침착하게 대처하면서 너무 공격적으로 가시지도 않습니다.",
      careerDirection: "중간 관리자급에서 실력을 발휘하는 경우가 많습니다. 현장과 본부 사이에서 조율하는 역할이 잘 맞고, 위험 관리나 보안 분야에서도 능력을 발휘합니다. 너무 격렬한 직종보다는 적당한 긴장감이 있는 분야가 맞습니다.",
      wealthManagement: "균형 잡힌 투자를 하는 사람입니다. 너무 보수적이지도 공격적이지도 않고, 상황에 맞게 유연하게 대처하면서 재물을 모읍니다. 중간 정도의 리스크를 감수하면서 안정적으로 성장하는 재테크 스타일입니다.",
      relationshipAdvice: "배우자와 적당한 긴장감 속에서 건강한 관계를 유지하는 사람입니다. 서로 경쟁하기도 하고 협력하기도 하면서 성장하는 관계가 이상적입니다. 가정에서도 적당한 권위를 유지하면서 민주적으로 운영하면 좋습니다.",
      healthFocus: "전반적으로 건강하지만 과로에 주의하세요. 중년 이후 심혈관 계통에 신경 쓰고, 정기적인 건강검진을 받으면 좋습니다. 적당한 운동과 휴식의 균형을 맞추면 오래오래 건강하게 삽니다.",
    },
  },
  정인격: {
    신강: {
      lifePattern: "신강한 정인격이시라면 학문적 성취와 실행력을 모두 갖추신 사람입니다. 공부를 잘하면서도 그것을 현실에 적용하는 능력이 뛰어나고, 배운 것을 실제로 활용하는 지혜가 있습니다. 학문과 실무를 병행하면서 전문가로 인정받는 사람들이 많습니다.",
      careerDirection: "교수, 연구원, 전문 변호사, 의사 등 고급 전문직에서 성공하는 사람들이 많습니다. 이론과 실무를 겸비하면서 해당 분야의 권위자가 되는 경우도 많습니다. 저술 활동이나 강연으로도 인정받고, 제자를 양성하는 스승의 역할도 잘 합니다.",
      wealthManagement: "전문성으로 고수입을 올리는 사람입니다. 자격증이나 학위가 평생 먹거리가 되어주고, 저술이나 강연으로 추가 수입도 올리는 경우가 많습니다. 재테크는 보수적으로 하면서 안정적으로 재물을 모으는 타입입니다.",
      relationshipAdvice: "지적인 대화가 통하는 배우자를 만나면 행복합니다. 서로의 생각을 나누고 함께 성장하는 관계가 이상적이고, 자녀 교육에도 열정적으로 투자하는 부모가 됩니다. 어머니와의 인연이 좋고 어머니의 도움을 많이 받는 사람입니다.",
      healthFocus: "두뇌 활동이 많으니 머리가 피로해질 수 있습니다. 충분한 수면과 휴식으로 뇌를 쉬게 해주고, 눈 건강에도 신경 쓰세요. 앉아서 공부하는 시간이 많으니 허리와 목 건강도 챙기고, 가벼운 운동으로 혈액순환을 도우세요.",
    },
    신약: {
      lifePattern: "신약한 정인격이시라면 정인의 도움이 더욱 절실합니다. 학문이나 자격증을 통해 본인을 보강하면 좋고, 어른들의 도움을 받는 것도 좋습니다. 다만 인성에 너무 의존하면 스스로 결정하는 힘이 약해지실 수 있으니, 적당한 균형이 필요합니다.",
      careerDirection: "이론보다 실무 능력을 키우는 것이 중요합니다. 너무 학문에만 치우치면 현실 감각이 떨어질 수 있으니, 현장 경험을 쌓으면서 이론과 실무를 병행하세요. 선배나 멘토의 도움을 적극적으로 받으면 성장이 빠릅니다.",
      wealthManagement: "자격증이나 전문 기술이 중요합니다. 학위만으로는 부족하고 실질적인 기술이나 자격을 갖춰야 안정적인 수입이 생깁니다. 투자보다는 본업에 충실하면서 전문성을 높이는 것이 장기적으로 유리합니다.",
      relationshipAdvice: "배우자나 어머니의 도움이 큰 힘이 됩니다. 정신적으로 지지해주는 분이 옆에 있면 자신감이 생기고, 어려운 일도 헤쳐나가실 수 있습니다. 혼자 하려 하지 말고 주변의 도움을 받아들이면 좋습니다.",
      healthFocus: "체력을 키우는 것이 우선입니다. 머리는 좋으신데 몸이 약하면 능력을 발휘하기 어려우니, 규칙적인 운동과 충분한 영양 섭취로 기본 체력을 만드세요. 소화기 계통과 호흡기 건강에 주의하고, 스트레스 관리도 중요합니다.",
    },
    중화: {
      lifePattern: "중화된 정인격이시라면 학문과 실무, 이론과 현실 사이에서 균형을 잘 잡는 사람입니다. 공부도 하면서 일도 하고, 두 가지를 조화롭게 병행하면서 성장합니다. 평생 배움의 자세를 유지하면서도 현실적인 판단도 잘 하는 사람입니다.",
      careerDirection: "교육 분야, 컨설팅, 기획 등 지식과 실무를 결합하는 분야에서 능력을 발휘합니다. 이론을 현장에 적용하는 역할이 잘 맞고, 교육 기관과 기업 사이를 오가면서 활동하는 사람도 많습니다.",
      wealthManagement: "균형 잡힌 재테크를 하는 사람입니다. 너무 보수적이지도 공격적이지도 않고, 상황에 맞게 유연하게 재정을 운용합니다. 전문성과 자격증을 바탕으로 안정적인 수입을 유지하면서 적절한 투자도 병행합니다.",
      relationshipAdvice: "지적으로 대등한 배우자와 함께하면 행복합니다. 서로 존중하고 배움을 나누는 관계가 이상적이고, 자녀 교육에도 균형 잡힌 방식으로 접근하는 부모가 됩니다.",
      healthFocus: "전반적으로 건강하지만 정신 건강에도 신경 쓰세요. 생각이 많으니 가끔 머리를 비우는 시간이 필요하고, 자연 속에서 휴식을 취하면 좋습니다. 규칙적인 생활 습관을 유지하면 오래 건강하게 삽니다.",
    },
  },
  편인격: {
    신강: {
      lifePattern: "신강한 편인격이시라면 독특한 재능을 마음껏 발휘할 수 있습니다. 남들과 다른 시각으로 세상을 보고, 그것이 특별한 능력으로 인정받는 사람입니다. 직관력이 뛰어나고 영적인 감각도 있며, 특수한 분야에서 전문가가 되는 경우가 많습니다.",
      careerDirection: "역술가, 심리상담사, 대체의학 종사자, 예술가, 연구원 등 독특한 분야에서 성공합니다. 남들이 잘 모르는 특수한 분야에서 권위자가 되고, 그 분야에서는 손꼽히는 전문가로 인정받습니다. 정규 교육보다 독학이나 수련을 통해 능력을 키우는 사람입니다.",
      wealthManagement: "특수한 재능으로 수입을 올리는 사람입니다. 일반적인 방법으로는 돈을 못 벌고, 본인만의 독특한 기술이나 능력으로 수입을 창출합니다. 상담비나 강의비 등으로 고수익을 올리는 경우도 많습니다.",
      relationshipAdvice: "본인을 이해해주는 특별한 배우자가 필요합니다. 일반적인 사람은 본인을 이해하기 어려우니, 비슷한 성향의 분이나 본인을 존중해주는 분과 인연이 맞습니다. 혼자만의 시간도 필요하니 그것을 인정해주는 배우자가 좋습니다.",
      healthFocus: "정신 건강에 주의하세요. 생각이 너무 깊으면 우울해지거나 현실과 동떨어질 수 있습니다. 명상은 좋지만 과도한 명상은 해로우니 적당히 하고, 현실 세계와의 연결을 유지하세요. 규칙적인 생활과 운동으로 몸과 마음의 균형을 맞추세요.",
    },
    신약: {
      lifePattern: "신약한 편인격이시라면 편인의 기운이 다소 부담스러우실 수 있습니다. 생각이 너무 많아지시거나 현실과 동떨어진 공상에 빠지실 수 있습니다. 재성(財星)으로 편인을 제어하거나 현실적인 활동을 병행하면 균형을 잡을 수 있습니다. 특히 도식(倒食)에 주의해서 식신이 해를 입지 않도록 하세요.",
      careerDirection: "현실적인 직업과 특수한 관심사를 병행하는 것이 좋습니다. 본업은 안정적인 직장을 가지면서 부업으로 특수한 분야를 연구하는 것이 현명합니다. 너무 특수한 분야에만 몰두하면 생활이 불안정해지실 수 있습니다.",
      wealthManagement: "현실적인 재테크가 필요합니다. 직관에만 의존하면 손해를 볼 수 있으니, 객관적인 데이터와 전문가의 조언을 참고하세요. 안정적인 수입원을 확보하면서 특수한 활동은 취미로 하는 것이 좋습니다.",
      relationshipAdvice: "현실 감각이 있는 배우자가 본인을 잡아주면 좋습니다. 본인이 몽상에 빠지실 때 현실로 데려와 주는 분이 필요하고, 그런 배우자를 만나면 균형 잡힌 삶을 살 수 있습니다.",
      healthFocus: "정신 건강이 특히 중요합니다. 불면증이나 우울감에 빠지지 않도록 주의하고, 햇볕을 쬐고 운동을 하는 등 현실적인 활동을 많이 하세요. 혼자 있는 시간이 너무 많으면 좋지 않으니 사람들과 어울리는 시간도 만드세요.",
    },
    중화: {
      lifePattern: "중화된 편인격이시라면 독특함과 현실 감각이 적당히 균형을 이룹니다. 특수한 관심사를 가지면서도 현실 세계에 발을 딛고 있고, 직관과 논리를 함께 활용하는 사람입니다.",
      careerDirection: "창의적인 분야에서 실용적인 결과물을 만들어내는 역할이 잘 맞습니다. 연구 개발, 창작 활동, 컨설팅 등에서 독특한 아이디어를 현실화하는 능력이 있습니다.",
      wealthManagement: "직관과 데이터를 함께 활용하는 투자를 합니다. 감으로만 하지도 않고 숫자에만 의존하지도 않으면서, 균형 잡힌 재테크를 하는 사람입니다.",
      relationshipAdvice: "본인의 독특함을 인정해주면서도 함께 현실을 살아가는 배우자가 좋습니다. 서로의 다름을 존중하면서 조화롭게 살아가는 관계가 이상적입니다.",
      healthFocus: "정신과 육체의 균형에 신경 쓰세요. 명상과 운동을 병행하면서 몸과 마음을 함께 돌보면 건강하게 지냅니다.",
    },
  },
  정재격: {
    신강: {
      lifePattern: "신강한 정재격이시라면 재물을 감당할 힘이 있어서 대길입니다. 큰 재물도 잘 관리하고, 돈이 돈을 낳는 선순환을 만들 수 있습니다. 성실한 노력으로 차곡차곡 재물을 쌓아가면서 결국 큰 부를 이루는 사람입니다. 아내 복이 좋고 가정에 충실합니다.",
      careerDirection: "금융, 회계, 세무, 자산 관리 등 돈을 다루는 분야에서 성공합니다. 안정적인 대기업이나 공기업에서 고위직으로 올라가면서 높은 연봉을 받는 경우도 많습니다. 사업을 하면 리스크가 적은 안정적인 분야에서 성공합니다.",
      wealthManagement: "재물 관리의 달인입니다. 수입과 지출을 철저히 관리하고, 저축과 투자를 병행하면서 꾸준히 자산을 늘려갑니다. 부동산 투자도 잘하고, 노후 대비도 철저히 하는 사람입니다.",
      relationshipAdvice: "책임감 있고 헌신적인 배우자입니다. 가정 경제를 안정적으로 이끌어가면서 배우자와 자녀에게 경제적 안정을 제공합니다. 결혼 후 더욱 재물운이 좋아지는 사람이 많습니다.",
      healthFocus: "성실하게 일하느라 건강을 소홀히 하지 마세요. 돈은 벌어놓고 건강이 안 좋으면 의미가 없으니, 규칙적인 운동과 건강검진으로 몸을 챙기세요. 스트레스 관리와 충분한 휴식도 중요합니다.",
    },
    신약: {
      lifePattern: "신약한 정재격이시라면 재물을 감당하기가 다소 힘먹을 수 있습니다. 돈은 있는데 쓸 곳이 많으시거나, 재물 때문에 스트레스를 받을 수 있습니다. 비겁(比劫)의 도움으로 힘을 보강하거나, 너무 큰 재물을 욕심내시지 않으면 좋습니다.",
      careerDirection: "혼자 큰 재물을 다루시기보다 팀으로 일하는 것이 좋습니다. 재무팀의 일원으로 일하거나 파트너와 함께 사업을 하면 부담이 줄어듭니다. 작은 규모에서 시작하면서 점차 키워가는 것이 안전합니다.",
      wealthManagement: "무리한 투자는 피하고 안전한 방법으로 재물을 모으세요. 급하게 부자가 되려 하지 말고, 꾸준히 저축하면서 천천히 가세요. 큰 빚은 지지 말고, 현금 흐름을 안정적으로 유지하세요.",
      relationshipAdvice: "경제적으로 든든한 배우자를 만나면 좋습니다. 본인 혼자 가정 경제를 책임지시기보다 배우자와 함께 관리하면 부담이 줄어들고, 서로 보완하면서 안정적인 재정을 유지할 수 있습니다.",
      healthFocus: "재물 걱정으로 건강을 해치지 마세요. 스트레스가 건강에 직접 영향을 주니, 마음을 편히 가지고 현재에 감사하는 태도가 필요합니다. 규칙적인 생활과 적당한 운동으로 체력을 키우세요.",
    },
    중화: {
      lifePattern: "중화된 정재격이시라면 재물과 본인의 힘이 적당히 균형을 이룹니다. 크게 부자가 되지는 않아도 경제적으로 곤란하지 않고, 안정적인 재정 상태를 유지하면서 살아가는 사람입니다.",
      careerDirection: "중간 규모의 안정적인 직장이나 사업이 잘 맞습니다. 너무 크지도 작지도 않은 규모에서 꾸준히 수입을 올리면서, 장기적으로 성장하는 방식이 좋습니다.",
      wealthManagement: "균형 잡힌 재테크를 하는 사람입니다. 저축과 투자, 소비의 균형을 잘 맞추면서 무리하지 않는 재정 운용을 합니다. 노후에도 편안하게 지내실 정도의 자산은 모읍니다.",
      relationshipAdvice: "경제적으로 대등한 배우자와 함께하면 좋습니다. 서로 비슷한 재정 관념을 가지고 함께 가정 경제를 운영하면 조화롭게 살아갑니다.",
      healthFocus: "건강도 재정처럼 균형 있게 관리하세요. 무리하지 않으면 오래 건강하게 사는 사람이니, 적당한 운동과 균형 잡힌 식사로 건강을 유지하세요.",
    },
  },
  편재격: {
    신강: {
      lifePattern: "신강한 편재격이시라면 큰 사업을 감당할 힘이 있어서 대길입니다. 여러 사업체를 운영하거나 큰 규모의 투자를 해도 성공할 가능성이 높습니다. 돈의 흐름을 읽는 능력이 있고, 기회가 왔을 때 과감하게 베팅하는 결단력이 있습니다.",
      careerDirection: "사업가, 투자자, 무역업, 유통업 등 큰 돈을 굴리는 분야에서 성공합니다. 직장 생활보다 사업이 더 맞고, 여러 분야에 손을 대면서 규모를 키워가는 사람입니다. 부동산 개발이나 금융 투자로도 큰 돈을 버는 사람들이 많습니다.",
      wealthManagement: "공격적인 투자로 큰 수익을 올리는 타입입니다. 안전한 투자보다 하이 리스크 하이 리턴을 추구하고, 그것이 성공하는 경우가 많습니다. 다만 실패하면 손실도 크니 리스크 관리는 철저히 하세요.",
      relationshipAdvice: "사업에 바쁘다 보니 가정을 소홀히 할 수 있습니다. 배우자에게 경제적으로는 풍족하게 해주지만 시간을 못 내면 서운해할 수 있으니, 가정에도 신경 쓰세요. 이성 인연이 많을 수 있으니 가정에 충실하세요.",
      healthFocus: "무리한 사업 활동으로 건강을 해칠 수 있습니다. 술자리가 많고 스트레스가 많으니 간 건강과 위장 건강에 주의하세요. 정기적인 건강검진을 받고, 휴식 시간도 확보하세요.",
    },
    신약: {
      lifePattern: "신약한 편재격이시라면 큰 재물을 감당하기가 힘먹을 수 있습니다. 돈이 들어와도 나가는 것도 많으시거나, 사업에서 무리하다가 손실을 볼 수 있습니다. 몸집을 키우시기보다 적정 규모를 유지하면서 안정을 추구하는 것이 좋습니다.",
      careerDirection: "혼자 큰 사업을 하기보다 파트너와 함께하거나 중소 규모의 사업을 하는 것이 안전합니다. 무역이나 유통보다 서비스업이나 소매업처럼 리스크가 적은 분야가 좋고, 직장 생활도 나쁘지 않습니다.",
      wealthManagement: "무리한 투자는 피하고 안정적인 방법으로 재물을 모으세요. 한탕을 노리면 위험하고, 꾸준히 작은 것을 쌓아가는 것이 결국 더 큰 부가 됩니다. 보수적인 재테크가 좋습니다.",
      relationshipAdvice: "경제 관념이 뚜렷한 배우자를 만나면 좋습니다. 본인이 쓰시려 할 때 잡아주고, 함께 재정을 관리해주는 분이 필요합니다. 배우자의 도움으로 재정이 안정되는 경우가 많습니다.",
      healthFocus: "체력 관리가 중요합니다. 사업 활동에 많은 에너지가 필요하니 기본 체력을 키우고, 무리하지 마세요. 특히 간과 심장 건강에 주의하고, 술과 담배는 줄이세요.",
    },
    중화: {
      lifePattern: "중화된 편재격이시라면 사업 수완과 안정 사이에서 균형을 잡는 사람입니다. 적당한 규모의 사업을 하면서 무리하지 않고, 리스크를 관리하면서 성장하는 타입입니다.",
      careerDirection: "중간 규모의 사업이나 프랜차이즈 등이 잘 맞습니다. 너무 크지 않은 규모에서 안정적으로 운영하면서 점차 확장해가는 방식이 좋습니다.",
      wealthManagement: "공격적인 투자와 안정적인 저축을 병행하는 사람입니다. 일부는 투자에, 일부는 저축에 배분하면서 균형 잡힌 재테크를 합니다.",
      relationshipAdvice: "사업과 가정 사이에서 균형을 잘 잡는 사람입니다. 배우자에게도 시간을 내고 경제적 풍요도 제공하면서 조화로운 가정을 꾸립니다.",
      healthFocus: "건강 관리도 균형 있게 하세요. 바쁘더라도 운동과 휴식을 챙기면서 건강을 유지하면 오래 사업을 할 수 있습니다.",
    },
  },
  식신격: {
    신강: {
      lifePattern: "신강한 식신격이시라면 창작 에너지가 풍부하고 표현력이 뛰어납니다. 내 안에 있는 것을 밖으로 표현하는 능력이 탁월하고, 그것이 다른 사람들에게 기쁨과 영감을 줍니다. 낙천적이고 여유가 있며, 함께 있으면 편안함을 주는 사람입니다.",
      careerDirection: "요리사, 작가, 예술가, 강사, 연예인 등 창작과 표현 분야에서 성공합니다. 본인의 재능을 마음껏 발휘하면서 그것으로 돈도 버는 사람입니다. 식신생재(食神生財)로 창작 활동이 재물로 이어지는 경우가 많습니다.",
      wealthManagement: "재능으로 돈을 버는 사람입니다. 억지로 돈을 벌려고 하면 안 되고, 본인이 좋아하는 일을 하면 자연스럽게 수입이 따라옵니다. 스트레스 없이 일하면서 복록이 따르는 사람입니다.",
      relationshipAdvice: "함께 있으면 편안한 분이시라 인기가 많습니다. 배우자에게도 여유롭게 대하고 자녀에게도 다정한 부모가 됩니다. 아이들과 잘 어울리고 자녀 복이 좋으신 사람입니다.",
      healthFocus: "먹는 것을 좋아하니 체중 관리에 주의하세요. 미식가이시다 보니 과식하거나 좋은 음식을 많이 먹으면서 살이 찌실 수 있습니다. 적당한 운동으로 체중을 관리하고, 과음과 과식은 피하세요.",
    },
    신약: {
      lifePattern: "신약한 식신격이시라면 표현은 하고 싶으신데 에너지가 따라주지 않을 수 있습니다. 창작 활동이 본인을 지치게 할 수 있고, 너무 많이 쏟아내시다가 탈이 나실 수 있습니다. 인성(印星)의 도움으로 에너지를 보충하고, 무리하지 마세요.",
      careerDirection: "혼자 모든 것을 하기보다 팀으로 일하는 것이 좋습니다. 본인은 아이디어를 내고 다른 사람들이 실행하는 구조가 좋고, 체력 소모가 적은 방식으로 일하세요. 글을 쓰시거나 온라인으로 활동하는 것도 좋습니다.",
      wealthManagement: "체력을 너무 소모하면서 돈을 벌면 건강이 상하니, 효율적으로 일하면서 수입을 올리는 방법을 찾으세요. 수동적인 수입원(로열티, 인세 등)을 만들면 몸은 쉬면서도 돈이 들어옵니다.",
      relationshipAdvice: "편인(偏印)이 있으면 도식(倒食)에 주의하세요. 배우자나 가족 중에 본인의 에너지를 빼앗아가는 사람이 있으면 거리를 두고, 본인을 지지해주는 사람들과 함께하세요.",
      healthFocus: "체력 관리가 매우 중요합니다. 충분히 먹고 충분히 자면서 에너지를 채우고, 과도한 활동은 피하세요. 소화기 계통 건강에 신경 쓰고, 스트레스 없이 여유롭게 사는 것이 좋습니다.",
    },
    중화: {
      lifePattern: "중화된 식신격이시라면 창작 활동과 휴식 사이에서 균형을 잘 잡는 사람입니다. 표현하고 싶을 때 표현하고 쉬고 싶을 때 쉬면서, 무리하지 않는 창작 활동을 하는 사람입니다.",
      careerDirection: "창작과 안정 사이에서 균형 잡힌 직업이 좋습니다. 프리랜서보다는 안정적인 소속을 가지면서 창작 활동을 하거나, 취미로 창작을 하면서 본업은 따로 가지는 것도 좋습니다.",
      wealthManagement: "안정적인 수입과 창작 수입을 병행하는 사람입니다. 본업에서 안정적인 급여를 받으면서 부업으로 창작 활동을 하면 두 마리 토끼를 잡을 수 있습니다.",
      relationshipAdvice: "배우자와 함께 여유롭게 살면서 서로의 취미를 존중하는 관계가 이상적입니다. 맛있는 것을 함께 먹고 즐거운 시간을 보내면 행복한 가정을 꾸립니다.",
      healthFocus: "건강 관리도 균형 있게 하세요. 맛있는 것도 먹고 운동도 하면서, 체중 관리와 건강 유지를 병행하면 오래 건강하게 삽니다.",
    },
  },
  상관격: {
    신강: {
      lifePattern: "신강한 상관격이시라면 재능을 마음껏 발휘할 수 있습니다. 뛰어난 표현력과 언변으로 사람들을 매료시키고, 남다른 개성으로 주목받는 사람입니다. 자유분방하면서도 그것을 감당할 힘이 있으니, 대중적인 인기를 얻으시거나 전문 분야에서 두각을 나타내실 수 있습니다.",
      careerDirection: "연예인, 예술가, 변호사, 프리랜서, 평론가 등 표현 능력이 중요한 분야에서 크게 성공합니다. 상관생재(傷官生財)로 재능을 통해 큰 재물을 얻는 경우도 많고, 본인만의 독특한 스타일로 시장을 개척하는 사람입니다.",
      wealthManagement: "재능으로 큰 돈을 버실 수 있는 사람입니다. 다만 버는 것도 크시지만 쓰는 것도 크니, 재정 관리에 신경 쓰세요. 젊을 때 많이 벌어도 노후 대비를 해두시지 않으면 나중에 어려울 수 있습니다.",
      relationshipAdvice: "자유로운 관계를 원하다 보니 결혼 생활에서 갈등이 있을 수 있습니다. 특히 정관(正官)이 있는 사주라면 '상관견관(傷官見官)'으로 배우자(여성의 경우 남편)나 직장과의 충돌이 있을 수 있습니다. 배우자에게도 자유를 주면서 서로 존중하는 관계를 만드세요.",
      healthFocus: "성대와 호흡기 건강에 주의하세요. 말을 많이 하고 표현을 많이 하다 보니 목이 상할 수 있습니다. 또한 신경이 예민하니 정신 건강도 챙기고, 충분한 휴식으로 에너지를 충전하세요.",
    },
    신약: {
      lifePattern: "신약한 상관격이시라면 말은 많고 생각은 많으신데 정작 실행은 못 하는 경우가 있습니다. 상관의 에너지가 본인을 지치게 할 수 있고, 비판은 잘하지만 건설적인 결과물을 내시기 어려울 수 있습니다. 인성(印星)으로 상관을 제어하면 균형을 잡을 수 있습니다.",
      careerDirection: "혼자 모든 것을 표현하기보다 팀에서 아이디어를 제공하는 역할이 좋습니다. 기획이나 컨설팅처럼 말로 가치를 전달하는 일이 맞고, 직접 무대에 서시기보다 뒤에서 지원하는 역할도 좋습니다.",
      wealthManagement: "재능을 돈으로 연결하는 것이 어려울 수 있으니, 안정적인 본업을 가지면서 재능은 부업으로 발휘하는 것이 좋습니다. 큰 돈을 노리시기보다 안정적인 수입을 유지하면서 점차 영역을 넓혀가세요.",
      relationshipAdvice: "말조심을 해야 합니다. 날카로운 비판이 상대방을 상하게 할 수 있고, 가정에서도 잔소리가 많으면 배우자가 힘들어할 수 있습니다. 따뜻한 말, 긍정적인 표현을 연습하고, 비판보다 격려를 많이 해주세요.",
      healthFocus: "신경성 질환에 주의하세요. 생각이 너무 많으면 잠을 못 자거나 우울해지실 수 있습니다. 마음을 비우는 연습을 하고, 명상이나 요가로 정신을 안정시키세요. 소화기 계통 건강에도 신경 쓰세요.",
    },
    중화: {
      lifePattern: "중화된 상관격이시라면 재능과 현실 감각 사이에서 균형을 잡는 사람입니다. 표현하고 싶으신 것을 표현하면서도 너무 과하지 않고, 비판도 하지만 건설적인 방향으로 가는 사람입니다.",
      careerDirection: "창작과 안정 사이에서 균형 잡힌 직업이 좋습니다. 광고, 마케팅, 콘텐츠 제작 등 창의성을 발휘하면서도 조직에 소속되어 안정적으로 일하는 분야가 맞습니다.",
      wealthManagement: "재능으로 버는 수입과 안정적인 급여를 병행하는 사람입니다. 한쪽에 치우치지 않고 균형 잡힌 수입 구조를 가지면서 안정적으로 재물을 모읍니다.",
      relationshipAdvice: "배우자와 적당한 거리를 유지하면서 서로의 자유를 존중하는 관계가 좋습니다. 너무 가깝지도 멀지도 않은 편안한 관계를 유지하면 오래 행복하게 삽니다.",
      healthFocus: "건강 관리도 균형 있게 하세요. 정신 건강과 육체 건강을 함께 챙기면서, 표현 활동과 휴식을 적절히 배분하면 건강하게 오래 활동할 수 있습니다.",
    },
  },
  비견격: {
    신강: {
      lifePattern: "신강한 비견격이시라면 독립심과 추진력이 더욱 강합니다. 혼자 힘으로 일어서고 혼자 힘으로 성공하려는 의지가 대단하며, 실제로 자수성가하는 사람들이 많습니다. 경쟁에서도 이기는 사람이고, 누구에게도 지지 않으려는 강한 자존심이 있습니다.",
      careerDirection: "독립적인 사업이나 경쟁적인 분야에서 성공합니다. 동업보다는 단독 사업이 좋고, 프랜차이즈 본사나 독자적인 브랜드를 운영하는 것이 맞습니다. 스포츠 분야에서도 개인 종목에서 두각을 나타내는 사람들이 많습니다.",
      wealthManagement: "혼자 힘으로 재물을 일구는 사람입니다. 남에게 의지하지 않고 본인의 노력으로 부를 쌓아가니, 자수성가의 표본이 되는 사람입니다. 다만 너무 혼자 하려 하면 한계가 있으니, 때로는 도움을 받아들이는 여유도 필요합니다.",
      relationshipAdvice: "동등한 관계를 원하다 보니 지배적인 배우자와는 충돌이 있을 수 있습니다. 서로 독립적이면서도 존중하는 관계가 이상적이고, 배우자도 본인만의 영역이 있는 분이 맞습니다. 자존심 싸움을 피하고 양보하는 연습도 하세요.",
      healthFocus: "과로에 주의하세요. 혼자 다 하려 하다 보니 몸이 상할 수 있습니다. 일을 나누고 도움을 받으면서, 본인의 건강도 챙기세요. 근골격계 건강과 면역력 관리에 신경 쓰고, 충분한 휴식을 취하세요.",
    },
    신약: {
      lifePattern: "신약한 비견격이시라면 비견의 도움이 필요합니다. 형제나 친구, 동료의 도움을 받으면 좋고, 혼자 하기보다 파트너와 함께하는 것이 유리합니다. 경쟁보다 협력이 더 좋은 결과를 가져다주고, 팀워크를 발휘하면 성공합니다.",
      careerDirection: "동업이나 파트너십으로 일하는 것이 좋습니다. 혼자 사업을 하면 힘들고, 역할을 나누어 함께 일하면 시너지가 납니다. 프랜차이즈 가맹점이나 대리점 형태도 좋고, 조직 내에서 팀원으로 일하는 것도 맞습니다.",
      wealthManagement: "재물을 함께 관리하는 것이 좋습니다. 혼자 큰 돈을 다루면 버거우니, 배우자나 파트너와 함께 재정을 운용하면 안정적입니다. 다만 동업에서 재물 분배 문제가 생기지 않도록 처음부터 명확히 정해두세요.",
      relationshipAdvice: "배우자나 형제의 도움이 큰 힘이 됩니다. 함께 협력하면서 서로 보완해주는 관계가 이상적이고, 경쟁하기보다 함께 성장하는 방향으로 가세요. 좋은 파트너를 만나면 인생이 달라지는 사람입니다.",
      healthFocus: "체력을 키우는 것이 중요합니다. 기본 체력이 있어야 경쟁에서 버틸 수 있으니, 규칙적인 운동과 충분한 영양 섭취로 몸을 만드세요. 혼자 무리하지 말고, 도움을 받으면서 건강하게 살아가세요.",
    },
    중화: {
      lifePattern: "중화된 비견격이시라면 독립과 협력 사이에서 균형을 잡는 사람입니다. 혼자 할 수 있는 것은 혼자 하고, 도움이 필요할 때는 도움을 받으면서 유연하게 대처하는 사람입니다.",
      careerDirection: "독립과 협력을 상황에 맞게 선택하는 사람입니다. 때로는 단독으로, 때로는 팀으로 일하면서 최적의 결과를 내는 유연한 사람입니다. 중간 규모의 사업이나 프로젝트 리더 역할이 잘 맞습니다.",
      wealthManagement: "독자적인 수입과 공동의 수입을 병행하는 사람입니다. 본업에서는 안정적인 급여를 받으면서 부업에서는 독립적으로 수입을 올리는 구조도 좋습니다.",
      relationshipAdvice: "배우자와 적당한 독립성을 유지하면서 협력하는 관계가 좋습니다. 각자의 영역은 존중하면서도 중요한 일은 함께 결정하는 파트너십이 이상적입니다.",
      healthFocus: "건강 관리도 균형 있게 하세요. 혼자 운동하기도 하고 함께 운동하기도 하면서, 꾸준히 건강을 유지하면 오래 활동할 수 있습니다.",
    },
  },
  겁재격: {
    신강: {
      lifePattern: "신강한 겁재격이시라면 겁재의 에너지를 잘 통제하면서 강력한 추진력으로 쓰실 수 있습니다. 경쟁에서 이기실 가능성이 높고, 큰 도전도 해내실 수 있습니다. 위기 상황에서 오히려 힘을 발휘하고, 남들이 두려워하는 일도 거침없이 해내는 사람입니다.",
      careerDirection: "경쟁이 치열한 분야에서 두각을 나타냅니다. 투자, 부동산, 스포츠, 영업 등 승부를 걸어야 하는 분야에서 성공하는 사람들이 많고, 위험을 감수하면서 큰 것을 얻어내는 사람입니다. 사업가로서도 과감한 결단으로 성공하는 경우가 많습니다.",
      wealthManagement: "큰 것을 노리고 큰 것을 얻는 타입입니다. 안전한 투자보다 하이 리스크 하이 리턴을 추구하고, 그것이 성공하는 경우가 많습니다. 다만 도박이나 투기에 빠지면 큰 손실을 볼 수 있으니 선을 지키세요.",
      relationshipAdvice: "승부욕이 가정에서도 나오면 갈등이 생깁니다. 배우자와 경쟁하지 말고 함께 성장하는 관계를 만드세요. 자녀에게도 지나친 경쟁심을 심어주지 말고, 편안한 가정을 만들어 주는 것이 좋습니다.",
      healthFocus: "과도한 경쟁과 스트레스로 건강을 해칠 수 있습니다. 심장과 혈관 건강에 주의하고, 분노 조절에도 신경 쓰세요. 격렬한 운동보다 명상이나 요가로 마음을 안정시키는 것도 좋습니다. 절제하는 습관을 기르세요.",
    },
    신약: {
      lifePattern: "신약한 겁재격이시라면 겁재의 에너지가 본인을 해칠 수 있습니다. 무리한 승부를 하다가 손실을 보시거나, 건강을 해칠 수 있습니다. 관성(官星)으로 겁재를 제어하거나 식상(食傷)으로 에너지를 빼면 균형을 잡을 수 있습니다.",
      careerDirection: "혼자 큰 승부를 하기보다 조직 내에서 안정적으로 일하는 것이 좋습니다. 경쟁이 너무 치열한 분야보다는 적당한 긴장감이 있는 분야에서 일하면 무리 없이 성공할 수 있습니다. 도전은 하시되 무모한 모험은 피하세요.",
      wealthManagement: "도박이나 투기는 절대 하면 안 됩니다. 큰 돈이 왔다 갔다 하는 상황을 만들지 말고, 안정적인 수입을 유지하면서 차곡차곡 모으세요. 재물 욕심을 내려놓으면 오히려 더 안정적으로 가시게 됩니다.",
      relationshipAdvice: "배우자의 도움이 필요합니다. 본인을 잡아주고 안정시켜주는 배우자를 만나면 무모한 행동을 하지 않고, 안정적인 삶을 사시게 됩니다. 경쟁심을 가정에 가져오지 말고, 편안한 안식처로 만드세요.",
      healthFocus: "무리하면 바로 몸에 티가 나니 과로하지 마세요. 심장과 혈관 건강에 주의하고, 화를 참으면 병이 되니 적절히 풀어주세요. 규칙적인 생활과 충분한 휴식으로 몸을 보호하고, 절제하는 생활을 하세요.",
    },
    중화: {
      lifePattern: "중화된 겁재격이시라면 경쟁심과 안정 사이에서 균형을 잡는 사람입니다. 도전할 때 도전하고 쉬실 때 쉬면서, 무리하지 않는 선에서 승부를 거는 사람입니다.",
      careerDirection: "적당한 경쟁이 있는 분야에서 능력을 발휘합니다. 너무 안전하지도 위험하지도 않은 분야에서 균형 잡힌 성장을 하는 사람이고, 팀 내에서도 적당한 경쟁과 협력을 병행하면서 성과를 냅니다.",
      wealthManagement: "모험과 안정 사이에서 균형 잡힌 투자를 합니다. 일부는 공격적으로, 일부는 안전하게 투자하면서 리스크를 분산하고, 전체적으로 안정적인 재정 상태를 유지합니다.",
      relationshipAdvice: "배우자와 적당한 긴장감 속에서 건강한 관계를 유지합니다. 가끔 경쟁도 하고 협력도 하면서 서로 성장하는 관계가 이상적입니다.",
      healthFocus: "건강 관리도 균형 있게 하세요. 격렬한 운동도 하고 휴식도 취하면서, 몸과 마음의 균형을 맞추면 건강하게 오래 삽니다.",
    },
  },
};

// 십신에서 격국으로 매핑
const TEN_GOD_TO_FORMAT: Record<TenGodName, FormatName> = {
  정관: "정관격",
  편관: "편관격",
  정인: "정인격",
  편인: "편인격",
  정재: "정재격",
  편재: "편재격",
  식신: "식신격",
  상관: "상관격",
  비견: "비견격",
  겁재: "겁재격",
};

// 격국별 상세 정보
const FORMAT_INFO: Record<FormatName, {
  category: "정격" | "특수격" | "외격";
  characteristics: string;
  careerTendency: string;
  wealthPattern: string;
  relationshipStyle: string;
  idealConditions: string[];
  breakingFactors: string[];
}> = {
  정관격: {
    category: "정격",
    characteristics: "책임감이 강하고 원칙적이며 공직이나 조직 생활에 적합합니다. 명예를 중시하고 사회적 인정을 추구합니다.",
    careerTendency: "공무원, 대기업 임원, 법조인, 교육자 등 안정적이고 권위 있는 직종에 적합합니다.",
    wealthPattern: "급여 생활이나 안정적인 수입을 선호하며, 투기보다는 저축과 계획적 재정 운용을 합니다.",
    relationshipStyle: "신중하고 책임감 있는 관계를 형성하며, 결혼 후 가정에 충실합니다.",
    idealConditions: ["관성이 월지에 투출", "일간이 약하지 않음", "재성이 관성을 생함", "인성이 적당히 있음"],
    breakingFactors: ["상관이 관을 극함(상관견관)", "관성이 너무 많음", "비겁이 과다함"],
  },
  편관격: {
    category: "정격",
    characteristics: "강한 추진력과 결단력을 가졌으며, 도전적이고 권위적입니다. 위기 상황에서 빛을 발합니다.",
    careerTendency: "군인, 경찰, 스포츠 선수, 외과 의사, 벤처 사업가 등 강한 결단이 필요한 분야에 적합합니다.",
    wealthPattern: "큰 것을 노리며, 투자와 사업에서 승부수를 던지는 경향이 있습니다.",
    relationshipStyle: "열정적이고 지배적인 관계를 형성하며, 때로는 갈등도 있습니다.",
    idealConditions: ["식신이 편관을 제어", "일간이 신강함", "인성이 편관을 화(化)함"],
    breakingFactors: ["식신이 없어 칠살이 무제어", "편관이 너무 많음", "일간이 너무 약함"],
  },
  정인격: {
    category: "정격",
    characteristics: "학문을 좋아하고 지적이며, 어머니 복이 있습니다. 자격증이나 문서 관련 일에 유리합니다.",
    careerTendency: "학자, 연구원, 교사, 작가, 공인중개사 등 지식 기반 직종에 적합합니다.",
    wealthPattern: "안정적인 수입을 선호하며, 자격증이나 문서를 통해 재물을 얻습니다.",
    relationshipStyle: "지적인 교류를 중시하며, 정신적 유대감이 중요합니다.",
    idealConditions: ["인성이 월지에 투출", "관성이 인성을 생함", "일간이 적당히 약함"],
    breakingFactors: ["재성이 인성을 극함", "인성이 너무 많음(탐인무사)", "식상이 과다함"],
  },
  편인격: {
    category: "정격",
    characteristics: "특수한 재능이 있고 영적 감각이 있습니다. 전통적이지 않은 학문이나 기술에 소질이 있습니다.",
    careerTendency: "종교인, 역술가, 심리상담사, 연구원, 프리랜서 등 독특한 분야에 적합합니다.",
    wealthPattern: "일반적인 방법보다 특수한 기술이나 재능으로 수입을 얻습니다.",
    relationshipStyle: "독립적이고 자유로운 관계를 선호하며, 때로는 고독함을 느낍니다.",
    idealConditions: ["편관이 편인을 생함", "재성이 적당히 있음", "식신을 해치지 않음"],
    breakingFactors: ["식신을 극함(도식)", "편인이 너무 많음", "재성에 극을 당함"],
  },
  정재격: {
    category: "정격",
    characteristics: "성실하고 실속 있으며, 안정된 재물 관리 능력이 있습니다. 저축과 계획을 중시합니다.",
    careerTendency: "회계사, 은행원, 세무사, 재정 관리, 안정적 사업 등에 적합합니다.",
    wealthPattern: "급여나 안정된 수입을 선호하며, 차곡차곡 모으는 타입입니다.",
    relationshipStyle: "책임감 있고 헌신적이며, 가정적인 배우자가 됩니다.",
    idealConditions: ["재성이 월지에 투출", "일간이 신강함", "식상이 재성을 생함"],
    breakingFactors: ["비겁에 재를 빼앗김", "재성이 너무 약함", "관살이 혼잡함"],
  },
  편재격: {
    category: "정격",
    characteristics: "사업 수완이 뛰어나고 융통성이 있습니다. 투자와 사업에 재능이 있습니다.",
    careerTendency: "사업가, 투자자, 무역업, 유통업, 영업 등 돈을 다루는 분야에 적합합니다.",
    wealthPattern: "큰 돈을 벌고 쓰며, 투자와 사업으로 재물을 불립니다.",
    relationshipStyle: "넓은 인간관계를 가지며, 때로는 복잡한 인연이 있을 수 있습니다.",
    idealConditions: ["재성이 월지에 투출", "일간이 신강함", "관성이 재를 보호함"],
    breakingFactors: ["비겁에 극을 당함", "재성이 너무 많아 신약해짐", "관살이 혼잡함"],
  },
  식신격: {
    category: "정격",
    characteristics: "창의적이고 표현력이 좋으며, 먹고 사는 복이 있습니다. 낙천적이고 여유롭습니다.",
    careerTendency: "요리사, 작가, 예술가, 강사, 서비스업 등 표현과 창작 분야에 적합합니다.",
    wealthPattern: "재능과 표현을 통해 수입을 얻으며, 복록이 따릅니다.",
    relationshipStyle: "부드럽고 이해심이 깊으며, 자녀 복이 좋습니다.",
    idealConditions: ["식신이 월지에 투출", "재성이 식신의 기운을 받음", "편인이 식신을 해치지 않음"],
    breakingFactors: ["편인에 극을 당함(도식)", "식신이 너무 많음", "관성이 너무 강함"],
  },
  상관격: {
    category: "정격",
    characteristics: "재능이 뛰어나고 언변이 좋습니다. 자유분방하고 개성이 강합니다.",
    careerTendency: "연예인, 변호사, 프리랜서, 예술가, 평론가 등 표현 능력이 중요한 분야에 적합합니다.",
    wealthPattern: "재능으로 큰 돈을 벌 수 있지만 지출도 큽니다.",
    relationshipStyle: "자유로운 관계를 원하며, 정관(남편/직장)과 충돌이 있을 수 있습니다.",
    idealConditions: ["상관이 재를 생함(상관생재)", "정관이 없거나 약함", "인성이 상관을 제어"],
    breakingFactors: ["정관을 극함(상관견관)", "상관이 너무 많음", "인성에 극을 당함"],
  },
  비견격: {
    category: "정격",
    characteristics: "독립심이 강하고 자수성가 타입입니다. 협력보다 경쟁을 통해 성장합니다.",
    careerTendency: "동업, 프랜차이즈, 경쟁적 사업, 스포츠 등에 적합합니다.",
    wealthPattern: "혼자 힘으로 재물을 일구며, 동업에서는 갈등 주의가 필요합니다.",
    relationshipStyle: "동등한 관계를 원하며, 경쟁적인 면이 있습니다.",
    idealConditions: ["비견이 적당히 있음", "관성이 비견을 제어", "재성이 있어 목표가 있음"],
    breakingFactors: ["비견이 너무 많아 재를 쟁탈", "관성이 없음", "식상이 없음"],
  },
  겁재격: {
    category: "정격",
    characteristics: "추진력이 강하고 모험적입니다. 승부욕이 강하고 투쟁심이 있습니다.",
    careerTendency: "경쟁적 사업, 스포츠, 투자, 도전적인 분야에 적합합니다.",
    wealthPattern: "큰 것을 노리지만 재물 손실도 있을 수 있습니다.",
    relationshipStyle: "강렬한 관계를 형성하며, 갈등과 화해가 반복될 수 있습니다.",
    idealConditions: ["관성이 겁재를 제어", "재성이 있어 목표가 있음", "식상으로 기운을 설기"],
    breakingFactors: ["겁재가 너무 많아 재를 빼앗음", "관성이 없음", "식상도 없음"],
  },
};

// ============================================
// 분석 함수
// ============================================

/**
 * 천간/지지에서 십신 판정
 */
function getTenGod(
  targetElement: FiveElementKey,
  targetYinYang: "양" | "음",
  ilganElement: FiveElementKey,
  ilganYinYang: "양" | "음"
): TenGodName {
  const relations = ELEMENT_RELATIONS[ilganElement];
  const isSameYinYang = targetYinYang === ilganYinYang;

  if (targetElement === relations.same) {
    return isSameYinYang ? "비견" : "겁재";
  }
  if (targetElement === relations.generates) {
    return isSameYinYang ? "식신" : "상관";
  }
  if (targetElement === relations.controls) {
    return isSameYinYang ? "편재" : "정재";
  }
  if (targetElement === relations.controlled) {
    return isSameYinYang ? "편관" : "정관";
  }
  if (targetElement === relations.generated) {
    return isSameYinYang ? "편인" : "정인";
  }

  return "비견";
}

/**
 * 월지에서 격국 추출 (월령용신법)
 */
function getFormatFromMonthBranch(
  monthBranch: string,
  ilgan: string
): { format: FormatName; tenGod: TenGodName } {
  const mainStem = JIJI_MAIN_STEM[monthBranch];
  const mainStemElement = CHEONGAN_OHENG[mainStem];
  const mainStemYinYang = CHEONGAN_YINYANG[mainStem];

  const ilganElement = CHEONGAN_OHENG[ilgan];
  const ilganYinYang = CHEONGAN_YINYANG[ilgan];

  const tenGod = getTenGod(mainStemElement, mainStemYinYang, ilganElement, ilganYinYang);
  const format = TEN_GOD_TO_FORMAT[tenGod];

  return { format, tenGod };
}

/**
 * 월지 지장간이 천간에 투출했는지 확인
 */
function checkTouchul(
  monthBranch: string,
  pillars: Pillar[]
): boolean {
  const mainStem = JIJI_MAIN_STEM[monthBranch];

  // 년간, 월간, 시간에서 본기와 같은 천간이 있는지 확인
  for (let i = 0; i < pillars.length; i++) {
    if (i === 2) continue; // 일간은 제외
    if (pillars[i].cheongan === mainStem) {
      return true;
    }
  }
  return false;
}

/**
 * 격국 성립 조건 확인
 */
function checkEstablishmentConditions(
  format: FormatName,
  pillars: Pillar[],
  ilgan: string,
  monthBranch: string
): { isEstablished: boolean; conditions: string[]; metConditions: string[] } {
  const formatInfo = FORMAT_INFO[format];
  const idealConditions = formatInfo.idealConditions;
  const metConditions: string[] = [];

  // 월지 투출 여부
  const isTouchul = checkTouchul(monthBranch, pillars);
  if (isTouchul) {
    metConditions.push("월지 본기가 천간에 투출함");
  }

  // 간단한 조건 체크 (실제로는 더 복잡함)
  const ilganElement = CHEONGAN_OHENG[ilgan];

  // 신강/신약 여부 (간이 판정)
  let bigyeopCount = 0;
  let inseongCount = 0;
  for (const pillar of pillars) {
    if (pillar.cheongan && pillar.cheongan !== ilgan) {
      const stemElement = CHEONGAN_OHENG[pillar.cheongan];
      const relations = ELEMENT_RELATIONS[ilganElement];
      if (stemElement === relations.same) bigyeopCount++;
      if (stemElement === relations.generated) inseongCount++;
    }
    if (pillar.jiji) {
      const branchElement = JIJI_OHENG[pillar.jiji];
      const relations = ELEMENT_RELATIONS[ilganElement];
      if (branchElement === relations.same) bigyeopCount++;
      if (branchElement === relations.generated) inseongCount++;
    }
  }

  if (bigyeopCount + inseongCount >= 2) {
    metConditions.push("일간이 신강함 (비겁/인성 충분)");
  }

  const isEstablished = isTouchul || metConditions.length >= 1;

  return { isEstablished, conditions: idealConditions, metConditions };
}

/**
 * 격국 강도 판정
 */
function determineFormatStrength(
  metConditions: string[],
  isEstablished: boolean
): "강" | "중" | "약" {
  if (!isEstablished) return "약";
  if (metConditions.length >= 3) return "강";
  if (metConditions.length >= 2) return "중";
  return "약";
}

/**
 * 파격 요소 분석
 */
function analyzeBreakingFactors(
  format: FormatName,
  pillars: Pillar[],
  ilgan: string
): Chapter4Result["breakingFactors"] {
  const formatInfo = FORMAT_INFO[format];
  const potentialBreakers = formatInfo.breakingFactors;
  const foundFactors: string[] = [];

  const ilganElement = CHEONGAN_OHENG[ilgan];
  const ilganYinYang = CHEONGAN_YINYANG[ilgan];

  // 각 기둥의 십신 수집
  const tenGods: TenGodName[] = [];
  for (const pillar of pillars) {
    if (pillar.cheongan && pillar.cheongan !== ilgan) {
      const stemElement = CHEONGAN_OHENG[pillar.cheongan];
      const stemYinYang = CHEONGAN_YINYANG[pillar.cheongan];
      tenGods.push(getTenGod(stemElement, stemYinYang, ilganElement, ilganYinYang));
    }
    if (pillar.jiji) {
      const branchElement = JIJI_OHENG[pillar.jiji];
      const branchYinYang = JIJI_YINYANG[pillar.jiji];
      tenGods.push(getTenGod(branchElement, branchYinYang, ilganElement, ilganYinYang));
    }
  }

  // 상관견관 체크 (정관격에서)
  if (format === "정관격") {
    if (tenGods.includes("상관") && tenGods.includes("정관")) {
      foundFactors.push("상관이 정관을 해침 (상관견관)");
    }
  }

  // 도식 체크 (식신격에서)
  if (format === "식신격") {
    if (tenGods.includes("편인") && tenGods.includes("식신")) {
      foundFactors.push("편인이 식신을 해침 (도식)");
    }
  }

  // 비겁 과다로 재성 쟁탈
  if (format === "정재격" || format === "편재격") {
    const bigyeopCount = tenGods.filter(g => g === "비견" || g === "겁재").length;
    if (bigyeopCount >= 3) {
      foundFactors.push("비겁이 과다하여 재성을 빼앗음");
    }
  }

  const impact = foundFactors.length > 0
    ? `파격 요소가 있어 격국의 순수성이 훼손될 수 있습니다. ${foundFactors.join(", ")}에 주의하여 운의 흐름을 살펴야 합니다.`
    : "파격 요소가 없어 격국이 순수하게 유지됩니다.";

  return {
    exists: foundFactors.length > 0,
    factors: foundFactors.length > 0 ? foundFactors : potentialBreakers.slice(0, 2),
    impact,
  };
}

/**
 * 격국 의미 분석
 */
function analyzeFormatMeaning(format: FormatName): Chapter4Result["formatMeaning"] {
  const formatInfo = FORMAT_INFO[format];

  return {
    basicCharacter: formatInfo.characteristics,
    careerTendency: formatInfo.careerTendency,
    wealthPattern: formatInfo.wealthPattern,
    relationshipStyle: formatInfo.relationshipStyle,
  };
}

/**
 * 대운별 격국 변화 분석 (현재 대운 기준)
 */
function analyzeFormatChangeByDaeun(
  format: FormatName,
  currentDaeunGanZhi: string | null
): Chapter4Result["formatChangeByDaeun"] {
  if (!currentDaeunGanZhi) {
    return {
      currentDaeun: "대운 정보 없음",
      formatStatus: "유지",
      explanation: "대운 정보가 없어 격국 변화를 분석할 수 없습니다.",
    };
  }

  // 간단한 분석 (실제로는 대운의 십신과 격국의 관계를 봄)
  const daeunGan = currentDaeunGanZhi[0];
  const daeunElement = CHEONGAN_OHENG[daeunGan];

  let formatStatus: "강화" | "유지" | "약화" | "파격" = "유지";
  let explanation = "";

  // 격국과 대운 오행의 관계 분석 (간이)
  if (format === "정관격" || format === "편관격") {
    if (daeunElement === "수" || daeunElement === "목") {
      formatStatus = "강화";
      explanation = `현재 대운 ${currentDaeunGanZhi}이(가) 관성격을 생하거나 돕는 오행으로, 격국이 강화됩니다. 직장이나 사회적 지위에서 좋은 기회가 있습니다.`;
    }
  } else if (format === "정재격" || format === "편재격") {
    if (daeunElement === "화" || daeunElement === "토") {
      formatStatus = "강화";
      explanation = `현재 대운 ${currentDaeunGanZhi}이(가) 재성격을 생하거나 돕는 오행으로, 격국이 강화됩니다. 재물운이 좋아지는 시기입니다.`;
    }
  } else if (format === "식신격" || format === "상관격") {
    if (daeunElement === "토" || daeunElement === "금") {
      formatStatus = "강화";
      explanation = `현재 대운 ${currentDaeunGanZhi}이(가) 식상격을 돕는 오행으로, 격국이 강화됩니다. 표현력과 창작 활동에 유리한 시기입니다.`;
    }
  }

  if (formatStatus === "유지") {
    explanation = `현재 대운 ${currentDaeunGanZhi}은(는) 격국에 특별한 변화를 주지 않습니다. 기존 격국의 특성이 유지됩니다.`;
  }

  return {
    currentDaeun: currentDaeunGanZhi,
    formatStatus,
    explanation,
  };
}

/**
 * 격국 서술형 Narrative 생성
 */
function generateGeokgukNarrative(
  format: FormatName,
  strength: "강" | "중" | "약",
  isEstablished: boolean,
  breakingFactors: Chapter4Result["breakingFactors"],
  formatChangeByDaeun: Chapter4Result["formatChangeByDaeun"],
  sinGangSinYak?: string
): Chapter4Result["narrative"] {
  const narrative = FORMAT_NARRATIVES[format];

  if (!narrative) {
    return {
      intro: "격국 분석을 진행합니다.",
      mainAnalysis: "명식의 격국을 살펴보겠습니다.",
      details: [],
      advice: "",
      closing: "",
    };
  }

  // 신강/신약/중화 키 추출
  const strengthKey: "신강" | "신약" | "중화" = sinGangSinYak?.includes("신강") ? "신강"
    : sinGangSinYak?.includes("신약") ? "신약"
    : "중화";

  // 격국 × 신강/신약/중화 조합 조회
  const strengthNarrative = FORMAT_STRENGTH_NARRATIVES[format]?.[strengthKey];

  // 도입부
  const intro = `이제 격국(格局)에 대해 살펴보겠습니다. 격국이란 사주의 '틀'을 말하는 것으로, 그 사람의 인생 방향과 성공 패턴을 보여주는 중요한 요소입니다.\n\n${narrative.intro}`;

  // 본론: 격국 특성 + 신강/신약에 따른 분석
  let mainAnalysis = `【${format}의 특성】\n\n${narrative.mainAnalysis}\n\n`;

  if (strength === "강" || strength === "중") {
    mainAnalysis += `【신강한 사주의 ${format}】\n\n${narrative.strengthStrong}`;
  } else {
    mainAnalysis += `【신약한 사주의 ${format}】\n\n${narrative.strengthWeak}`;
  }

  // 상세 분석
  const details: string[] = [];

  // 격국 성립 여부
  if (isEstablished) {
    details.push(`【격국 성립 조건】\n\n${format}이 제대로 성립되어 있습니다. 월지의 기운이 천간에 투출하였거나 격국 성립에 필요한 조건들이 갖추어져 있습니다. 격국이 잘 성립되어 있으면 해당 격국의 특성이 더욱 뚜렷하게 발현됩니다.`);
  } else {
    details.push(`【격국 성립 조건】\n\n${format}의 성립 조건이 완벽하지는 않습니다. 격국이 불완전하면 해당 격국의 특성이 다소 약하게 나타나거나, 다른 격국의 특성이 섞여서 나타날 수 있습니다. 그러나 격국이 불완전하다고 해서 나쁜 것은 아닙니다. 다양한 가능성을 가지고 있다고 볼 수도 있습니다.`);
  }

  // 격국 × 신강/신약/중화 조합 상세 분석 (30개 조합)
  if (strengthNarrative) {
    details.push(`【${format} + ${strengthKey} 조합의 삶의 패턴】\n\n${strengthNarrative.lifePattern}`);
    details.push(`【${format} ${strengthKey} - 직업과 진로 방향】\n\n${strengthNarrative.careerDirection}`);
    details.push(`【${format} ${strengthKey} - 재물 관리와 투자 스타일】\n\n${strengthNarrative.wealthManagement}`);
    details.push(`【${format} ${strengthKey} - 대인관계와 결혼 생활】\n\n${strengthNarrative.relationshipAdvice}`);
    details.push(`【${format} ${strengthKey} - 건강 관리 포인트】\n\n${strengthNarrative.healthFocus}`);
  }

  // 파격 요소
  if (breakingFactors.exists) {
    let breakDetail = `【파격 요소 분석】\n\n${format}에 파격 요소가 있습니다. `;
    breakDetail += breakingFactors.factors.join(", ") + "의 기운이 격국을 흐트러뜨릴 수 있습니다.\n\n";
    breakDetail += breakingFactors.impact + "\n\n";
    breakDetail += "파격 요소가 있다고 해서 인생이 안 풀리는 것은 아닙니다. 오히려 그 에너지를 잘 활용하면 남들과 다른 독특한 성공을 거두실 수 있습니다. 다만 격국의 순수한 특성대로만 가시기는 어려우니, 유연하게 대처하는 것이 좋습니다.";
    details.push(breakDetail);
  }

  // 대운에 따른 변화
  if (formatChangeByDaeun.currentDaeun !== "대운 정보 없음") {
    let daeunDetail = `【현재 대운과 격국의 관계】\n\n`;
    daeunDetail += formatChangeByDaeun.explanation + "\n\n";

    if (formatChangeByDaeun.formatStatus === "강화") {
      daeunDetail += "현재 대운이 격국을 돕고 있으니 이 시기를 잘 활용하세요. 격국의 특성에 맞는 활동을 적극적으로 하면 좋은 결과를 얻을 수 있습니다.";
    } else if (formatChangeByDaeun.formatStatus === "약화") {
      daeunDetail += "현재 대운이 격국과 충돌하고 있습니다. 무리하게 밀어붙이시기보다는 때를 기다리면서 준비하는 것이 좋습니다.";
    } else if (formatChangeByDaeun.formatStatus === "파격") {
      daeunDetail += "현재 대운이 격국을 크게 흔들고 있습니다. 이 시기에는 큰 변화나 전환이 있을 수 있습니다. 위기를 기회로 삼는 지혜가 필요합니다.";
    }

    details.push(daeunDetail);
  }

  // 조언
  const advice = `【격국을 활용한 인생 조언】\n\n${narrative.advice}`;

  // 마무리
  const closing = `이상으로 격국 분석을 마치겠습니다. 격국은 인생의 큰 방향을 보여주는 나침반과 같습니다. 본인의 격국을 이해하면 어떤 방향으로 나아가야 할지, 어떤 분야에서 능력을 발휘할 수 있을지를 알 수 있습니다. 격국의 특성을 잘 살리면서 약점은 보완해 나가면, 분명 좋은 결과가 있을 것입니다.`;

  return {
    intro,
    mainAnalysis,
    details,
    advice,
    closing,
  };
}

/**
 * 제4장 전체 분석 실행
 */
export function analyzeChapter4(
  sajuResult: SajuApiResult,
  currentDaeunGanZhi?: string,
  sinGangSinYak?: string
): Chapter4Result {
  const { yearPillar, monthPillar, dayPillar, timePillar } = sajuResult;
  const pillars = [yearPillar, monthPillar, dayPillar, timePillar];
  const ilgan = dayPillar.cheongan;
  const monthBranch = monthPillar.jiji;

  // 월지에서 격국 추출
  const { format } = getFormatFromMonthBranch(monthBranch, ilgan);

  // 성립 조건 확인
  const { isEstablished, conditions, metConditions } = checkEstablishmentConditions(
    format, pillars, ilgan, monthBranch
  );

  // 강도 판정
  const strength = determineFormatStrength(metConditions, isEstablished);

  // 파격 요소 분석
  const breakingFactors = analyzeBreakingFactors(format, pillars, ilgan);

  // 격국 의미
  const formatMeaning = analyzeFormatMeaning(format);

  // 대운별 변화
  const formatChangeByDaeun = analyzeFormatChangeByDaeun(format, currentDaeunGanZhi || null);

  // 서술형 Narrative 생성
  const narrative = generateGeokgukNarrative(
    format,
    strength,
    isEstablished,
    breakingFactors,
    formatChangeByDaeun,
    sinGangSinYak
  );

  return {
    mainFormat: {
      name: format,
      hanja: FORMAT_HANJA[format],
      category: FORMAT_INFO[format].category,
      establishmentConditions: conditions,
      isEstablished,
      strength,
    },
    breakingFactors,
    formatMeaning,
    formatChangeByDaeun,
    narrative,
  };
}

export default analyzeChapter4;
