/**
 * 제13장: 인연과 관계의 흐름
 * 관계상태별 완전 분기 (솔로/연애중/기혼/이혼·사별)
 */

import type { SajuApiResult, FiveElement, Gender, RelationshipStatus } from "@/types/saju";
import type { Chapter13Result, ChapterNarrative } from "@/types/expert";

// ============================================
// 타입 정의
// ============================================

type HeavenlyStemKr = "갑" | "을" | "병" | "정" | "무" | "기" | "경" | "신" | "임" | "계";
type EarthlyBranchKr = "자" | "축" | "인" | "묘" | "진" | "사" | "오" | "미" | "신" | "유" | "술" | "해";
type StrengthType = "신강" | "신약" | "중화";

// ============================================
// 신강신약 변환 함수
// ============================================

function getStrengthKey(sinGangSinYak: string): StrengthType {
  if (sinGangSinYak === "신강") return "신강";
  if (sinGangSinYak === "신약") return "신약";
  return "중화";
}

// ============================================
// 관계 상태별 신강신약 상수 (4관계상태 × 5오행 × 3신강신약 = 60조합)
// ============================================

// 솔로 상태별 상세 분석
const SOLO_STRENGTH_NARRATIVES: Record<FiveElement, Record<StrengthType, {
  reason: string;
  timing: string;
  approach: string;
  advice: string;
}>> = {
  wood: {
    신강: {
      reason: "목 기운이 강한 신강 사주는 자기 성장과 목표에 집중하느라 연애에 소홀했을 가능성이 높습니다. 이상이 높고 자존심이 강해 먼저 다가가기 어려웠으며, 상대방도 쉽게 접근하기 어려운 분위기를 풍겼을 수 있습니다. 자신의 비전에 맞는 사람만 찾다 보니 기회가 줄었을 수 있습니다.",
      timing: "목의 기운이 강한 시기, 특히 봄철이나 인묘 년에 새로운 인연이 들어올 가능성이 높습니다. 자기 계발 모임이나 성장 지향적인 활동에서 동지 같은 인연을 만날 수 있습니다. 너무 서두르지 말고 자연스럽게 다가오는 인연을 기다리세요.",
      approach: "자신의 비전과 목표를 공유하면서 접근하세요. 상대방의 성장 가능성을 칭찬하고 함께 발전할 수 있음을 어필하세요. 너무 주도적으로 이끌려 하지 말고 상대의 속도도 존중하면서 다가가는 것이 효과적입니다.",
      advice: "높은 이상을 조금 낮추고 현실적인 만남에도 열린 마음을 가지세요. 완벽한 사람을 찾기보다 함께 성장할 수 있는 사람을 찾으세요. 자존심을 잠시 내려놓고 먼저 다가가는 용기가 필요합니다."
    },
    신약: {
      reason: "목 기운이 약한 신약 사주는 자신감 부족으로 연애에 소극적이었을 수 있습니다. 다가가고 싶어도 거절이 두려워 망설였거나, 상대방에게 맞추다가 자신의 매력을 잃었을 수 있습니다. 성장에 대한 의지는 있으나 실행력이 부족했을 수 있습니다.",
      timing: "자신을 지지해줄 든든한 인연이 다가올 시기가 있습니다. 특히 가을이나 금 기운이 강한 시기에 귀하를 응원하고 끌어올려줄 인연을 만날 가능성이 높습니다. 조용하지만 꾸준한 모임에서 인연이 시작될 수 있습니다.",
      approach: "무리하게 적극적으로 나서기보다 자신만의 매력을 천천히 보여주세요. 진솔하고 따뜻한 태도로 다가가면 상대방이 먼저 관심을 보일 것입니다. 말보다 행동으로 마음을 표현하는 것이 효과적입니다.",
      advice: "자신의 가치를 인정하고 당당해지세요. 상대방에게 맞추기만 하면 매력이 떨어집니다. 작은 목표라도 세우고 달성하면서 자신감을 키우세요. 거절을 두려워하지 말고, 자신을 표현하는 연습을 하세요."
    },
    중화: {
      reason: "목 기운이 조화로운 중화 사주는 성장과 관계의 균형을 잘 잡지만, 때로는 그 균형 때문에 강하게 끌리는 인연을 놓쳤을 수 있습니다. 모든 것을 신중하게 판단하다 보니 타이밍을 놓치거나, 적당한 관계에 안주했을 가능성이 있습니다.",
      timing: "사계절 언제든 인연이 들어올 가능성이 있으나, 특히 환절기나 변화의 시기에 새로운 만남이 시작될 수 있습니다. 일상적인 활동 중에 자연스럽게 인연이 찾아올 것입니다. 열린 마음으로 다양한 만남에 참여하세요.",
      approach: "자연스럽고 균형 잡힌 방식으로 다가가세요. 너무 적극적이지도, 너무 소극적이지도 않게 상황에 맞게 접근하면 됩니다. 대화를 통해 서로를 알아가는 과정을 즐기세요.",
      advice: "너무 신중하게만 접근하면 기회를 놓칠 수 있습니다. 때로는 직감을 따르고 과감하게 다가가는 것도 필요합니다. 완벽한 타이밍을 기다리지 말고, 지금 다가온 인연에 집중하세요."
    }
  },
  fire: {
    신강: {
      reason: "화 기운이 강한 신강 사주는 열정이 넘치지만 그 열정이 상대방에게 부담으로 느껴졌을 수 있습니다. 빠르게 타오르고 빠르게 식는 패턴으로 지속적인 관계를 유지하기 어려웠거나, 감정 기복이 심해 상대방이 지쳤을 수 있습니다.",
      timing: "여름이나 화 기운이 강한 시기에 새로운 인연이 찾아올 가능성이 높습니다. 파티, 동호회, 문화 행사 등 활기찬 장소에서 귀하의 밝은 에너지에 끌리는 인연을 만날 수 있습니다. 즐거움을 나눌 수 있는 장소에서 인연을 찾으세요.",
      approach: "밝고 자신감 있게 다가가되, 상대방의 페이스도 존중하세요. 너무 뜨겁게 다가가면 상대방이 부담을 느낄 수 있습니다. 유머와 재치로 분위기를 이끌되, 진지한 면도 보여주세요.",
      advice: "열정을 조절하는 연습이 필요합니다. 감정에 휩쓸려 섣불리 행동하지 말고, 천천히 관계를 발전시키세요. 식어가는 감정을 새로운 방식으로 다시 불붙이는 방법을 찾아보세요."
    },
    신약: {
      reason: "화 기운이 약한 신약 사주는 열정을 표현하는 것이 서툴러 상대방이 관심을 알아채지 못했을 수 있습니다. 마음은 뜨거워도 겉으로 드러나지 않아 매력이 전달되지 않았거나, 소극적인 태도로 기회를 놓쳤을 수 있습니다.",
      timing: "활발하고 밝은 인연이 귀하의 불꽃을 살려줄 것입니다. 특히 겨울에서 봄으로 넘어가는 시기에 귀하에게 생기를 불어넣어줄 인연이 찾아올 수 있습니다. 새로운 활동에 도전하면서 인연을 찾아보세요.",
      approach: "용기를 내어 마음을 표현하세요. 말로 하기 어렵다면 행동이나 작은 선물로 관심을 표현해보세요. 상대방이 다가와주기만 기다리지 말고, 작은 시그널이라도 보내세요.",
      advice: "자신의 열정을 억누르지 마세요. 진심을 표현하지 않으면 상대방도 알 수 없습니다. 작은 것부터 시작해서 감정 표현을 연습하세요. 활발한 활동에 참여하면서 자연스럽게 에너지를 키워보세요."
    },
    중화: {
      reason: "화 기운이 조화로운 중화 사주는 열정과 안정의 균형을 잘 잡지만, 특별히 강한 인상을 남기지 못해 인연이 스쳐 지나갔을 수 있습니다. 모든 것이 적당하다 보니 강렬한 끌림을 주지 못했을 가능성이 있습니다.",
      timing: "사계절 고르게 인연이 들어올 수 있으나, 특별한 이벤트나 여행 중에 특별한 인연이 찾아올 수 있습니다. 일상에서 벗어난 상황에서 새로운 만남이 시작될 가능성이 높습니다.",
      approach: "평소보다 조금 더 적극적으로, 조금 더 열정적으로 다가가 보세요. 균형 잡힌 모습도 좋지만, 가끔은 특별한 순간을 만들어주는 것이 효과적입니다. 상대방을 설레게 할 수 있는 이벤트를 계획해보세요.",
      advice: "안전한 영역에서만 머물지 말고, 가끔은 평소와 다른 모습을 보여주세요. 열정적인 순간을 만들어 상대방에게 강한 인상을 남기세요. 균형도 중요하지만 가끔은 불꽃같은 순간도 필요합니다."
    }
  },
  earth: {
    신강: {
      reason: "토 기운이 강한 신강 사주는 안정을 추구하다 보니 새로운 만남에 소극적이었을 수 있습니다. 기존의 익숙한 환경에 안주하거나, 조건과 스펙에 너무 집착해 진정한 인연을 놓쳤을 가능성이 있습니다. 변화를 두려워해 기회를 놓쳤을 수도 있습니다.",
      timing: "환절기나 변화의 시기에 오히려 새로운 인연이 찾아올 수 있습니다. 직장이나 동네, 가족 지인 소개 등 안정적인 경로를 통해 신뢰할 수 있는 인연을 만날 가능성이 높습니다. 소개팅이나 맞선도 긍정적으로 고려하세요.",
      approach: "진솔하고 신뢰감 있게 다가가세요. 화려한 말보다 꾸준한 행동으로 마음을 보여주는 것이 효과적입니다. 약속을 지키고 성실한 모습을 보여주면 상대방이 믿음을 갖게 됩니다.",
      advice: "조건보다 마음이 맞는 사람을 찾으세요. 완벽한 스펙보다 함께 안정을 만들어갈 수 있는 사람이 진정한 인연입니다. 익숙한 틀에서 벗어나 새로운 환경에도 도전해보세요."
    },
    신약: {
      reason: "토 기운이 약한 신약 사주는 자신의 기반이 약하다고 느껴 연애에 자신이 없었을 수 있습니다. 안정감을 주지 못한다는 생각에 적극적으로 다가가지 못했거나, 상대방에게 의지하려는 마음이 너무 강해 부담을 주었을 수 있습니다.",
      timing: "귀하에게 안정감을 줄 수 있는 든든한 인연이 찾아올 것입니다. 특히 봄이나 여름에 귀하를 지지해줄 파트너를 만날 가능성이 높습니다. 조용하고 안정적인 장소에서 인연이 시작될 수 있습니다.",
      approach: "부족한 점을 감추려 하지 말고 진솔하게 다가가세요. 완벽하지 않아도 진심은 통합니다. 상대방에게 너무 의지하려 하지 말고, 함께 안정을 만들어가겠다는 자세를 보여주세요.",
      advice: "먼저 자신의 기반을 다져가세요. 경제적, 정서적으로 안정되면 자신감도 생기고 좋은 인연도 따라옵니다. 상대방에게 기대기만 하려 하지 말고, 함께 성장하는 관계를 추구하세요."
    },
    중화: {
      reason: "토 기운이 조화로운 중화 사주는 안정적이지만 그 안정감이 때로는 지루함으로 느껴질 수 있습니다. 평범한 일상에 만족하다 보니 특별한 인연을 만들 기회를 놓쳤을 가능성이 있습니다.",
      timing: "일상 속에서 자연스럽게 인연이 시작될 수 있습니다. 직장, 동네, 취미 모임 등 익숙한 환경에서 신뢰할 수 있는 인연을 만날 가능성이 높습니다. 기존 인간관계를 통한 소개도 좋은 방법입니다.",
      approach: "편안하고 자연스럽게 다가가세요. 과장하거나 꾸미지 않은 진솔한 모습이 매력이 됩니다. 꾸준히 연락하고 관심을 표현하면 신뢰를 쌓아갈 수 있습니다.",
      advice: "안정적인 것도 좋지만 가끔은 새로운 시도도 필요합니다. 평소와 다른 활동에 참여하거나 새로운 환경에 도전해보세요. 그곳에서 특별한 인연을 만날 수 있습니다."
    }
  },
  metal: {
    신강: {
      reason: "금 기운이 강한 신강 사주는 기준이 너무 높아 맞는 상대를 찾기 어려웠을 수 있습니다. 완벽주의 성향으로 작은 단점도 용납하지 못했거나, 감정 표현이 서툴러 차갑게 느껴졌을 수 있습니다. 비판적인 태도가 상대방을 멀리하게 했을 가능성도 있습니다.",
      timing: "가을이나 금 기운이 강한 시기에 깔끔하고 지적인 인연이 찾아올 수 있습니다. 전문가 모임, 세미나, 업무 관련 네트워킹에서 존경할 수 있는 인연을 만날 가능성이 높습니다. 온라인 앱도 효율적인 만남의 장이 될 수 있습니다.",
      approach: "명확하고 깔끔하게 의도를 표현하세요. 상대방의 지적인 면을 칭찬하고 논리적인 대화를 이끌어가면 호감을 얻을 수 있습니다. 다만 너무 비판적이지 않도록 주의하세요.",
      advice: "기준을 조금 낮추고 상대방의 성장 가능성을 봐주세요. 완벽한 사람은 없습니다. 감정 표현을 연습하고, 따뜻한 면도 보여주세요. 차가운 인상을 줄이면 더 많은 기회가 찾아올 것입니다."
    },
    신약: {
      reason: "금 기운이 약한 신약 사주는 거절에 대한 두려움이 커서 다가가지 못했을 수 있습니다. 내면에는 명확한 기준이 있지만 표현하지 못해 상대방이 귀하의 진가를 알지 못했을 수 있습니다. 완벽해야 다가갈 수 있다는 생각이 기회를 줄였을 수 있습니다.",
      timing: "귀하를 있는 그대로 받아들여주는 따뜻한 인연이 찾아올 것입니다. 특히 봄이나 목 기운이 강한 시기에 귀하를 수용해줄 파트너를 만날 가능성이 높습니다. 친구를 통한 소개나 점진적으로 발전하는 관계가 좋습니다.",
      approach: "완벽하지 않아도 괜찮습니다. 진솔하게 다가가면 상대방도 마음을 열 것입니다. 거절을 두려워하지 말고 용기를 내세요. 작은 관심 표현부터 시작해보세요.",
      advice: "자신에게 너무 엄격하지 마세요. 부족한 점이 있어도 그것이 귀하의 전부가 아닙니다. 상대방에게도, 자신에게도 더 관대해지세요. 거절은 끝이 아니라 새로운 시작입니다."
    },
    중화: {
      reason: "금 기운이 조화로운 중화 사주는 명확하면서도 유연하지만, 때로는 그 균형이 강한 인상을 남기지 못하게 했을 수 있습니다. 세련되고 품격 있는 모습이 다가가기 어려운 인상을 주었을 가능성이 있습니다.",
      timing: "품격 있는 장소에서 수준 높은 인연을 만날 가능성이 높습니다. 문화 행사, 전시회, 고급 취미 모임 등에서 서로 존중할 수 있는 인연이 찾아올 수 있습니다. 소개팅도 긍정적으로 고려하세요.",
      approach: "품격 있으면서도 따뜻하게 다가가세요. 세련된 매력을 보여주되, 인간적인 면도 함께 보여주세요. 명확한 의사소통으로 오해 없이 관계를 발전시키세요.",
      advice: "항상 완벽한 모습만 보여주려 하지 마세요. 가끔은 허술한 면을 보여주는 것이 오히려 친근감을 줍니다. 품격도 좋지만 친밀감도 필요합니다."
    }
  },
  water: {
    신강: {
      reason: "수 기운이 강한 신강 사주는 너무 많이 생각하고 분석하느라 행동으로 옮기지 못했을 수 있습니다. 상대방의 마음을 읽으려다 오히려 오해했거나, 신비로운 분위기가 접근하기 어렵게 느껴졌을 수 있습니다. 깊은 관계만 원하다 보니 가벼운 만남을 거부했을 수도 있습니다.",
      timing: "겨울이나 수 기운이 강한 시기에 깊이 있는 인연이 찾아올 수 있습니다. 조용한 카페, 전시회, 온라인 커뮤니티 등에서 영혼의 교류가 가능한 인연을 만날 수 있습니다. 우연한 만남에서 시작되는 인연에 주목하세요.",
      approach: "신비로운 매력을 살려 상대방의 호기심을 자극하세요. 깊은 대화를 통해 서로의 내면을 알아가세요. 다만 너무 분석하려 하지 말고, 흐름에 맡겨보세요.",
      advice: "생각만 하지 말고 행동으로 옮기세요. 상대방의 마음을 100% 읽으려 하지 말고, 직접 물어보세요. 모든 관계가 깊지 않아도 됩니다. 가벼운 만남에서 시작해 깊어질 수도 있습니다."
    },
    신약: {
      reason: "수 기운이 약한 신약 사주는 감정에 휩쓸려 우왕좌왕했거나, 상대방에게 너무 의존하려 해서 부담을 주었을 수 있습니다. 결정을 내리지 못해 기회를 놓쳤거나, 혼자 있는 것이 두려워 아무나 만나려 했을 수도 있습니다.",
      timing: "안정감을 줄 수 있는 든든한 인연이 찾아올 것입니다. 특히 가을이나 토 기운이 강한 시기에 귀하에게 방향을 제시해줄 파트너를 만날 가능성이 높습니다. 믿을 수 있는 지인의 소개가 좋습니다.",
      approach: "감정에만 의존하지 말고 이성적으로도 판단하세요. 상대방에게 너무 의지하려 하지 말고, 함께 성장하는 자세를 보여주세요. 자신만의 중심을 갖고 다가가세요.",
      advice: "먼저 자신의 중심을 찾으세요. 상대방이 있어야만 완전해지는 것이 아닙니다. 자신만의 취미와 친구를 만들고, 독립적인 사람이 되세요. 그러면 더 건강한 관계가 가능합니다."
    },
    중화: {
      reason: "수 기운이 조화로운 중화 사주는 깊이와 유연함을 갖추고 있지만, 모든 관계에서 깊이를 추구하다 보니 가볍게 시작하기 어려웠을 수 있습니다. 완벽한 인연을 기다리다 현실의 만남을 놓쳤을 가능성이 있습니다.",
      timing: "일상 속에서 자연스럽게 깊어지는 인연이 찾아올 것입니다. 의미 있는 대화가 가능한 장소나 상황에서 특별한 인연을 만날 수 있습니다. 서두르지 말고 천천히 알아가세요.",
      approach: "자연스럽게 대화를 시작하고 서로의 내면을 알아가세요. 깊이 있는 질문과 경청으로 상대방의 마음을 열게 하세요. 감정과 이성의 균형을 유지하며 다가가세요.",
      advice: "모든 만남이 처음부터 깊을 필요는 없습니다. 가볍게 시작해서 천천히 깊어지는 것도 좋습니다. 완벽한 인연을 기다리기보다 현재의 만남에 집중하세요."
    }
  }
};

// 연애 중 상태별 상세 분석
const DATING_STRENGTH_NARRATIVES: Record<FiveElement, Record<StrengthType, {
  health: string;
  development: string;
  warning: string;
  advice: string;
}>> = {
  wood: {
    신강: {
      health: "목 기운이 강한 신강 사주는 연애에서도 주도적인 역할을 합니다. 관계를 이끌어가는 능력이 있어 상대방이 편하게 따라올 수 있습니다. 다만 너무 자기 중심적으로 흐르면 상대방이 숨막힘을 느낄 수 있습니다. 상대방의 의견도 존중하면서 함께 성장하는 관계를 만들어가세요.",
      development: "함께 성장하는 방향으로 관계가 발전할 가능성이 높습니다. 공동의 목표를 세우고 함께 달성해가는 과정에서 사랑이 깊어집니다. 서로의 꿈을 응원하고 자극이 되어주는 관계가 될 수 있습니다. 결혼을 고려한다면 미래 비전이 맞는지 확인하세요.",
      warning: "자존심 싸움으로 갈등이 커질 수 있습니다. 자신의 기준만 옳다고 생각하면 상대방이 지칠 수 있습니다. 의견이 다를 때 먼저 양보하는 여유가 필요합니다. 상대방도 성장할 시간이 필요하니 재촉하지 마세요.",
      advice: "리더십을 발휘하되 파트너십을 잊지 마세요. 중요한 결정은 함께 내리고, 상대방의 성장 속도도 존중하세요. 자존심보다 관계가 소중함을 기억하고, 먼저 손 내미는 여유를 가지세요."
    },
    신약: {
      health: "목 기운이 약한 신약 사주는 연애에서 배려심 깊은 모습을 보입니다. 상대방의 필요를 잘 채워주고 조화로운 관계를 만들어갑니다. 다만 너무 맞추다 보면 자신을 잃거나 상대방이 당연시할 수 있습니다. 자신의 의견도 표현하면서 균형 잡힌 관계를 유지하세요.",
      development: "상대방의 지지와 응원을 받으며 관계가 안정적으로 발전할 수 있습니다. 서로를 존중하고 배려하는 성숙한 관계가 될 가능성이 높습니다. 다만 자신의 목소리도 내면서 함께 성장해야 합니다. 상대방에게만 맞추면 장기적으로 불만이 쌓일 수 있습니다.",
      warning: "참다가 폭발할 수 있습니다. 불만을 표현하지 않으면 관계의 균형이 무너집니다. 상대방이 귀하를 당연시하기 시작하면 관계가 불건강해집니다. 자존감을 잃지 않도록 주의하세요.",
      advice: "귀하의 의견도 중요합니다. 작은 것이라도 표현하는 연습을 하세요. 상대방이 귀하를 존중하지 않는다면 그것은 좋은 관계가 아닙니다. 함께 성장하는 관계인지 점검해보세요."
    },
    중화: {
      health: "목 기운이 조화로운 중화 사주는 연애에서 균형 잡힌 모습을 보입니다. 주도할 때와 양보할 때를 잘 구분하며, 상대방과 동등한 파트너십을 유지합니다. 서로의 영역을 존중하면서도 함께하는 시간을 소중히 여기는 건강한 관계를 만들어갑니다.",
      development: "안정적이면서도 성장하는 관계로 발전할 수 있습니다. 서로의 꿈을 존중하고 응원하면서 함께 나아가는 파트너가 될 수 있습니다. 갈등이 있어도 대화로 해결하는 성숙함이 있어 장기적인 관계를 유지할 수 있습니다.",
      warning: "너무 균형만 잡으려다 결정을 미룰 수 있습니다. 때로는 명확한 방향 제시가 필요할 때도 있습니다. 모든 것을 완벽하게 조율하려 하면 지칠 수 있습니다.",
      advice: "현재의 균형 잡힌 관계를 유지하되, 때로는 과감한 결정도 필요합니다. 서로에게 특별한 순간을 만들어주는 노력을 계속하세요. 완벽한 조화보다 진솔한 감정 교류가 더 중요합니다."
    }
  },
  fire: {
    신강: {
      health: "화 기운이 강한 신강 사주는 연애에서 열정적이고 적극적인 모습을 보입니다. 사랑을 뜨겁게 표현하고 상대방을 기쁘게 해주려 노력합니다. 다만 열정이 식으면 갑자기 흥미를 잃거나, 감정 기복으로 상대방이 혼란스러워할 수 있습니다.",
      development: "로맨틱하고 특별한 순간들로 가득한 관계로 발전할 수 있습니다. 서로에 대한 열정을 유지한다면 결혼까지 자연스럽게 이어질 수 있습니다. 다만 열정만으로는 부족하니 안정감도 함께 쌓아가세요.",
      warning: "감정 기복이 심해 상대방이 지칠 수 있습니다. 화가 나면 후회할 말을 할 수 있고, 열정이 식으면 갑자기 차가워질 수 있습니다. 새로운 자극만 찾다 보면 현재 관계가 지루해질 수 있습니다.",
      advice: "열정을 유지하되 안정감도 주세요. 화가 날 때는 잠시 멈추고 생각한 후 말하세요. 일상의 소소한 행복도 즐기는 여유를 가지세요. 불꽃놀이 같은 사랑보다 모닥불 같은 사랑이 오래갑니다."
    },
    신약: {
      health: "화 기운이 약한 신약 사주는 연애에서 따뜻하지만 표현이 서툴 수 있습니다. 마음은 뜨거워도 겉으로 잘 드러나지 않아 상대방이 사랑받는다고 느끼지 못할 수 있습니다. 상대방의 관심과 인정을 받을 때 더 빛나는 타입입니다.",
      development: "상대방의 적극적인 애정 표현으로 관계가 따뜻해질 수 있습니다. 서로 다른 에너지가 균형을 이루며 보완하는 관계가 될 수 있습니다. 상대방이 귀하의 숨은 열정을 알아봐주면 깊은 관계로 발전합니다.",
      warning: "표현하지 않으면 사랑도 전해지지 않습니다. 상대방이 귀하의 마음을 몰라 서운해할 수 있습니다. 너무 참으면 나중에 폭발하거나 관계가 식을 수 있습니다.",
      advice: "작은 것이라도 표현하세요. '사랑해', '고마워'라는 말 한마디가 관계를 따뜻하게 합니다. 귀하의 감정도 중요하니 불편한 것은 부드럽게라도 말하세요. 상대방이 귀하의 진심을 알 수 있게 해주세요."
    },
    중화: {
      health: "화 기운이 조화로운 중화 사주는 연애에서 적절한 열정과 안정을 함께 보여줍니다. 로맨틱한 순간과 편안한 일상을 조화롭게 만들어가며, 상대방에게 사랑받는다는 느낌을 충분히 줄 수 있습니다. 감정 표현도 적절하고 갈등 상황에서도 대화로 해결하려 합니다.",
      development: "열정과 안정이 조화로운 건강한 관계로 발전할 수 있습니다. 특별한 날에는 로맨틱하게, 일상에서는 편안하게 함께하는 이상적인 관계가 될 수 있습니다. 장기적으로 안정적인 관계를 유지할 수 있는 능력이 있습니다.",
      warning: "너무 균형만 잡으려다 열정이 부족해 보일 수 있습니다. 가끔은 예측 불가능한 서프라이즈나 뜨거운 감정 표현도 관계에 필요합니다. 모든 것을 적당히 하면 특별함이 사라질 수 있습니다.",
      advice: "현재의 균형을 유지하되, 가끔은 불꽃 같은 순간도 만들어보세요. 계산되지 않은 순수한 열정이 관계를 더 특별하게 만듭니다. 때로는 바보 같아도 괜찮습니다."
    }
  },
  earth: {
    신강: {
      health: "토 기운이 강한 신강 사주는 연애에서 안정적이고 믿음직한 모습을 보입니다. 책임감 있게 관계를 이끌어가며, 상대방에게 든든한 버팀목이 됩니다. 다만 변화를 싫어해 관계가 정체될 수 있고, 고집이 세서 갈등 시 양보하기 어려울 수 있습니다.",
      development: "안정적이고 신뢰할 수 있는 관계로 발전할 수 있습니다. 서로에 대한 믿음이 깊어지며 자연스럽게 결혼으로 이어질 가능성이 높습니다. 가정을 이루고 싶은 마음이 강해 진지한 관계로 발전합니다.",
      warning: "지나친 안정 추구가 관계를 지루하게 만들 수 있습니다. 고집을 부리면 소통이 막히고, 감정 표현이 부족하면 상대방이 서운해합니다. 실용성만 강조하다 로맨스가 사라질 수 있습니다.",
      advice: "안정감을 주면서도 가끔은 변화와 로맨스도 필요합니다. 계획에 없던 데이트도 하고, 사랑한다고 말로도 표현하세요. 고집을 조금 내려놓고 상대방의 의견도 받아들이세요."
    },
    신약: {
      health: "토 기운이 약한 신약 사주는 연애에서 순응적이고 맞춰주는 모습을 보입니다. 상대방의 필요를 잘 채워주고 갈등을 피하려 합니다. 다만 너무 맞추다 보면 자신을 잃거나 상대방에게 휘둘릴 수 있습니다.",
      development: "상대방의 리드 아래 안정적으로 관계가 발전할 수 있습니다. 서포터 역할을 잘해서 상대방이 편안해합니다. 다만 귀하의 의견도 표현해야 균형 잡힌 관계가 됩니다.",
      warning: "너무 맞추기만 하면 상대방이 당연시합니다. 자신의 의견이 없어 보이면 매력이 떨어집니다. 참다가 폭발하면 관계가 한순간에 무너질 수 있습니다.",
      advice: "귀하의 의견과 필요도 중요합니다. 용기를 내어 표현하세요. 상대방이 귀하를 존중하지 않는다면 그 관계가 정말 안정적인 것인지 돌아보세요. 함께 안정을 만들어가는 관계여야 합니다."
    },
    중화: {
      health: "토 기운이 조화로운 중화 사주는 연애에서 안정과 유연함을 함께 보여줍니다. 믿음직하면서도 변화에 적응하고, 실용적이면서도 로맨스를 즐깁니다. 상대방과 균형 잡힌 관계를 만들어가며 서로의 역할을 자연스럽게 분담합니다.",
      development: "안정적이면서도 성장하는 관계로 발전할 수 있습니다. 서로를 신뢰하고 존중하는 파트너십이 형성됩니다. 장기적으로 결혼과 가정을 이루는 방향으로 자연스럽게 흐를 수 있습니다.",
      warning: "너무 현실적으로만 접근하면 로맨스가 부족해 보일 수 있습니다. 모든 것을 계획하고 통제하려 하면 자발성이 사라집니다.",
      advice: "현재의 균형을 유지하되, 가끔은 즉흥적인 것도 즐기세요. 실용성도 중요하지만 순수한 감정에 집중하는 순간도 필요합니다."
    }
  },
  metal: {
    신강: {
      health: "금 기운이 강한 신강 사주는 연애에서 명확하고 원칙적인 모습을 보입니다. 서로의 공간과 시간을 존중하며 깊이 있는 관계를 추구합니다. 다만 감정 표현이 절제되어 차갑게 느껴지거나, 비판적인 태도로 상대방에게 상처를 줄 수 있습니다.",
      development: "서로를 존중하고 신뢰하는 성숙한 관계로 발전할 수 있습니다. 명확한 소통으로 오해가 적고, 각자의 영역을 인정하는 건강한 파트너십이 형성됩니다. 다만 따뜻함을 더해야 관계가 깊어집니다.",
      warning: "원칙에 너무 집착하면 관계가 경직됩니다. 비판적인 태도가 상대방에게 상처가 되고, 감정 표현 부족으로 사랑받지 못한다고 느끼게 할 수 있습니다. 완벽을 추구하다 어느 누구도 만족시키지 못할 수 있습니다.",
      advice: "원칙도 중요하지만 유연함도 필요합니다. 감정 표현을 연습하고 따뜻한 말도 해주세요. 비판보다 칭찬을, 분석보다 공감을 먼저 해보세요."
    },
    신약: {
      health: "금 기운이 약한 신약 사주는 연애에서 섬세하고 예민한 모습을 보입니다. 상대방의 반응에 민감하고, 작은 말이나 행동에도 많은 의미를 부여합니다. 내면에는 기준이 있지만 표현하지 못해 오해가 쌓일 수 있습니다.",
      development: "상대방의 따뜻한 수용 속에서 관계가 깊어질 수 있습니다. 깊은 신뢰가 쌓이면 매우 헌신적인 파트너가 됩니다. 상대방이 귀하의 섬세함을 이해해주면 아름다운 관계가 됩니다.",
      warning: "지나친 예민함이 관계를 피곤하게 할 수 있습니다. 모든 것을 분석하고 의미를 찾으면 자발성이 사라집니다. 완벽한 관계를 원하다 현실에 만족하지 못할 수 있습니다.",
      advice: "상대방의 모든 말과 행동을 분석하지 마세요. 때로는 흘려보내는 여유가 필요합니다. 완벽하지 않아도 좋은 관계일 수 있습니다. 자신의 생각도 표현하세요."
    },
    중화: {
      health: "금 기운이 조화로운 중화 사주는 연애에서 명확하면서도 따뜻한 모습을 보입니다. 자신의 기준이 있지만 상대방에 따라 조율할 줄 알고, 서로의 공간을 존중하면서도 친밀함을 유지합니다. 품격 있으면서도 인간적인 관계를 만들어갑니다.",
      development: "상호 존중하는 성숙한 관계로 발전할 수 있습니다. 서로의 영역을 인정하면서도 깊은 신뢰를 쌓아갑니다. 장기적으로 안정적이고 품격 있는 관계가 될 수 있습니다.",
      warning: "항상 품격을 유지하려 하면 진솔한 감정 표현이 어려울 수 있습니다. 균형을 잡으려다 열정이 부족해 보일 수 있습니다.",
      advice: "품격도 좋지만 가끔은 완벽하지 않은 모습도 보여주세요. 진솔한 감정 표현이 관계를 더 깊게 만듭니다. 체면보다 진심이 중요합니다."
    }
  },
  water: {
    신강: {
      health: "수 기운이 강한 신강 사주는 연애에서 깊이 있고 통찰력 있는 모습을 보입니다. 상대방의 마음을 잘 읽고 깊은 감정적 교류를 추구합니다. 다만 너무 많이 생각하고 분석하느라 행동이 늦거나, 자신만의 상상에 빠질 수 있습니다.",
      development: "영혼의 교류 같은 깊은 관계로 발전할 수 있습니다. 서로의 내면을 깊이 이해하고 비밀을 공유하는 신뢰 관계가 형성됩니다. 상대방이 귀하의 깊이를 알아봐주면 특별한 관계가 됩니다.",
      warning: "너무 깊게 생각하다 행동하지 못할 수 있습니다. 상대방의 마음을 읽으려다 실제와 다른 해석을 할 수 있습니다. 모든 것을 알려고 하면 상대방이 부담스러워합니다.",
      advice: "생각만 하지 말고 행동으로 옮기세요. 상대방의 모든 것을 알 필요 없습니다. 시간을 두고 자연스럽게 알아가세요. 현재 순간을 즐기는 여유도 가지세요."
    },
    신약: {
      health: "수 기운이 약한 신약 사주는 연애에서 감성적이고 헌신적인 모습을 보입니다. 상대방에게 깊이 공감하고 많이 맞춰줍니다. 다만 감정에 휩쓸려 우왕좌왕하거나, 상대방에게 너무 의존할 수 있습니다.",
      development: "상대방의 안정적인 지지 속에서 관계가 깊어질 수 있습니다. 헌신적인 사랑으로 상대방을 감동시킵니다. 다만 균형 잡힌 관계를 위해 자신의 중심도 유지해야 합니다.",
      warning: "지나친 의존이 상대방에게 부담이 됩니다. 감정에만 휩쓸려 판단력을 잃을 수 있습니다. 상대방 없이는 불안해하면 관계가 불건강해집니다.",
      advice: "상대방도 중요하지만 자신의 중심도 지키세요. 자신만의 취미와 친구 관계도 유지하세요. 감정적으로만 판단하지 말고 이성적으로도 생각해보세요."
    },
    중화: {
      health: "수 기운이 조화로운 중화 사주는 연애에서 깊이와 유연함을 함께 보여줍니다. 깊은 감정 교류를 즐기면서도 현실적인 판단력을 유지합니다. 상대방을 이해하려 노력하면서도 자신을 잃지 않는 균형 잡힌 모습입니다.",
      development: "깊이 있으면서도 안정적인 관계로 발전할 수 있습니다. 서로의 내면을 이해하면서 현실적인 문제도 함께 해결해나갑니다. 장기적으로 영혼의 동반자 같은 관계가 될 수 있습니다.",
      warning: "너무 깊이 들어가려다 가벼운 즐거움을 놓칠 수 있습니다. 모든 관계에서 의미를 찾으려 하면 피곤해집니다.",
      advice: "깊이도 좋지만 가벼운 즐거움도 즐기세요. 모든 순간이 의미 있어야 하는 것은 아닙니다. 가끔은 생각을 멈추고 현재를 즐기세요."
    }
  }
};

// 기혼 상태별 상세 분석
const MARRIED_STRENGTH_NARRATIVES: Record<FiveElement, Record<StrengthType, {
  spouse: string;
  conflict: string;
  harmony: string;
  family: string;
}>> = {
  wood: {
    신강: {
      spouse: "목 기운이 강한 신강 사주는 결혼 생활에서도 주도적인 역할을 합니다. 가정을 이끌어가는 능력이 있지만, 배우자의 의견을 무시하거나 자기 방식만 고집할 수 있습니다. 서로 성장하는 부부가 되려면 배우자의 비전도 존중해야 합니다.",
      conflict: "주도권 다툼이나 자존심 싸움이 주요 갈등 원인이 됩니다. 서로 자기가 옳다고 주장하면 대화가 막힐 수 있습니다. 자녀 교육관이 달라 갈등이 생기기도 합니다. 먼저 양보하는 것이 어려운 성향입니다.",
      harmony: "함께 배우고 성장하는 활동을 계획하세요. 주말 등산이나 운동을 함께 하며 에너지를 발산하세요. 서로의 개인적 성장도 응원하고, 공동의 목표를 세워 함께 달성해가세요. 자녀 교육도 함께 계획하면 좋습니다.",
      family: "성장 지향적인 가정 분위기입니다. 자녀에게도 목표 의식과 성취욕을 심어줍니다. 가족 모두가 발전하는 것을 중시하며, 때로는 경쟁적인 분위기가 될 수 있습니다. 여유와 휴식도 필요합니다."
    },
    신약: {
      spouse: "목 기운이 약한 신약 사주는 결혼 생활에서 배우자에게 맞추는 편입니다. 갈등을 피하려 하고 화합을 중시합니다. 다만 너무 맞추다 보면 자신의 의견이 무시당하거나 불만이 쌓일 수 있습니다. 자신의 생각도 표현해야 합니다.",
      conflict: "의견 충돌을 피하려다 오히려 불만이 쌓입니다. 참다가 폭발하면 배우자가 당황할 수 있습니다. 배우자에게 의존하다 보면 존중받지 못한다고 느낄 수 있습니다. 자존감을 지키면서 관계를 유지해야 합니다.",
      harmony: "작은 것이라도 의견을 표현하는 연습을 하세요. 배우자와 대등한 파트너임을 인식하고 자신감을 가지세요. 함께하는 취미 활동으로 유대감을 높이고, 서로의 꿈을 응원하세요.",
      family: "화목하고 조화로운 가정 분위기입니다. 갈등이 적고 평화로운 일상을 유지합니다. 다만 중요한 결정에서 목소리를 내지 못하면 나중에 후회할 수 있습니다. 자녀에게도 자기 표현의 중요성을 가르치세요."
    },
    중화: {
      spouse: "목 기운이 조화로운 중화 사주는 결혼 생활에서 균형 잡힌 모습을 보입니다. 주도할 때와 따를 때를 잘 구분하며, 배우자와 동등한 파트너십을 유지합니다. 서로의 성장을 응원하면서도 가정의 안정을 지킵니다.",
      conflict: "갈등 상황에서 대화로 해결하려 합니다. 서로의 의견을 조율하는 능력이 있어 큰 다툼으로 번지지 않습니다. 다만 너무 합리적으로만 접근하면 감정이 무시당한다고 느낄 수 있습니다.",
      harmony: "현재의 균형을 유지하면서 특별한 순간들도 만들어가세요. 함께 성장하는 목표를 세우고, 서로의 영역도 존중하세요. 정기적인 부부 시간으로 친밀감을 유지하세요.",
      family: "안정적이면서도 성장하는 가정입니다. 자녀 교육도 균형 잡힌 시각으로 접근하며, 가족 모두가 각자의 역할을 존중받습니다. 화목하면서도 발전적인 가정 분위기입니다."
    }
  },
  fire: {
    신강: {
      spouse: "화 기운이 강한 신강 사주는 결혼 생활에서도 열정적인 모습을 보입니다. 배우자에게 뜨거운 사랑을 표현하고 가정에 활기를 불어넣습니다. 다만 감정 기복이 심하거나 화가 나면 격렬한 다툼으로 번질 수 있습니다.",
      conflict: "감정적 충돌이 주요 갈등 원인입니다. 화가 나면 후회할 말을 하거나, 분위기를 급격히 얼어붙게 만들 수 있습니다. 금방 화해하지만 순간의 상처가 쌓일 수 있습니다. 감정 조절이 중요합니다.",
      harmony: "데이트 나이트를 정기적으로 갖고 로맨스를 유지하세요. 여행이나 문화 생활을 함께 즐기며 열정을 유지하세요. 화가 날 때는 잠시 시간을 두고 진정한 후 대화하세요. 감사와 칭찬을 자주 표현하세요.",
      family: "활기차고 밝은 가정입니다. 가족 행사와 모임이 많고 즐거운 분위기를 만듭니다. 자녀에게도 열정과 도전 정신을 심어줍니다. 다만 감정 기복이 가족에게 영향을 줄 수 있으니 주의하세요."
    },
    신약: {
      spouse: "화 기운이 약한 신약 사주는 결혼 생활에서 따뜻하지만 표현이 서툴 수 있습니다. 마음으로는 배우자를 사랑하지만 겉으로 잘 드러나지 않습니다. 배우자가 사랑받는다고 느끼게 해주는 표현이 필요합니다.",
      conflict: "표현 부족으로 오해가 생길 수 있습니다. 배우자가 서운해해도 어떻게 반응해야 할지 몰라 어색해집니다. 갈등을 피하다 보면 문제가 커질 수 있습니다. 불편한 것도 표현하는 연습이 필요합니다.",
      harmony: "작은 것이라도 사랑 표현을 연습하세요. 말이 어려우면 행동으로, 편지로, 선물로 마음을 전하세요. 배우자의 노력에 감사 표현을 하고, 함께하는 시간을 소중히 여기세요.",
      family: "따뜻하고 안정적인 가정입니다. 조용하지만 깊은 사랑이 있는 가정을 만듭니다. 자녀에게도 차분하고 따뜻한 부모가 됩니다. 다만 가족에게도 사랑 표현을 더 적극적으로 해주세요."
    },
    중화: {
      spouse: "화 기운이 조화로운 중화 사주는 결혼 생활에서 적절한 열정과 안정을 함께 보여줍니다. 로맨틱한 순간과 편안한 일상을 조화롭게 만들어가며, 배우자에게 사랑받는 느낌을 충분히 줍니다.",
      conflict: "감정 조절 능력이 있어 큰 다툼으로 번지지 않습니다. 갈등 상황에서도 대화로 해결하려 합니다. 다만 너무 균형만 잡으려 하면 열정이 부족해 보일 수 있습니다.",
      harmony: "현재의 균형을 유지하면서 가끔은 특별한 순간도 만들어주세요. 기념일을 챙기고 서프라이즈도 해보세요. 일상과 특별함의 조화로 행복한 결혼 생활을 유지하세요.",
      family: "화목하고 밝은 가정입니다. 적절한 열정과 안정이 조화를 이룹니다. 자녀에게도 균형 잡힌 교육을 제공하며, 가족 간 소통이 원활합니다."
    }
  },
  earth: {
    신강: {
      spouse: "토 기운이 강한 신강 사주는 결혼 생활에서 안정적이고 믿음직한 모습을 보입니다. 가정의 경제적, 정서적 기반을 든든히 세우며 책임감 있게 배우자를 대합니다. 다만 변화를 싫어하고 고집이 세서 갈등이 생길 수 있습니다.",
      conflict: "고집으로 인해 대화가 막힐 수 있습니다. 자신의 방식만 고집하면 배우자가 답답해합니다. 변화를 거부하면 관계가 정체됩니다. 실용성만 강조하다 로맨스가 사라질 수 있습니다.",
      harmony: "일상의 소소한 행복을 함께 나누세요. 함께 요리하거나 집안일을 나누며 유대감을 높이세요. 가끔은 변화를 시도해보고, 사랑한다고 말로도 표현하세요. 배우자의 의견에 귀 기울이세요.",
      family: "안정적이고 경제적으로 든든한 가정입니다. 가족 모두에게 안정감을 주며, 실질적인 지원을 아끼지 않습니다. 다만 변화와 새로움도 필요하니 가끔은 가족 여행이나 새로운 시도를 해보세요."
    },
    신약: {
      spouse: "토 기운이 약한 신약 사주는 결혼 생활에서 배우자에게 많이 의지하는 편입니다. 안정을 원하지만 스스로 만들어가기보다 배우자에게 기대합니다. 지지해주는 배우자와 함께라면 좋은 가정을 이룰 수 있습니다.",
      conflict: "의존하다 보면 배우자가 부담을 느낄 수 있습니다. 자신의 의견이 없어 보이면 존중받지 못합니다. 결정을 맡기다 보면 나중에 불만이 생길 수 있습니다. 책임감을 더 가져야 합니다.",
      harmony: "작은 것부터 스스로 결정하고 책임지는 연습을 하세요. 배우자와 대등한 파트너로서 역할을 분담하세요. 함께 가정의 기반을 다져가는 느낌을 만들어가세요.",
      family: "화목하고 평화로운 가정입니다. 갈등이 적고 조화로운 분위기를 유지합니다. 다만 중요한 가정사에서 목소리를 내야 할 때도 있습니다. 자녀에게도 자립심을 가르치세요."
    },
    중화: {
      spouse: "토 기운이 조화로운 중화 사주는 결혼 생활에서 안정과 유연함을 함께 보여줍니다. 가정의 안정을 지키면서도 변화에 적응합니다. 배우자와 균형 잡힌 역할 분담을 하며 신뢰로운 관계를 유지합니다.",
      conflict: "갈등 상황에서 실용적인 해결책을 찾습니다. 서로 양보하며 조율하는 능력이 있습니다. 다만 너무 현실적으로만 접근하면 로맨스가 부족해 보일 수 있습니다.",
      harmony: "안정적인 일상을 유지하면서도 특별한 순간을 만들어가세요. 함께 미래를 계획하고, 가끔은 즉흥적인 것도 즐기세요. 서로에 대한 감사를 잊지 마세요.",
      family: "안정적이면서도 따뜻한 가정입니다. 경제적 기반이 탄탄하고, 가족 간 신뢰가 두텁습니다. 자녀 교육도 균형 잡힌 시각으로 접근합니다."
    }
  },
  metal: {
    신강: {
      spouse: "금 기운이 강한 신강 사주는 결혼 생활에서 명확한 원칙과 기준을 가지고 있습니다. 서로의 경계를 존중하며 체계적인 가정을 만들어갑니다. 다만 감정 표현이 부족하거나 비판적인 태도로 배우자에게 상처를 줄 수 있습니다.",
      conflict: "원칙을 고집하면 관계가 경직됩니다. 비판적인 지적이 상처가 되고, 차가운 태도로 배우자가 외로움을 느낄 수 있습니다. 감정 표현을 더 해야 합니다. 완벽을 추구하다 갈등이 커질 수 있습니다.",
      harmony: "감정 표현을 연습하고 따뜻한 말도 해주세요. 비판보다 칭찬을, 분석보다 공감을 먼저 해보세요. 서로의 공간을 존중하되 친밀한 시간도 만드세요. 가끔은 원칙을 유연하게 적용하세요.",
      family: "규율 있고 체계적인 가정입니다. 자녀 교육에 원칙이 있고, 깔끔한 가정 환경을 유지합니다. 다만 따뜻함과 유연함도 필요합니다. 가족에게 사랑 표현을 더 해주세요."
    },
    신약: {
      spouse: "금 기운이 약한 신약 사주는 결혼 생활에서 섬세하고 예민한 모습을 보입니다. 배우자의 반응에 민감하고, 작은 말에도 많은 의미를 부여합니다. 내면에는 기준이 있지만 표현하지 못해 오해가 쌓일 수 있습니다.",
      conflict: "예민함으로 인해 작은 일에도 상처받을 수 있습니다. 속마음을 표현하지 못해 오해가 생깁니다. 완벽한 관계를 원하다 현실에 만족하지 못할 수 있습니다. 배우자도 지칠 수 있습니다.",
      harmony: "상대방의 말을 너무 깊게 분석하지 마세요. 불편한 것은 부드럽게 표현하고, 흘려보내는 여유를 가지세요. 배우자와 솔직한 대화를 나누고, 서로의 불완전함을 수용하세요.",
      family: "섬세하고 깔끔한 가정입니다. 가족의 필요를 잘 알아채고 세심하게 챙깁니다. 다만 너무 예민하면 가정 분위기가 경직될 수 있습니다. 여유와 유머도 필요합니다."
    },
    중화: {
      spouse: "금 기운이 조화로운 중화 사주는 결혼 생활에서 명확하면서도 따뜻한 모습을 보입니다. 원칙이 있지만 유연하게 적용하고, 서로의 경계를 존중하면서도 친밀함을 유지합니다. 품격 있으면서도 인간적인 관계를 만듭니다.",
      conflict: "갈등 상황에서 논리적으로 대화하되 감정도 고려합니다. 서로 존중하며 해결책을 찾습니다. 다만 너무 품격만 유지하려 하면 진솔함이 부족해 보일 수 있습니다.",
      harmony: "상호 존중하는 관계를 유지하면서 따뜻한 순간도 만드세요. 가끔은 완벽하지 않은 모습도 보여주세요. 논리도 좋지만 감정적 연결도 중요합니다.",
      family: "품격 있고 조화로운 가정입니다. 자녀 교육도 균형 잡힌 시각으로 접근합니다. 가족 간 상호 존중이 잘 이루어지며, 깔끔하면서도 따뜻한 가정 분위기입니다."
    }
  },
  water: {
    신강: {
      spouse: "수 기운이 강한 신강 사주는 결혼 생활에서 깊이 있는 교류를 추구합니다. 배우자를 깊이 이해하려 하고 영혼의 동반자 같은 관계를 원합니다. 다만 너무 많이 생각하거나 배우자의 모든 것을 알려 하면 부담이 될 수 있습니다.",
      conflict: "상대방의 마음을 읽으려다 오해할 수 있습니다. 너무 깊게 파고들면 배우자가 부담스러워합니다. 감정의 깊이 때문에 사소한 일에도 크게 상처받을 수 있습니다. 때로는 가볍게 넘기는 여유가 필요합니다.",
      harmony: "깊은 대화와 감정 교류를 자주 하되, 배우자의 공간도 존중하세요. 함께 여행하거나 새로운 경험을 하며 유대감을 높이세요. 생각만 하지 말고 행동으로 사랑을 표현하세요.",
      family: "정서적으로 깊이 있는 가정입니다. 가족 간 감정 교류가 활발하고 서로를 잘 이해합니다. 자녀와도 깊은 대화를 나눕니다. 다만 가벼운 즐거움도 함께 나누세요."
    },
    신약: {
      spouse: "수 기운이 약한 신약 사주는 결혼 생활에서 배우자에게 많이 의지하는 편입니다. 감정적으로 깊이 연결되길 원하며, 배우자 없이는 불안함을 느낍니다. 헌신적인 배우자이지만 의존도가 너무 높으면 관계가 불균형해집니다.",
      conflict: "지나친 의존이 배우자에게 부담이 됩니다. 감정 기복으로 배우자가 혼란스러워할 수 있습니다. 배우자의 모든 것을 알려 하면 숨 막힐 수 있습니다. 자신만의 중심을 갖는 것이 중요합니다.",
      harmony: "자신만의 취미와 친구 관계를 유지하세요. 배우자에게만 의존하지 말고 자립적인 면도 키우세요. 감정을 표현하되 이성적인 판단력도 유지하세요. 함께이면서도 독립적인 관계를 만드세요.",
      family: "따뜻하고 헌신적인 가정입니다. 가족을 위해 많은 것을 희생합니다. 다만 자신을 돌보는 것도 잊지 마세요. 자녀에게도 독립심을 가르치세요."
    },
    중화: {
      spouse: "수 기운이 조화로운 중화 사주는 결혼 생활에서 깊이와 유연함을 함께 보여줍니다. 배우자와 깊은 감정 교류를 하면서도 현실적인 문제도 함께 해결합니다. 이해하려 노력하면서 자신의 경계도 유지합니다.",
      conflict: "갈등 상황에서 감정과 이성의 균형을 유지합니다. 깊이 있는 대화로 문제를 해결합니다. 다만 너무 깊이 들어가려다 가벼운 즐거움을 놓칠 수 있습니다.",
      harmony: "깊이 있는 대화와 가벼운 즐거움의 균형을 유지하세요. 함께 성장하면서도 여유로운 시간도 가지세요. 서로의 내면을 이해하면서 일상의 소소한 행복도 나누세요.",
      family: "깊이 있으면서도 균형 잡힌 가정입니다. 가족 간 감정 교류가 활발하면서도 현실적인 문제 해결 능력도 있습니다. 자녀 교육도 균형 잡힌 시각으로 접근합니다."
    }
  }
};

// 이혼·사별 상태별 상세 분석
const DIVORCED_STRENGTH_NARRATIVES: Record<FiveElement, Record<StrengthType, {
  healing: string;
  remarriage: string;
  recovery: string;
  guidance: string;
}>> = {
  wood: {
    신강: {
      healing: "목 기운이 강한 신강 사주는 상처를 성장의 발판으로 삼으려 합니다. 스스로 이겨내려는 의지가 강하고, 자기 계발에 집중하며 치유해갑니다. 새로운 목표를 세우고 달성하는 과정에서 마음의 안정을 찾습니다. 주변의 도움을 받아들이는 것도 강함임을 기억하세요.",
      remarriage: "새로운 시작에 대한 의지가 강해 재혼 가능성이 높습니다. 과거의 교훈을 바탕으로 더 성숙한 관계를 만들 수 있습니다. 함께 성장할 수 있는 파트너를 만나면 좋은 결과가 있을 것입니다. 자기 중심적이었던 부분을 반성하고 개선한다면 더 좋은 관계가 가능합니다.",
      recovery: "새로운 것을 배우고 성장하는 데 집중하세요. 운동이나 자기 계발 활동으로 에너지를 발산하세요. 혼자 해결하려 하지 말고 필요하면 전문가의 도움도 받으세요. 새로운 목표를 세우고 한 걸음씩 나아가세요.",
      guidance: "강한 의지로 이겨내고 있지만, 때로는 도움을 요청하는 것도 강함입니다. 상처받은 감정을 억누르지 말고 표현하세요. 과거를 분석하되 자책하지 마세요. 새로운 시작을 두려워하지 말고, 이번에는 더 균형 잡힌 관계를 만들어가세요."
    },
    신약: {
      healing: "목 기운이 약한 신약 사주는 이별의 상처가 깊이 남을 수 있습니다. 자신감이 떨어지고 혼자 일어서기 어려울 수 있습니다. 주변의 지지가 치유에 큰 도움이 됩니다. 천천히, 자신의 속도로 회복해가세요.",
      remarriage: "상처가 치유된 후에 새로운 만남을 시작하세요. 지지해주고 응원해주는 파트너를 만나면 좋습니다. 의존하기보다 함께 성장할 수 있는 관계를 추구하세요. 자신의 가치를 알고 당당히 새 출발하세요.",
      recovery: "가족이나 친구의 지지를 받으세요. 혼자 끙끙 앓지 말고 마음을 나누세요. 작은 목표부터 세우고 달성하면서 자신감을 회복하세요. 전문 상담도 도움이 됩니다. 자신을 탓하지 마세요.",
      guidance: "힘든 시기를 보내고 있지만, 당신은 생각보다 강합니다. 주변의 도움을 받아들이고, 천천히 일어서세요. 과거에 너무 맞추기만 했다면, 이번에는 자신을 더 존중하는 관계를 찾으세요. 당신도 사랑받을 자격이 있습니다."
    },
    중화: {
      healing: "목 기운이 조화로운 중화 사주는 균형 잡힌 방식으로 치유해갑니다. 성장의 관점에서 이 경험을 바라보면서도, 감정을 억누르지 않고 표현합니다. 시간을 두고 차분하게 회복해가는 능력이 있습니다.",
      remarriage: "치유가 된 후 자연스럽게 새로운 인연이 찾아올 수 있습니다. 과거의 교훈을 바탕으로 더 균형 잡힌 관계를 만들 수 있습니다. 서두르지 말고, 준비가 되었을 때 열린 마음으로 만남을 시작하세요.",
      recovery: "자신만의 방식으로 치유해가세요. 성장과 휴식의 균형을 유지하며 회복하세요. 새로운 것을 배우면서도 충분히 쉬세요. 이 경험을 통해 더 성숙해질 수 있습니다.",
      guidance: "이 경험을 성장의 기회로 삼으세요. 과거를 분석하되 앞으로 나아가는 것을 잊지 마세요. 새로운 관계에서는 더 균형 잡힌 모습으로, 주도할 때와 따를 때를 잘 구분하세요. 좋은 인연이 기다리고 있습니다."
    }
  },
  fire: {
    신강: {
      healing: "화 기운이 강한 신강 사주는 감정적으로 힘들지만 회복력이 좋습니다. 새로운 활동에 뛰어들며 에너지를 발산하고, 주변 사람들과의 교류를 통해 치유됩니다. 열정을 다른 곳에 쏟으며 극복해갑니다. 다만 감정을 억누르지 말고 충분히 표현하세요.",
      remarriage: "새로운 사랑에 대한 열망이 커서 재혼 가능성이 높습니다. 다만 감정에 휩쓸려 섣불리 결정하지 마세요. 충분한 치유 시간을 갖고, 이번에는 열정과 안정의 균형을 추구하세요. 감정 조절을 배우면 더 좋은 관계가 가능합니다.",
      recovery: "친구들과 시간을 보내고 새로운 취미를 찾으세요. 여행이나 문화 활동으로 에너지를 되찾으세요. 감정을 표현하고 발산하되, 파괴적인 방식은 피하세요. 긍정적인 에너지로 채워가세요.",
      guidance: "뜨거운 감정을 건강하게 표현하세요. 분노나 슬픔을 억누르지 말되, 자기 파괴적인 행동은 피하세요. 새로운 사랑을 찾을 때는 서두르지 마세요. 이번에는 열정만큼이나 안정도 중요시하는 관계를 찾으세요."
    },
    신약: {
      healing: "화 기운이 약한 신약 사주는 이별의 아픔을 오래 간직할 수 있습니다. 표현이 서툴러 혼자 삭이는 경향이 있습니다. 마음을 나눌 수 있는 사람을 찾고, 감정을 표현하세요. 조용히 자신만의 방식으로 치유해가되, 너무 고립되지 마세요.",
      remarriage: "상처가 깊어 새로운 만남에 두려움이 있을 수 있습니다. 충분한 치유 시간이 필요합니다. 귀하에게 따뜻하게 다가와주는 파트너를 만나면 좋습니다. 이번에는 자신의 감정도 표현하는 관계를 만드세요.",
      recovery: "감정을 억누르지 말고 표현하세요. 일기 쓰기나 예술 활동이 도움이 됩니다. 신뢰할 수 있는 사람에게 마음을 여세요. 작은 즐거움부터 찾아가며 천천히 회복하세요.",
      guidance: "마음의 상처를 충분히 치유하세요. 서두를 필요 없습니다. 과거에 표현하지 못했던 것들을 이번에는 배우세요. 자신의 감정을 소중히 여기고, 다음 관계에서는 더 적극적으로 마음을 나누세요."
    },
    중화: {
      healing: "화 기운이 조화로운 중화 사주는 감정을 적절히 표현하면서 치유해갑니다. 슬플 때는 슬퍼하고, 즐거울 때는 즐거워하며 균형을 유지합니다. 주변의 지지와 자신만의 시간을 조화롭게 활용하며 회복합니다.",
      remarriage: "감정이 정리된 후 새로운 만남에 열린 마음을 가질 수 있습니다. 과거의 교훈을 바탕으로 더 균형 잡힌 관계를 찾을 수 있습니다. 열정과 안정을 함께 추구하는 파트너를 만나면 좋습니다.",
      recovery: "감정을 표현하되 균형을 유지하세요. 즐거운 활동과 조용한 시간을 번갈아 가지세요. 새로운 것에 도전하면서도 충분히 쉬세요. 자신만의 속도로 회복해가세요.",
      guidance: "균형 잡힌 마음으로 이 시기를 지혜롭게 넘기고 있습니다. 감정을 충분히 표현하고, 필요하면 도움을 받으세요. 다음 관계에서도 열정과 안정의 균형을 유지하세요. 좋은 인연이 기다립니다."
    }
  },
  earth: {
    신강: {
      healing: "토 기운이 강한 신강 사주는 천천히 안정을 되찾아갑니다. 급하게 변화하려 하지 않고 일상의 루틴을 유지하며 회복합니다. 실질적인 것들에 집중하면서 마음을 추스릅니다. 다만 감정을 억누르지 말고 표현하는 시간도 필요합니다.",
      remarriage: "안정을 회복한 후 재혼을 고려할 수 있습니다. 조건보다 진정한 마음이 맞는 사람을 찾으세요. 가정을 이루고 싶은 마음이 강해 좋은 파트너를 만나면 재혼 가능성이 높습니다. 이번에는 변화에도 유연해지세요.",
      recovery: "일상의 루틴을 유지하며 안정을 찾으세요. 가족이나 오랜 친구와 시간을 보내세요. 작은 목표를 세우고 달성하며 자신감을 회복하세요. 급하게 변화하려 하지 말고 천천히 나아가세요.",
      guidance: "안정을 찾아가는 과정에서 감정도 표현하세요. 과거에 너무 고집스러웠다면 이번에는 유연해지세요. 새로운 관계에서는 변화도 받아들이는 열린 마음을 가지세요. 든든한 가정을 다시 이룰 수 있습니다."
    },
    신약: {
      healing: "토 기운이 약한 신약 사주는 기반이 흔들린 느낌에 불안할 수 있습니다. 혼자서 안정을 찾기 어려워 주변의 도움이 필요합니다. 가족이나 친구의 지지를 받으며 천천히 회복하세요. 새로운 기반을 다져가는 시간이 필요합니다.",
      remarriage: "안정을 줄 수 있는 파트너를 만나면 재혼 가능성이 있습니다. 다만 너무 의지하려 하지 말고, 함께 기반을 만들어갈 수 있는 관계를 찾으세요. 먼저 자신의 안정을 찾은 후 새로운 만남을 시작하세요.",
      recovery: "주변의 도움을 받아들이세요. 작은 것부터 스스로 할 수 있는 것을 늘려가세요. 경제적, 정서적 안정을 위한 계획을 세우세요. 혼자가 아니라는 것을 기억하세요.",
      guidance: "힘든 시기이지만 주변의 도움을 받으며 일어설 수 있습니다. 자신의 기반을 다지는 것이 먼저입니다. 새로운 관계에서는 의존보다 파트너십을 추구하세요. 함께 안정을 만들어갈 수 있는 사람을 찾으세요."
    },
    중화: {
      healing: "토 기운이 조화로운 중화 사주는 균형 잡힌 방식으로 안정을 되찾아갑니다. 일상을 유지하면서도 감정을 표현하고, 실용적인 계획을 세우면서도 휴식을 취합니다. 천천히 그러나 꾸준히 회복해갑니다.",
      remarriage: "안정을 회복한 후 자연스럽게 새로운 인연을 만날 수 있습니다. 과거의 교훈을 바탕으로 더 균형 잡힌 관계를 찾을 수 있습니다. 안정과 변화를 함께 추구하는 파트너가 좋습니다.",
      recovery: "일상과 휴식의 균형을 유지하며 회복하세요. 실용적인 계획을 세우되 감정도 돌보세요. 새로운 시작을 위한 기반을 차근차근 다져가세요.",
      guidance: "균형 잡힌 마음으로 이 시기를 넘기고 있습니다. 안정을 찾으면서도 변화에 열린 마음을 유지하세요. 다음 관계에서는 더 유연하고 따뜻한 모습을 보여주세요. 좋은 가정을 다시 이룰 수 있습니다."
    }
  },
  metal: {
    신강: {
      healing: "금 기운이 강한 신강 사주는 논리적으로 정리하며 치유됩니다. 과거를 분석하고 교훈을 얻어가며 마음을 정돈합니다. 다만 감정을 억누르지 말고 표현하는 시간도 필요합니다. 모든 것을 분석하려 하지 말고 그냥 슬퍼하는 시간도 가지세요.",
      remarriage: "분석적으로 접근하다 보면 새로운 만남에 신중해질 수 있습니다. 과거의 교훈을 바탕으로 더 나은 선택을 할 수 있습니다. 이번에는 감정 표현도 중요시하는 관계를 만드세요. 완벽을 추구하지 말고 진정성을 찾으세요.",
      recovery: "일기 쓰기나 명상으로 마음을 정돈하세요. 혼자만의 시간을 갖되 고립되지는 마세요. 분석도 좋지만 감정을 느끼는 시간도 필요합니다. 정리가 되면 새로운 시작을 계획하세요.",
      guidance: "모든 것을 분석하고 이해하려 하지 마세요. 때로는 이해할 수 없는 것도 있습니다. 감정을 표현하고, 슬픔을 느껴도 괜찮습니다. 다음 관계에서는 더 따뜻하게, 더 유연하게 다가가세요."
    },
    신약: {
      healing: "금 기운이 약한 신약 사주는 이별의 상처에 예민하게 반응할 수 있습니다. 거절당한 느낌에 자존감이 떨어질 수 있습니다. 자신을 탓하지 말고, 있는 그대로 받아들이세요. 따뜻한 사람들과 시간을 보내며 치유하세요.",
      remarriage: "상처가 치유되고 자신감이 회복된 후에 새로운 만남을 시작하세요. 귀하를 있는 그대로 받아들여주는 따뜻한 파트너를 찾으세요. 완벽해야 사랑받는다는 생각을 버리세요.",
      recovery: "자신을 탓하지 마세요. 당신 잘못이 아닙니다. 따뜻한 사람들과 시간을 보내고, 작은 성취를 통해 자신감을 회복하세요. 전문 상담도 도움이 됩니다. 자신을 사랑하는 연습을 하세요.",
      guidance: "당신은 충분히 가치 있는 사람입니다. 이별이 당신의 가치를 결정하지 않습니다. 자신에게 더 관대해지세요. 다음 관계에서는 있는 그대로의 자신을 보여줄 수 있는 용기를 가지세요."
    },
    중화: {
      healing: "금 기운이 조화로운 중화 사주는 논리와 감정의 균형을 유지하며 치유해갑니다. 과거를 분석하되 감정도 표현하고, 정리하면서도 슬퍼하는 시간을 가집니다. 균형 잡힌 방식으로 회복해갑니다.",
      remarriage: "치유가 된 후 새로운 만남에 열린 마음을 가질 수 있습니다. 과거의 교훈을 바탕으로 더 균형 잡힌 관계를 찾을 수 있습니다. 논리와 감정을 함께 중시하는 파트너가 좋습니다.",
      recovery: "분석과 감정 표현의 균형을 유지하세요. 혼자만의 시간과 사람들과의 교류를 번갈아 가지세요. 자신만의 속도로 정리해가세요.",
      guidance: "균형 잡힌 마음으로 이 시기를 넘기고 있습니다. 분석도 좋지만 때로는 그냥 느끼세요. 다음 관계에서는 더 따뜻하고 유연한 모습을 보여주세요. 좋은 인연이 기다립니다."
    }
  },
  water: {
    신강: {
      healing: "수 기운이 강한 신강 사주는 감정의 파도가 크지만 적응력도 좋습니다. 깊이 슬퍼하지만 시간이 약이 됩니다. 물가에서 시간을 보내거나 명상을 하면 마음이 편안해집니다. 너무 많이 생각하기보다 흐름에 맡기세요.",
      remarriage: "감정이 정리되면 새로운 인연에 대한 직관이 생깁니다. 깊은 감정 교류가 가능한 파트너를 만나면 좋습니다. 이번에는 생각만 하지 말고 행동으로 옮기세요. 영혼의 동반자를 찾을 수 있습니다.",
      recovery: "감정을 억누르지 말고 표현하세요. 물가에서 산책하거나 명상하세요. 깊은 대화가 가능한 사람과 마음을 나누세요. 시간이 지나면 지혜가 됩니다.",
      guidance: "깊은 감정을 가진 당신이기에 상처도 깊습니다. 하지만 그만큼 회복의 깊이도 있습니다. 생각만 하지 말고 행동하세요. 다음 관계에서는 직관을 믿되 현실도 함께 보세요."
    },
    신약: {
      healing: "수 기운이 약한 신약 사주는 이별의 감정에 휩쓸릴 수 있습니다. 혼자 있는 것이 두렵고 불안할 수 있습니다. 주변의 도움을 받으며 중심을 잡아가세요. 감정에만 의존하지 말고 현실적인 계획도 세우세요.",
      remarriage: "감정이 안정된 후에 새로운 만남을 시작하세요. 안정감을 주고 방향을 제시해줄 수 있는 파트너를 찾으세요. 너무 의지하려 하지 말고, 함께 성장할 수 있는 관계를 추구하세요.",
      recovery: "주변의 지지를 받으세요. 혼자 있는 시간이 두렵다면 사람들과 함께하세요. 작은 목표를 세우고 달성하며 중심을 잡아가세요. 전문 상담도 도움이 됩니다.",
      guidance: "감정에 휩쓸려도 괜찮지만, 중심을 잃지는 마세요. 주변의 도움을 받으며 서서히 일어서세요. 다음 관계에서는 의존보다 파트너십을 추구하세요. 자신의 중심을 먼저 찾으세요."
    },
    중화: {
      healing: "수 기운이 조화로운 중화 사주는 깊은 감정과 현실적 판단력의 균형을 유지하며 치유해갑니다. 충분히 슬퍼하면서도 앞으로 나아갈 준비를 합니다. 직관과 이성을 함께 사용하며 회복해갑니다.",
      remarriage: "감정이 정리되면 자연스럽게 새로운 인연이 찾아올 수 있습니다. 깊이 있으면서도 현실적인 관계를 찾을 수 있습니다. 영혼의 동반자이면서도 함께 현실을 살아갈 파트너를 만나세요.",
      recovery: "감정을 표현하면서도 현실적인 계획을 세우세요. 깊은 대화와 실용적인 활동을 번갈아 하세요. 직관을 믿되 이성적 판단도 함께 하세요.",
      guidance: "균형 잡힌 마음으로 이 시기를 넘기고 있습니다. 깊이 느끼면서도 앞으로 나아가세요. 다음 관계에서는 감정과 현실의 균형을 유지하세요. 진정한 영혼의 동반자를 찾을 수 있습니다."
    }
  }
};

// ============================================
// 기본 분석 함수
// ============================================

function getDayMasterElement(sajuResult: SajuApiResult): FiveElement {
  const stemElementMap: Record<HeavenlyStemKr, FiveElement> = {
    갑: "wood", 을: "wood",
    병: "fire", 정: "fire",
    무: "earth", 기: "earth",
    경: "metal", 신: "metal",
    임: "water", 계: "water"
  };

  const dayStem = sajuResult.dayPillar.cheongan as HeavenlyStemKr;
  return stemElementMap[dayStem] || "earth";
}

/**
 * 일간 오행에 따른 배우자 오행 결정
 * 남자: 재성 (내가 극하는 오행)
 * 여자: 관성 (나를 극하는 오행)
 */
function getPartnerElement(dayMasterElement: FiveElement, gender: Gender): FiveElement {
  const elementRelations: Record<FiveElement, { controls: FiveElement; controlledBy: FiveElement }> = {
    wood: { controls: "earth", controlledBy: "metal" },
    fire: { controls: "metal", controlledBy: "water" },
    earth: { controls: "water", controlledBy: "wood" },
    metal: { controls: "wood", controlledBy: "fire" },
    water: { controls: "fire", controlledBy: "earth" }
  };

  if (gender === "male") {
    return elementRelations[dayMasterElement].controls;  // 재성
  } else {
    return elementRelations[dayMasterElement].controlledBy;  // 관성
  }
}

/**
 * 향후 연도에서 배우자 오행이 세운으로 들어오는 연도 체크
 * 세운 천간의 오행이 배우자 오행과 일치하면 해당 연도 반환
 */
function checkPartnerStarInYears(currentYear: number, partnerElement: FiveElement): number[] {
  const stems: HeavenlyStemKr[] = ["갑", "을", "병", "정", "무", "기", "경", "신", "임", "계"];
  const stemToElement: Record<HeavenlyStemKr, FiveElement> = {
    갑: "wood", 을: "wood",
    병: "fire", 정: "fire",
    무: "earth", 기: "earth",
    경: "metal", 신: "metal",
    임: "water", 계: "water"
  };

  const yearsWithPartnerStar: number[] = [];

  // 향후 5년 체크
  for (let i = 0; i < 5; i++) {
    const year = currentYear + i;
    const stemIndex = (year - 4) % 10;
    const stem = stems[stemIndex];
    const yearElement = stemToElement[stem];

    if (yearElement === partnerElement) {
      yearsWithPartnerStar.push(year);
    }
  }

  return yearsWithPartnerStar;
}

function getDominantSipsin(sajuResult: SajuApiResult, gender: Gender): {
  dominant: string;
  hasPartnerStar: boolean;
  partnerStarCount: number;
} {
  const sipsinCount: Record<string, number> = {
    비견: 0, 겁재: 0, 식신: 0, 상관: 0, 편재: 0,
    정재: 0, 편관: 0, 정관: 0, 편인: 0, 정인: 0
  };

  const dayStem = sajuResult.dayPillar.cheongan as string;
  const pillars = [
    sajuResult.yearPillar,
    sajuResult.monthPillar,
    sajuResult.dayPillar,
    sajuResult.timePillar
  ];

  const sipsinMap: Record<string, Record<string, string>> = {
    갑: { 갑: "비견", 을: "겁재", 병: "식신", 정: "상관", 무: "편재", 기: "정재", 경: "편관", 신: "정관", 임: "편인", 계: "정인" },
    을: { 을: "비견", 갑: "겁재", 정: "식신", 병: "상관", 기: "편재", 무: "정재", 신: "편관", 경: "정관", 계: "편인", 임: "정인" },
    병: { 병: "비견", 정: "겁재", 무: "식신", 기: "상관", 경: "편재", 신: "정재", 임: "편관", 계: "정관", 갑: "편인", 을: "정인" },
    정: { 정: "비견", 병: "겁재", 기: "식신", 무: "상관", 신: "편재", 경: "정재", 계: "편관", 임: "정관", 을: "편인", 갑: "정인" },
    무: { 무: "비견", 기: "겁재", 경: "식신", 신: "상관", 임: "편재", 계: "정재", 갑: "편관", 을: "정관", 병: "편인", 정: "정인" },
    기: { 기: "비견", 무: "겁재", 신: "식신", 경: "상관", 계: "편재", 임: "정재", 을: "편관", 갑: "정관", 정: "편인", 병: "정인" },
    경: { 경: "비견", 신: "겁재", 임: "식신", 계: "상관", 갑: "편재", 을: "정재", 병: "편관", 정: "정관", 무: "편인", 기: "정인" },
    신: { 신: "비견", 경: "겁재", 계: "식신", 임: "상관", 을: "편재", 갑: "정재", 정: "편관", 병: "정관", 기: "편인", 무: "정인" },
    임: { 임: "비견", 계: "겁재", 갑: "식신", 을: "상관", 병: "편재", 정: "정재", 무: "편관", 기: "정관", 경: "편인", 신: "정인" },
    계: { 계: "비견", 임: "겁재", 을: "식신", 갑: "상관", 정: "편재", 병: "정재", 기: "편관", 무: "정관", 신: "편인", 경: "정인" }
  };

  pillars.forEach(pillar => {
    if (!pillar) return;
    const stem = pillar.cheongan as string;
    const sipsin = sipsinMap[dayStem]?.[stem];
    if (sipsin && sipsinCount[sipsin] !== undefined) {
      sipsinCount[sipsin]++;
    }
  });

  const sorted = Object.entries(sipsinCount)
    .filter(([_, count]) => count > 0)
    .sort((a, b) => b[1] - a[1]);

  // 배우자 별 (남자: 정재/편재, 여자: 정관/편관)
  let partnerStarCount = 0;
  if (gender === "male") {
    partnerStarCount = sipsinCount["정재"] + sipsinCount["편재"];
  } else {
    partnerStarCount = sipsinCount["정관"] + sipsinCount["편관"];
  }

  return {
    dominant: sorted[0]?.[0] || "정재",
    hasPartnerStar: partnerStarCount > 0,
    partnerStarCount
  };
}

// ============================================
// 솔로 전용 분석
// ============================================

interface SoloContent {
  singleReason: string;
  meetingTiming: { year: number; season: string; probability: string }[];
  meetingPlaces: string[];
  idealFirstMove: string;
  selfImprovementAdvice: string;
}

function analyzeSoloContent(
  dayMasterElement: FiveElement,
  sipsinAnalysis: { dominant: string; hasPartnerStar: boolean; partnerStarCount: number },
  currentYear: number,
  sinGangSinYak: string,
  gender: Gender = "male"
): SoloContent {
  // 솔로 이유 분석
  const singleReasons: Record<FiveElement, string> = {
    wood: "성장과 목표에 집중하느라 연애에 소홀했거나, 이상이 높아 쉽게 마음을 열지 않았을 수 있습니다.",
    fire: "뜨거운 감정을 주체하지 못해 상대에게 부담을 주었거나, 너무 빨리 타올랐다 식어버렸을 수 있습니다.",
    earth: "안정을 추구하다 보니 새로운 만남에 소극적이었거나, 편안함에 안주했을 수 있습니다.",
    metal: "기준이 높고 까다로워 마음에 드는 사람을 찾기 어려웠거나, 감정 표현이 서툴렀을 수 있습니다.",
    water: "감정의 흐름에 따라 왔다 갔다 하거나, 마음을 쉽게 정하지 못해 기회를 놓쳤을 수 있습니다."
  };

  // 신강/신약에 따른 추가 이유
  let additionalReason = "";
  if (sinGangSinYak === "신강") {
    additionalReason = " 또한 자기 주장이 강해 상대와 맞추는 것이 어려웠을 수 있습니다.";
  } else if (sinGangSinYak === "신약") {
    additionalReason = " 또한 자신감 부족이나 소극적인 태도가 만남의 기회를 줄였을 수 있습니다.";
  }

  // 세운에서 배우자 오행이 들어오는지 체크 (남자: 재성, 여자: 관성)
  const partnerElement = getPartnerElement(dayMasterElement, gender);
  const yearElementsWithPartnerStar = checkPartnerStarInYears(currentYear, partnerElement);

  // 만남 시기 예측 (세운 배우자성 반영)
  const meetingTiming: { year: number; season: string; probability: string }[] = [];
  for (let i = 0; i <= 3; i++) {
    const year = currentYear + i;
    const hasPartnerStarThisYear = yearElementsWithPartnerStar.includes(year);
    // 세운에서 배우자 오행이 들어오면 확률 상향
    let probability = "보통";
    if (hasPartnerStarThisYear) {
      probability = "높음";
    } else if (i === 0 || i === 2) {
      probability = "보통";
    } else {
      probability = "낮음";
    }
    const seasons = ["봄", "여름", "가을", "겨울"];
    meetingTiming.push({
      year,
      season: seasons[i % 4],
      probability
    });
  }

  // 만남 장소
  const meetingPlaces: Record<FiveElement, string[]> = {
    wood: ["도서관", "스터디 모임", "헬스장", "등산 동호회", "자기계발 강좌"],
    fire: ["파티", "클럽", "동호회 모임", "문화 행사", "여행지"],
    earth: ["소개팅", "직장", "동네 카페", "종교 모임", "가족 지인 소개"],
    metal: ["전문가 모임", "세미나", "업무 관련 네트워킹", "온라인 앱"],
    water: ["카페", "전시회", "영화관", "온라인 커뮤니티", "우연한 만남"]
  };

  // 첫 행동 조언
  const firstMoveAdvice: Record<FiveElement, string> = {
    wood: "공통 관심사를 찾아 자연스럽게 대화를 시작하세요. 성장 가능성을 보여주는 것이 매력 포인트입니다.",
    fire: "밝고 자신감 있게 다가가세요. 유머와 열정으로 분위기를 이끌면 좋은 인상을 줄 수 있습니다.",
    earth: "진솔하고 편안한 분위기로 다가가세요. 급하게 하지 말고 천천히 신뢰를 쌓아가는 것이 중요합니다.",
    metal: "논리적이고 깔끔한 인상을 주세요. 상대의 지적인 면을 칭찬하는 것이 효과적입니다.",
    water: "부드럽고 공감하는 태도로 다가가세요. 상대의 이야기를 경청하는 것이 호감을 얻는 비결입니다."
  };

  // 자기 개선 조언
  const selfImprovementAdvice: Record<string, string> = {
    비견: "경쟁심을 줄이고 협력하는 연습을 하세요",
    겁재: "질투와 소유욕을 다스리는 법을 배우세요",
    식신: "적극적으로 다가가는 용기를 기르세요",
    상관: "상대의 입장에서 생각하는 연습을 하세요",
    편재: "한 사람에게 집중하는 연습을 하세요",
    정재: "가끔은 로맨틱한 제스처도 필요합니다",
    편관: "부드러운 표현을 연습하세요",
    정관: "유연성을 기르고 즉흥적인 데이트도 즐겨보세요",
    편인: "현실적인 기대치를 가지세요",
    정인: "가르치려 하지 말고 함께 배우려는 자세를 가지세요"
  };

  return {
    singleReason: singleReasons[dayMasterElement] + additionalReason,
    meetingTiming,
    meetingPlaces: meetingPlaces[dayMasterElement],
    idealFirstMove: firstMoveAdvice[dayMasterElement],
    selfImprovementAdvice: selfImprovementAdvice[sipsinAnalysis.dominant] || "자신을 사랑하고 가꾸는 것부터 시작하세요"
  };
}

// ============================================
// 연애중 전용 분석
// ============================================

interface DatingContent {
  relationshipHealth: { score: number; analysis: string };
  developmentForecast: string;
  marriagePossibility: { score: number; timing: string };
  warningSignals: string[];
  deepeningAdvice: string;
}

function analyzeDatingContent(
  dayMasterElement: FiveElement,
  sipsinAnalysis: { dominant: string; hasPartnerStar: boolean; partnerStarCount: number },
  sinGangSinYak: string,
  currentYear: number
): DatingContent {
  // 관계 건강도 (배우자 별 유무와 개수로 판단)
  let healthScore = 60;
  let healthAnalysis = "";

  if (sipsinAnalysis.hasPartnerStar) {
    healthScore += sipsinAnalysis.partnerStarCount * 10;
    healthAnalysis = "사주에 배우자 별이 있어 연애 운이 기본적으로 좋습니다. ";
  } else {
    healthAnalysis = "사주에 배우자 별이 약해 관계 유지에 노력이 필요합니다. ";
  }

  if (sinGangSinYak === "신강") {
    healthAnalysis += "자기 주장이 강하니 상대의 의견도 존중하세요.";
  } else if (sinGangSinYak === "신약") {
    healthAnalysis += "상대에게 맞추느라 지치지 않도록 자기 주장도 해보세요.";
  } else {
    healthAnalysis += "균형 잡힌 관계를 유지하고 있습니다.";
  }

  // 발전 전망
  const developmentForecasts: Record<FiveElement, string> = {
    wood: "서로 성장하며 발전하는 관계가 될 수 있습니다. 공동의 목표를 세우면 더욱 깊어집니다.",
    fire: "열정이 식지 않도록 새로운 경험을 함께하세요. 감정 기복을 잘 관리하면 오래갑니다.",
    earth: "안정적으로 발전할 가능성이 높습니다. 서로에 대한 신뢰를 꾸준히 쌓아가세요.",
    metal: "명확한 소통이 관계 발전의 열쇠입니다. 감정 표현을 더 적극적으로 해보세요.",
    water: "감정적 교류가 깊어질수록 관계도 깊어집니다. 변덕을 줄이고 일관성을 유지하세요."
  };

  // 결혼 가능성
  let marriageScore = 50;
  if (sipsinAnalysis.hasPartnerStar) marriageScore += 20;
  if (sipsinAnalysis.partnerStarCount >= 2) marriageScore += 10;

  const marriageTiming = sipsinAnalysis.hasPartnerStar
    ? `${currentYear + 1}~${currentYear + 3}년 사이 결혼 논의가 가능합니다.`
    : `${currentYear + 2}~${currentYear + 4}년 사이 신중히 결정하세요.`;

  // 경고 신호
  const warningSignals: string[] = [];
  if (sinGangSinYak === "신강") {
    warningSignals.push("자기 중심적 태도로 상대가 지칠 수 있습니다");
  } else if (sinGangSinYak === "신약") {
    warningSignals.push("너무 맞추다가 자신을 잃을 수 있습니다");
  }

  const sipsinWarnings: Record<string, string> = {
    겁재: "질투심이 관계를 해칠 수 있습니다",
    상관: "날카로운 말이 상처가 될 수 있습니다",
    편재: "다른 이성에 대한 관심을 조심하세요",
    편관: "지배하려는 태도가 문제될 수 있습니다"
  };

  if (sipsinWarnings[sipsinAnalysis.dominant]) {
    warningSignals.push(sipsinWarnings[sipsinAnalysis.dominant]);
  }

  // 관계 심화 조언
  const deepeningAdvices: Record<FiveElement, string> = {
    wood: "함께 배우고 성장하는 활동을 계획하세요. 상대의 꿈을 응원해주세요.",
    fire: "특별한 날을 만들고 서프라이즈를 준비하세요. 열정을 표현하되 안정감도 주세요.",
    earth: "일상의 소소한 행복을 함께 나누세요. 서로의 가족과 친해지는 시간을 가지세요.",
    metal: "솔직한 대화로 서로를 더 깊이 알아가세요. 서로의 공간도 존중해주세요.",
    water: "깊은 대화로 마음을 나누세요. 여행이나 새로운 경험을 함께하면 좋습니다."
  };

  return {
    relationshipHealth: { score: Math.min(100, healthScore), analysis: healthAnalysis },
    developmentForecast: developmentForecasts[dayMasterElement],
    marriagePossibility: { score: Math.min(100, marriageScore), timing: marriageTiming },
    warningSignals,
    deepeningAdvice: deepeningAdvices[dayMasterElement]
  };
}

// ============================================
// 기혼 전용 분석
// ============================================

interface MarriedContent {
  spouseRelationship: { score: number; analysis: string };
  conflictPatterns: string[];
  harmonizingAdvice: string;
  renewalTiming: string;
  familyFortune: string;
}

function analyzeMarriedContent(
  dayMasterElement: FiveElement,
  sipsinAnalysis: { dominant: string; hasPartnerStar: boolean; partnerStarCount: number },
  sinGangSinYak: string,
  currentYear: number
): MarriedContent {
  // 배우자 관계 점수
  let spouseScore = 60;
  if (sipsinAnalysis.hasPartnerStar) spouseScore += 15;

  let spouseAnalysis = "";
  if (sinGangSinYak === "신강") {
    spouseAnalysis = "주도적인 성향이 강해 배우자와 의견 충돌이 있을 수 있습니다. 양보와 타협의 미덕을 발휘하세요.";
    spouseScore -= 5;
  } else if (sinGangSinYak === "신약") {
    spouseAnalysis = "배우자에게 의지하는 경향이 있습니다. 때로는 자신의 의견도 표현하세요.";
    spouseScore += 5;
  } else {
    spouseAnalysis = "균형 잡힌 부부 관계를 유지할 수 있는 사주입니다. 현재의 조화를 잘 유지하세요.";
    spouseScore += 10;
  }

  // 갈등 패턴
  const conflictPatterns: string[] = [];
  const elementConflicts: Record<FiveElement, string> = {
    wood: "서로의 성장 방향이 다를 때 갈등이 생깁니다",
    fire: "감정적 충돌이 잦고 화해도 빠릅니다",
    earth: "변화를 싫어해 고착된 패턴에 갇힐 수 있습니다",
    metal: "옳고 그름을 따지다 감정이 상할 수 있습니다",
    water: "감정 기복으로 상대를 혼란스럽게 할 수 있습니다"
  };
  conflictPatterns.push(elementConflicts[dayMasterElement]);

  const sipsinConflicts: Record<string, string> = {
    비견: "주도권 다툼이 발생할 수 있습니다",
    겁재: "질투와 의심이 문제가 될 수 있습니다",
    상관: "날카로운 지적이 상처가 됩니다",
    편관: "권위적 태도가 갈등을 유발합니다"
  };
  if (sipsinConflicts[sipsinAnalysis.dominant]) {
    conflictPatterns.push(sipsinConflicts[sipsinAnalysis.dominant]);
  }

  // 화합 조언
  const harmonizingAdvices: Record<FiveElement, string> = {
    wood: "함께하는 취미 생활을 만들고, 서로의 개인적 성장도 응원하세요. 주말 등산이나 운동을 추천합니다.",
    fire: "데이트 나이트를 정기적으로 갖고, 감사와 칭찬을 자주 표현하세요. 여행이나 문화 생활을 함께하세요.",
    earth: "일상의 안정감을 중시하되, 가끔은 새로운 경험도 함께하세요. 함께 요리하거나 집안일을 나누세요.",
    metal: "명확하고 논리적인 대화로 오해를 풀고, 서로의 공간도 존중하세요. 각자의 시간도 필요합니다.",
    water: "깊은 대화와 감정 교류를 자주 하세요. 함께 영화 보거나 감성적인 활동을 추천합니다."
  };

  // 재충전 시기
  const renewalTiming = `${currentYear}년 ${["봄", "여름", "가을", "겨울"][currentYear % 4]}에 부부만의 시간을 갖는 것이 좋습니다. 기념일 여행이나 특별한 데이트를 계획하세요.`;

  // 가정운
  const familyFortunes: Record<FiveElement, string> = {
    wood: "가정이 함께 성장하는 분위기입니다. 자녀 교육에 관심이 많고, 가족 간 건강한 경쟁도 있습니다.",
    fire: "활기차고 밝은 가정입니다. 가족 행사와 모임이 많고, 화기애애한 분위기를 유지합니다.",
    earth: "안정적이고 화목한 가정입니다. 경제적 기반이 탄탄하고, 가족 간 신뢰가 두텁습니다.",
    metal: "규율이 있고 체계적인 가정입니다. 자녀 교육에 원칙이 있고, 깔끔한 가정 환경을 유지합니다.",
    water: "정서적으로 깊이 있는 가정입니다. 가족 간 감정 교류가 활발하고, 서로를 잘 이해합니다."
  };

  return {
    spouseRelationship: { score: Math.min(100, spouseScore), analysis: spouseAnalysis },
    conflictPatterns,
    harmonizingAdvice: harmonizingAdvices[dayMasterElement],
    renewalTiming,
    familyFortune: familyFortunes[dayMasterElement]
  };
}

// ============================================
// 이혼·사별 전용 분석
// ============================================

interface DivorcedContent {
  healingProgress: string;
  remarriageForecast: { possibility: string; timing: string };
  selfRecoveryAdvice: string;
  newRelationshipTiming: { year: number; advice: string }[];
  emotionalGuidance: string;
}

function analyzeDivorcedContent(
  dayMasterElement: FiveElement,
  sipsinAnalysis: { dominant: string; hasPartnerStar: boolean; partnerStarCount: number },
  sinGangSinYak: string,
  currentYear: number
): DivorcedContent {
  // 치유 과정
  const healingProgress: Record<FiveElement, string> = {
    wood: "상처를 성장의 발판으로 삼으려 합니다. 자기 계발에 집중하며 치유되고 있습니다. 새로운 목표를 세우면 더 빨리 회복됩니다.",
    fire: "감정적으로 힘들지만 회복력이 좋습니다. 주변 사람들의 지지가 치유에 큰 도움이 됩니다. 새로운 활동을 시작해보세요.",
    earth: "천천히 안정을 되찾아가고 있습니다. 급하게 변화하려 하지 말고, 일상의 루틴을 유지하며 회복하세요.",
    metal: "논리적으로 정리하며 치유됩니다. 과거를 분석하고 교훈을 얻어가고 있습니다. 감정도 표현하는 것이 필요합니다.",
    water: "감정의 파도가 크지만 적응력이 좋습니다. 시간이 약이 됩니다. 물가에서 시간을 보내면 마음이 편안해질 것입니다."
  };

  // 재혼 예측
  let remarriagePossibility = "보통";
  if (sipsinAnalysis.hasPartnerStar) {
    remarriagePossibility = sipsinAnalysis.partnerStarCount >= 2 ? "높음" : "양호";
  } else {
    remarriagePossibility = "신중히 접근 필요";
  }

  const remarriageTiming = sipsinAnalysis.hasPartnerStar
    ? `${currentYear + 2}~${currentYear + 4}년 사이 새로운 인연이 들어올 수 있습니다.`
    : `${currentYear + 3}~${currentYear + 5}년 사이 준비된 마음으로 만남에 나서보세요.`;

  // 자기 회복 조언
  const selfRecoveryAdvices: Record<FiveElement, string> = {
    wood: "새로운 것을 배우고 성장하는 데 집중하세요. 운동이나 자기 계발 활동이 치유에 도움이 됩니다.",
    fire: "친구들과 시간을 보내고 새로운 취미를 찾아보세요. 여행이나 문화 활동으로 에너지를 되찾으세요.",
    earth: "안정적인 일상을 유지하며 천천히 치유하세요. 가족이나 오랜 친구들과 시간을 보내면 좋습니다.",
    metal: "혼자만의 시간을 갖고 정리하세요. 일기 쓰기나 명상이 마음을 정돈하는 데 도움이 됩니다.",
    water: "감정을 억누르지 말고 표현하세요. 상담이나 치유 프로그램 참여를 고려해보세요."
  };

  // 새로운 관계 타이밍
  const newRelationshipTiming: { year: number; advice: string }[] = [];
  for (let i = 1; i <= 3; i++) {
    const year = currentYear + i;
    let advice = "";
    if (i === 1) {
      advice = "아직은 치유에 집중하는 시기입니다. 만남보다 자기 자신에게 집중하세요.";
    } else if (i === 2) {
      advice = "가벼운 만남으로 시작해도 좋습니다. 부담 없이 사람들을 만나보세요.";
    } else {
      advice = "새로운 관계를 시작하기 좋은 시기입니다. 열린 마음으로 인연을 맞이하세요.";
    }
    newRelationshipTiming.push({ year, advice });
  }

  // 감정 가이드
  let emotionalGuidance = "";
  if (sinGangSinYak === "신강") {
    emotionalGuidance = "혼자서도 잘 해낼 수 있지만, 때로는 도움을 요청하는 것도 강함입니다. 주변의 지지를 받아들이세요.";
  } else if (sinGangSinYak === "신약") {
    emotionalGuidance = "힘든 시기를 보내고 있지만, 당신은 생각보다 강합니다. 전문가의 도움을 받는 것도 좋은 방법입니다.";
  } else {
    emotionalGuidance = "균형 잡힌 마음으로 이 시기를 지혜롭게 넘기고 있습니다. 자신을 믿고 천천히 나아가세요.";
  }

  return {
    healingProgress: healingProgress[dayMasterElement],
    remarriageForecast: { possibility: remarriagePossibility, timing: remarriageTiming },
    selfRecoveryAdvice: selfRecoveryAdvices[dayMasterElement],
    newRelationshipTiming,
    emotionalGuidance
  };
}

// ============================================
// 오행 한글 명칭
// ============================================

const ELEMENT_NAMES_KR: Record<FiveElement, string> = {
  wood: "목",
  fire: "화",
  earth: "토",
  metal: "금",
  water: "수",
};

// ============================================
// Narrative 생성 함수
// ============================================

function generateRelationshipNarrative(
  relationshipStatus: RelationshipStatus,
  dayMasterElement: FiveElement,
  sinGangSinYak: string,
  soloContent?: Chapter13Result["soloContent"],
  datingContent?: Chapter13Result["datingContent"],
  marriedContent?: Chapter13Result["marriedContent"],
  divorcedContent?: Chapter13Result["divorcedContent"]
): ChapterNarrative {
  const elementKr = ELEMENT_NAMES_KR[dayMasterElement];

  // 관계 상태에 따른 분기 - dayMasterElement 전달
  if (relationshipStatus === "solo" && soloContent) {
    return generateSoloNarrative(elementKr, sinGangSinYak, soloContent, dayMasterElement);
  } else if (relationshipStatus === "dating" && datingContent) {
    return generateDatingNarrative(elementKr, sinGangSinYak, datingContent, dayMasterElement);
  } else if (relationshipStatus === "married" && marriedContent) {
    return generateMarriedNarrative(elementKr, sinGangSinYak, marriedContent, dayMasterElement);
  } else if (relationshipStatus === "divorced" && divorcedContent) {
    return generateDivorcedNarrative(elementKr, sinGangSinYak, divorcedContent, dayMasterElement);
  }

  // 기본 반환
  return {
    intro: "인연과 관계의 흐름을 분석합니다.",
    mainAnalysis: "관계 상태에 따른 상세 분석이 필요합니다.",
    details: [],
    advice: "자신의 현재 상황에 맞는 분석을 확인하세요.",
    closing: "좋은 인연이 함께하기를 바랍니다.",
  };
}

function generateSoloNarrative(
  elementKr: string,
  sinGangSinYak: string,
  content: NonNullable<Chapter13Result["soloContent"]>,
  dayMasterElement: FiveElement
): ChapterNarrative {
  const strengthText = sinGangSinYak === "신강" ? "자기 주도적인" : sinGangSinYak === "신약" ? "신중하고 조심스러운" : "균형 잡힌";
  const strengthKey = getStrengthKey(sinGangSinYak);

  // 신강신약 조합별 상세 분석 가져오기
  const strengthNarrative = SOLO_STRENGTH_NARRATIVES[dayMasterElement][strengthKey];

  const intro = `${elementKr}(${ELEMENT_NAMES_KR[Object.keys(ELEMENT_NAMES_KR).find(k => ELEMENT_NAMES_KR[k as FiveElement] === elementKr) as FiveElement] || "목"}) 오행의 기운과 ${strengthText} 사주 특성이 현재의 솔로 상태에 어떤 영향을 미치는지, 그리고 앞으로의 인연 가능성을 상세히 분석해 드립니다.`;

  const mainAnalysis = `현재 솔로인 이유를 사주학적으로 살펴보면 다음과 같습니다. ${strengthNarrative.reason} 이는 타고난 기질에서 비롯된 것으로, 단점이 아닌 하나의 특성입니다. 이러한 특성을 이해하고 받아들이면서 자연스럽게 변화를 추구하는 것이 중요합니다.`;

  const details: string[] = [];

  // 만남 시기 예측
  details.push(`• 인연의 시기: ${strengthNarrative.timing}`);

  // 만남 시기 예측 (기존 데이터도 포함)
  if (content.meetingTiming.length > 0) {
    const timingList = content.meetingTiming
      .map((t) => `${t.year}년 ${t.season}(가능성: ${t.probability})`)
      .join(", ");
    details.push(`• 새로운 인연이 들어올 수 있는 시기: ${timingList}`);
  }

  // 만남 장소
  if (content.meetingPlaces.length > 0) {
    details.push(`• 인연을 만날 수 있는 추천 장소: ${content.meetingPlaces.join(", ")}`);
  }

  // 접근 방법
  details.push(`• 효과적인 접근 방법: ${strengthNarrative.approach}`);

  // 첫 행동 조언
  details.push(`• 첫 만남 시 조언: ${content.idealFirstMove}`);

  // 자기 개선 조언
  details.push(`• 자기 개선 포인트: ${content.selfImprovementAdvice}`);

  // 신강신약별 특별 조언
  details.push(`• 핵심 조언: ${strengthNarrative.advice}`);

  const advice = `${strengthNarrative.advice} 지금은 스스로를 가꾸고 발전시키는 시간으로 삼기 바랍니다. 인연은 준비된 사람에게 찾아옵니다. 조급해하지 말고, 자신의 매력을 키우며 자연스러운 만남의 기회를 만들어 가세요.`;

  const closing = "좋은 인연은 반드시 찾아옵니다. 자신을 사랑하고 가꾸는 시간이 곧 인연을 준비하는 시간입니다.";

  return { intro, mainAnalysis, details, advice, closing };
}

function generateDatingNarrative(
  elementKr: string,
  sinGangSinYak: string,
  content: NonNullable<Chapter13Result["datingContent"]>,
  dayMasterElement: FiveElement
): ChapterNarrative {
  const strengthText = sinGangSinYak === "신강" ? "주도적인" : sinGangSinYak === "신약" ? "배려심 깊은" : "조화로운";
  const strengthKey = getStrengthKey(sinGangSinYak);

  // 신강신약 조합별 상세 분석 가져오기
  const strengthNarrative = DATING_STRENGTH_NARRATIVES[dayMasterElement][strengthKey];

  const intro = `현재 연애 중이신 상황에서 ${elementKr} 오행의 기운과 ${strengthText} 사주 특성이 관계에 어떤 영향을 미치는지 분석해 드립니다. 현재 관계의 건강도와 발전 가능성, 그리고 더 깊은 관계로 나아가기 위한 조언을 확인하세요.`;

  const mainAnalysis = `현재 관계의 건강도는 ${content.relationshipHealth.score}점으로 평가됩니다. ${strengthNarrative.health} ${strengthNarrative.development}`;

  const details: string[] = [];

  // 관계 건강도
  details.push(`• 관계 건강도: ${content.relationshipHealth.score}점 - ${strengthNarrative.health}`);

  // 발전 전망
  details.push(`• 관계 발전 전망: ${strengthNarrative.development}`);

  // 결혼 가능성
  details.push(`• 결혼 가능성: ${content.marriagePossibility.score}점 - ${content.marriagePossibility.timing}`);

  // 경고 신호
  details.push(`• 주의할 점: ${strengthNarrative.warning}`);
  if (content.warningSignals.length > 0) {
    details.push(`• 추가 주의 사항: ${content.warningSignals.join(", ")}`);
  }

  // 관계 심화 조언
  details.push(`• 관계 심화 조언: ${strengthNarrative.advice}`);

  const advice = `${strengthNarrative.advice} 현재 관계를 더욱 깊고 의미 있게 발전시키기 위해서는 서로에 대한 이해와 존중이 필수입니다. 결혼을 고려한다면 ${content.marriagePossibility.timing.split(".")[0]}을(를) 참고하기 바랍니다.`;

  const closing = "사랑은 노력으로 꽃피웁니다. 현재의 인연을 소중히 여기고, 함께 성장하는 관계를 만들어 가기 바랍니다.";

  return { intro, mainAnalysis, details, advice, closing };
}

function generateMarriedNarrative(
  elementKr: string,
  sinGangSinYak: string,
  content: NonNullable<Chapter13Result["marriedContent"]>,
  dayMasterElement: FiveElement
): ChapterNarrative {
  const strengthText = sinGangSinYak === "신강" ? "리더십이 강한" : sinGangSinYak === "신약" ? "조화를 중시하는" : "균형 잡힌";
  const strengthKey = getStrengthKey(sinGangSinYak);

  // 신강신약 조합별 상세 분석 가져오기
  const strengthNarrative = MARRIED_STRENGTH_NARRATIVES[dayMasterElement][strengthKey];

  const intro = `기혼 상태에서 ${elementKr} 오행의 기운과 ${strengthText} 사주 특성이 부부 관계와 가정에 어떤 영향을 미치는지 분석해 드립니다. 배우자와의 관계 개선과 화목한 가정을 위한 조언을 확인하세요.`;

  const mainAnalysis = `배우자와의 관계 점수는 ${content.spouseRelationship.score}점입니다. ${strengthNarrative.spouse} 가정운을 살펴보면, ${strengthNarrative.family}`;

  const details: string[] = [];

  // 배우자 관계
  details.push(`• 배우자 관계: ${content.spouseRelationship.score}점 - ${strengthNarrative.spouse}`);

  // 갈등 패턴
  details.push(`• 주요 갈등 패턴: ${strengthNarrative.conflict}`);
  if (content.conflictPatterns.length > 0) {
    details.push(`• 추가 갈등 패턴: ${content.conflictPatterns.join(", ")}`);
  }

  // 화합 조언
  details.push(`• 화합을 위한 조언: ${strengthNarrative.harmony}`);

  // 재충전 시기
  details.push(`• 관계 재충전 시기: ${content.renewalTiming}`);

  // 가정운
  details.push(`• 가정운: ${strengthNarrative.family}`);

  const advice = `${strengthNarrative.harmony} 부부 관계는 끊임없는 노력과 소통이 필요합니다. ${content.renewalTiming.split(".")[0]}에 특별한 시간을 계획해 보세요. 서로에 대한 감사와 존중을 잊지 마시기 바랍니다.`;

  const closing = "행복한 가정은 두 사람의 노력으로 만들어집니다. 서로를 이해하고 배려하는 마음이 화목한 가정의 기초입니다.";

  return { intro, mainAnalysis, details, advice, closing };
}

function generateDivorcedNarrative(
  elementKr: string,
  sinGangSinYak: string,
  content: NonNullable<Chapter13Result["divorcedContent"]>,
  dayMasterElement: FiveElement
): ChapterNarrative {
  const strengthText = sinGangSinYak === "신강" ? "강인한 회복력을 가진" : sinGangSinYak === "신약" ? "섬세하고 깊이 있는" : "균형 잡힌";
  const strengthKey = getStrengthKey(sinGangSinYak);

  // 신강신약 조합별 상세 분석 가져오기
  const strengthNarrative = DIVORCED_STRENGTH_NARRATIVES[dayMasterElement][strengthKey];

  const intro = `이별 후의 상황에서 ${elementKr} 오행의 기운과 ${strengthText} 사주 특성이 치유와 새로운 시작에 어떤 영향을 미치는지 분석해 드립니다. 마음의 상처를 치유하고, 새로운 인연을 준비하는 과정에서 도움이 되기를 바랍니다.`;

  const mainAnalysis = `${strengthNarrative.healing} 재혼 가능성은 '${content.remarriageForecast.possibility}'으로 평가되며, ${strengthNarrative.remarriage}`;

  const details: string[] = [];

  // 치유 과정
  details.push(`• 현재 치유 과정: ${strengthNarrative.healing}`);

  // 재혼 전망
  details.push(`• 새로운 인연 전망: ${strengthNarrative.remarriage}`);
  details.push(`• 재혼 시기: ${content.remarriageForecast.possibility} - ${content.remarriageForecast.timing}`);

  // 자기 회복 조언
  details.push(`• 자기 회복 조언: ${strengthNarrative.recovery}`);

  // 새로운 관계 타이밍
  content.newRelationshipTiming.forEach((timing) => {
    details.push(`• ${timing.year}년: ${timing.advice}`);
  });

  // 감정 가이드
  details.push(`• 감정 관리 가이드: ${strengthNarrative.guidance}`);

  const advice = `${strengthNarrative.recovery} ${strengthNarrative.guidance} 과거의 아픔을 교훈 삼아 더 성숙한 관계를 준비하기 바랍니다. 새로운 인연을 맞이할 준비가 되었을 때, 좋은 만남이 찾아올 것입니다.`;

  const closing = "모든 끝은 새로운 시작입니다. 지금의 시간이 더 나은 미래를 위한 준비 기간이 되기를 진심으로 바랍니다.";

  return { intro, mainAnalysis, details, advice, closing };
}

// ============================================
// 메인 분석 함수
// ============================================

export function analyzeChapter13(
  sajuResult: SajuApiResult,
  gender: Gender,
  relationshipStatus: RelationshipStatus,
  currentYear: number,
  sinGangSinYak: string
): Chapter13Result {
  // 기본 분석
  const dayMasterElement = getDayMasterElement(sajuResult);
  const sipsinAnalysis = getDominantSipsin(sajuResult, gender);

  // 기본 결과 구조
  const result: Chapter13Result = {
    relationshipStatus
  };

  // 관계 상태별 분기
  switch (relationshipStatus) {
    case "solo":
      result.soloContent = analyzeSoloContent(
        dayMasterElement,
        sipsinAnalysis,
        currentYear,
        sinGangSinYak,
        gender
      );
      break;

    case "dating":
      result.datingContent = analyzeDatingContent(
        dayMasterElement,
        sipsinAnalysis,
        sinGangSinYak,
        currentYear
      );
      break;

    case "married":
      result.marriedContent = analyzeMarriedContent(
        dayMasterElement,
        sipsinAnalysis,
        sinGangSinYak,
        currentYear
      );
      break;

    case "divorced":
      result.divorcedContent = analyzeDivorcedContent(
        dayMasterElement,
        sipsinAnalysis,
        sinGangSinYak,
        currentYear
      );
      break;
  }

  // 서술형 Narrative 생성
  result.narrative = generateRelationshipNarrative(
    relationshipStatus,
    dayMasterElement,
    sinGangSinYak,
    result.soloContent,
    result.datingContent,
    result.marriedContent,
    result.divorcedContent
  );

  return result;
}
